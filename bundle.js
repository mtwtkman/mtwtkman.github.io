!function(n){function e(r){if(t[r])return t[r].exports;var i=t[r]={exports:{},id:r,loaded:!1};return n[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var t={};return e.m=n,e.c=t,e.p="",e(0)}([function(n,e,t){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}var i=t(1),a=r(i),o=t(3),u=r(o),s=t(6),l=r(s),c=t(31),f=r(c),d=t(36),h=r(d);a["default"].route.mode="hash",a["default"].route(document.getElementById("main"),"/",{"/":u["default"],"/blog":l["default"],"/blog/article/:date.../:slug":f["default"],"/blog/tag/:name":h["default"]})},function(n,e,t){var r;(function(n){!function(i,a){"use strict";var o=a(i);"object"==typeof n&&null!=n&&n.exports?n.exports=o:(r=function(){return o}.call(e,t,e,n),!(void 0!==r&&(n.exports=r)))}("undefined"!=typeof window?window:{},function(n,e){"use strict";function t(n){return"function"==typeof n}function r(n){return"[object Object]"===On.call(n)}function i(n){return"[object String]"===On.call(n)}function a(){}function o(n){xn=n.document,kn=n.location,Cn=n.cancelAnimationFrame||n.clearTimeout,jn=n.requestAnimationFrame||n.setTimeout}function u(n,e){for(var t,r=[],i=/(?:(^|#|\.)([^#\.\[\]]+))|(\[.+?\])/g;t=i.exec(e);)if(""===t[1]&&t[2])n.tag=t[2];else if("#"===t[1])n.attrs.id=t[2];else if("."===t[1])r.push(t[2]);else if("["===t[3][0]){var a=/\[(.+?)(?:=("|'|)(.*?)\2)?\]/.exec(t[3]);n.attrs[a[1]]=a[3]||(a[2]?"":!0)}return r}function s(n,e){var t=e?n.slice(1):n;return 1===t.length&&En(t[0])?t[0]:t}function l(n,e,t){var r="class"in e?"class":"className";for(var i in e)An.call(e,i)&&(i===r&&null!=e[i]&&""!==e[i]?(t.push(e[i]),n[i]=""):n[i]=e[i]);t.length&&(n[r]=t.join(" "))}function c(n,e){var t=[].slice.call(arguments,1);if(r(n))return en(n,t);if(!i(n))throw new Error("selector in m(selector, attrs, children) should be a string");var a=null!=e&&r(e)&&!("tag"in e||"view"in e||"subtree"in e),o=a?e:{},c={tag:"div",attrs:{},children:s(t,a)};return l(c.attrs,o,u(c,n)),c}function f(n,e){for(var t=0;t<n.length&&!e(n[t],t++););}function d(n,e){f(n,function(n,t){return(n=n&&n.attrs)&&null!=n.key&&e(n,t)})}function h(n){try{if(null!=n&&null!=n.toString())return n}catch(e){}return""}function p(n,e,t,r){try{m(n,e,t),e.nodeValue=r}catch(i){}}function g(n){for(var e=0;e<n.length;e++)En(n[e])&&(n=n.concat.apply([],n),e--);return n}function m(n,e,t){n.insertBefore(e,n.childNodes[t]||null)}function v(n,e,t,r){d(n,function(n,r){e[n=n.key]=e[n]?{action:Tn,index:r,from:e[n].index,element:t.nodes[e[n].index]||xn.createElement("div")}:{action:In,index:r}});var i=[];for(var a in e)An.call(e,a)&&i.push(e[a]);var o=i.sort(U),u=new Array(t.length);return u.nodes=t.nodes.slice(),f(o,function(e){var i=e.index;if(e.action===Sn&&(G(t[i].nodes,t[i]),u.splice(i,1)),e.action===In){var a=xn.createElement("div");a.key=n[i].attrs.key,m(r,a,i),u.splice(i,0,{attrs:{key:n[i].attrs.key},nodes:[a]}),u.nodes[i]=a}if(e.action===Tn){var o=e.element,s=r.childNodes[i];s!==o&&null!==o&&r.insertBefore(o,s||null),u[i]=t[e.from],u.nodes[i]=o}}),u}function y(n,e,t,r){var i=n.length!==e.length;return i||d(n,function(n,t){var r=e[t];return i=r&&r.attrs&&r.attrs.key!==n.key}),i?v(n,t,e,r):e}function _(n,e,t){f(n,function(n,r){null!=e[r]&&t.push.apply(t,e[r].nodes)}),f(e.nodes,function(n,r){null!=n.parentNode&&t.indexOf(n)<0&&G([n],[e[r]])}),n.length<e.length&&(e.length=n.length),e.nodes=t}function b(n){var e=0;d(n,function(){return f(n,function(n){(n=n&&n.attrs)&&null==n.key&&(n.key="__mithril__"+e++)}),1})}function w(n,e,t){return n.tag!==e.tag?!0:t.sort().join()!==Object.keys(e.attrs).sort().join()?!0:n.attrs.id!==e.attrs.id?!0:n.attrs.key!==e.attrs.key?!0:"all"===c.redraw.strategy()?!e.configContext||e.configContext.retain!==!0:"diff"===c.redraw.strategy()?e.configContext&&e.configContext.retain===!1:!1}function x(n,e,r){w(n,e,r)&&(e.nodes.length&&G(e.nodes),e.configContext&&t(e.configContext.onunload)&&e.configContext.onunload(),e.controllers&&f(e.controllers,function(n){n.onunload&&n.onunload({preventDefault:a})}))}function k(n,e){return n.attrs.xmlns?n.attrs.xmlns:"svg"===n.tag?"http://www.w3.org/2000/svg":"math"===n.tag?"http://www.w3.org/1998/Math/MathML":e}function j(n,e,t){t.length&&(n.views=e,n.controllers=t,f(t,function(n){if(n.onunload&&n.onunload.$old&&(n.onunload=n.onunload.$old),Mn&&n.onunload){var e=n.onunload;n.onunload=a,n.onunload.$old=e}}))}function C(n,e,r,i,a){if(t(e.attrs.config)){var o=a.configContext=a.configContext||{};n.push(function(){return e.attrs.config.call(e,r,!i,o,a)})}}function A(n,t,r,i,a,o,u,s){var l=n.nodes[0];return i&&H(l,t.tag,t.attrs,n.attrs,a),n.children=B(l,t.tag,e,e,t.children,n.children,!1,0,t.attrs.contenteditable?l:r,a,u),n.nodes.intact=!0,s.length&&(n.views=o,n.controllers=s),l}function O(n,e,t){var r;n.$trusted?r=Z(e,t,n):(r=[xn.createTextNode(n)],e.nodeName in Rn||m(e,r[0],t));var i;return i="string"==typeof n||"number"==typeof n||"boolean"==typeof n?new n.constructor(n):n,i.nodes=r,i}function E(n,e,t,r,i,a){var o=e.nodes;return r&&r===xn.activeElement||(n.$trusted?(G(o,e),o=Z(t,i,n)):"textarea"===a?t.value=n:r?r.innerHTML=n:((1===o[0].nodeType||o.length>1||o[0].nodeValue.trim&&!o[0].nodeValue.trim())&&(G(e.nodes,e),o=[xn.createTextNode(n)]),p(t,o[0],i,n))),e=new n.constructor(n),e.nodes=o,e}function R(n,e,t,r,i,a,o){return n.nodes.length?n.valueOf()!==e.valueOf()||i?E(e,n,r,a,t,o):(n.nodes.intact=!0,n):O(e,r,t)}function S(n){if(n.$trusted){var e=n.match(/<[^\/]|\>\s*[^<]/g);if(null!=e)return e.length}else if(En(n))return n.length;return 1}function I(n,t,r,i,a,o,u,s,l){n=g(n);var c=[],f=t.length===n.length,h=0,p={},m=!1;d(t,function(n,e){m=!0,p[t[e].attrs.key]={action:Sn,index:e}}),b(n),m&&(t=y(n,t,p,r));for(var v=0,w=0,x=n.length;x>w;w++){var k=B(r,a,t,i,n[w],t[v],o,i+h||h,u,s,l);k!==e&&(f=f&&k.nodes.intact,h+=S(k),t[v++]=k)}return f||_(n,t,c),t}function T(n,e,t,r,i){if(null!=e){if(On.call(e)===On.call(n))return e;if(i&&i.nodes){var a=t-r,o=a+(En(n)?n:e.nodes).length;G(i.nodes.slice(a,o),i.slice(a,o))}else e.nodes&&G(e.nodes,e)}return e=new n.constructor,e.tag&&(e={}),e.nodes=[],e}function M(n,e){return n.attrs.is?null==e?xn.createElement(n.tag,n.attrs.is):xn.createElementNS(e,n.tag,n.attrs.is):null==e?xn.createElement(n.tag):xn.createElementNS(e,n.tag)}function L(n,e,t,r){return r?H(e,n.tag,n.attrs,{},t):n.attrs}function P(n,t,r,i,a,o){return null!=n.children&&n.children.length>0?B(t,n.tag,e,e,n.children,r.children,!0,0,n.attrs.contenteditable?t:i,a,o):n.children}function D(n,e,t,r,i,a,o){var u={tag:n.tag,attrs:e,children:t,nodes:[r]};return j(u,a,o),u.children&&!u.children.nodes&&(u.children.nodes=[]),"select"===n.tag&&"value"in n.attrs&&H(r,n.tag,{value:n.attrs.value},{},i),u}function N(n,e,r,i){var a;return a="diff"===c.redraw.strategy()&&n?n.indexOf(e):-1,a>-1?r[a]:t(i)?new i:{}}function $(n,e,t,r){null!=r.onunload&&Pn.map(function(n){return n.handler}).indexOf(r.onunload)<0&&Pn.push({controller:r,handler:r.onunload}),n.push(t),e.push(r)}function q(n,e,t,r,i,a){var o=N(t.views,e,r,n.controller),u=n&&n.attrs&&n.attrs.key;return n=0===Mn||Dn||r&&r.indexOf(o)>-1?n.view(o):{tag:"placeholder"},"retain"===n.subtree?n:(n.attrs=n.attrs||{},n.attrs.key=u,$(a,i,e,o),n)}function z(n,e,t,r){for(var i=e&&e.controllers;null!=n.view;)n=q(n,n.view.$original||n.view,e,i,r,t);return n}function F(n,e,t,r,a,o,u,s){var l=[],c=[];if(n=z(n,e,l,c),"retain"===n.subtree)return e;if(!n.tag&&c.length)throw new Error("Component template must return a virtual element, not an array, string, etc.");n.attrs=n.attrs||{},e.attrs=e.attrs||{};var f=Object.keys(n.attrs),d=f.length>("key"in n.attrs?1:0);if(x(n,e,f),i(n.tag)){var h=0===e.nodes.length;u=k(n,u);var p;if(h){p=M(n,u);var g=L(n,p,u,d),v=P(n,p,e,t,u,s);e=D(n,g,v,p,u,l,c)}else p=A(e,n,t,d,u,l,s,c);return(h||o===!0&&null!=p)&&m(r,p,a),C(s,n,p,h,e),e}}function B(n,e,i,a,o,u,s,l,c,f,d){return o=h(o),"retain"===o.subtree?u:(u=T(o,u,l,a,i),En(o)?I(o,u,n,l,e,s,c,f,d):null!=o&&r(o)?F(o,u,c,n,l,s,f,d):t(o)?u:R(u,o,l,n,s,c,e))}function U(n,e){return n.action-e.action||n.index-e.index}function K(n,e,t){for(var r in e)An.call(e,r)&&(null!=t&&t[r]===e[r]||(n.style[r]=e[r]));for(r in t)An.call(t,r)&&(An.call(e,r)||(n.style[r]=""))}function W(n,e,i,a,o,u){if("config"===e||"key"===e)return!0;if(t(i)&&"on"===e.slice(0,2))n[e]=Q(i,n);else if("style"===e&&null!=i&&r(i))K(n,i,a);else if(null!=u)"href"===e?n.setAttributeNS("http://www.w3.org/1999/xlink","href",i):n.setAttribute("className"===e?"class":e,i);else if(e in n&&!Nn[e])try{"input"===o&&n[e]===i||(n[e]=i)}catch(s){n.setAttribute(e,i)}else n.setAttribute(e,i)}function V(n,e,t,r,i,a,o){if(e in i&&r===t)"value"===e&&"input"===a&&n.value!==t&&(n.value=t);else{i[e]=t;try{return W(n,e,t,r,a,o)}catch(u){if(u.message.indexOf("Invalid argument")<0)throw u}}}function H(n,e,t,r,i){for(var a in t)if(An.call(t,a)&&V(n,a,t[a],r[a],r,e,i))continue;return r}function G(n,e){for(var t=n.length-1;t>-1;t--)if(n[t]&&n[t].parentNode){try{n[t].parentNode.removeChild(n[t])}catch(r){}e=[].concat(e),e[t]&&J(e[t])}n.length&&(n.length=0)}function J(n){n.configContext&&t(n.configContext.onunload)&&(n.configContext.onunload(),n.configContext.onunload=null),n.controllers&&f(n.controllers,function(n){t(n.onunload)&&n.onunload({preventDefault:a})}),n.children&&(En(n.children)?f(n.children,J):n.children.tag&&J(n.children))}function Y(n,e){try{n.appendChild(xn.createRange().createContextualFragment(e))}catch(t){n.insertAdjacentHTML("beforeend",e)}}function Z(n,e,t){var r=n.childNodes[e];if(r){var i=1!==r.nodeType,a=xn.createElement("span");i?(n.insertBefore(a,r||null),a.insertAdjacentHTML("beforebegin",t),n.removeChild(a)):r.insertAdjacentHTML("beforebegin",t)}else Y(n,t);for(var o=[];n.childNodes[e]!==r;)o.push(n.childNodes[e]),e++;return o}function Q(n,e){return function(t){t=t||event,c.redraw.strategy("diff"),c.startComputation();try{return n.call(e,t)}finally{on()}}}function X(n){var e=qn.indexOf(n);return 0>e?qn.push(n)-1:e}function nn(n){function e(){return arguments.length&&(n=arguments[0]),n}return e.toJSON=function(){return n},e}function en(n,e){function t(){return(n.controller||a).apply(this,e)||this}function r(t){for(var r=[t].concat(e),i=1;i<arguments.length;i++)r.push(arguments[i]);return n.view.apply(n,r)}n.controller&&(t.prototype=n.controller.prototype),r.$original=n.view;var i={controller:t,view:r};return e[0]&&null!=e[0].key&&(i.attrs={key:e[0].key}),i}function tn(n,e,t,r){if(!r){c.redraw.strategy("all"),c.startComputation(),Bn[t]=e;var i;i=Fn=n?n:n={controller:a};var o=new(n.controller||a);return i===Fn&&(Kn[t]=o,Un[t]=n),on(),null===n&&rn(e,t),Kn[t]}null==n&&rn(e,t)}function rn(n,e){Bn.splice(e,1),Kn.splice(e,1),Un.splice(e,1),hn(n),qn.splice(X(n),1)}function an(){Hn&&(Hn(),Hn=null),f(Bn,function(n,e){var t=Un[e];if(Kn[e]){var r=[Kn[e]];c.render(n,t.view?t.view(Kn[e],r):"")}}),Gn&&(Gn(),Gn=null),Wn=null,Vn=new Date,c.redraw.strategy("diff")}function on(){"none"===c.redraw.strategy()?(Mn--,c.redraw.strategy("diff")):c.endComputation()}function un(n){return n.slice(Xn[c.route.mode].length)}function sn(n,e,t){Zn={};var r=t.indexOf("?");-1!==r&&(Zn=dn(t.substr(r+1,t.length)),t=t.substr(0,r));var i=Object.keys(e),a=i.indexOf(t);if(-1!==a)return c.mount(n,e[i[a]]),!0;for(var o in e)if(An.call(e,o)){if(o===t)return c.mount(n,e[o]),!0;var u=new RegExp("^"+o.replace(/:[^\/]+?\.{3}/g,"(.*?)").replace(/:[^\/]+/g,"([^\\/]+)")+"/?$");if(u.test(t))return t.replace(u,function(){var t=o.match(/:[^\/]+/g)||[],r=[].slice.call(arguments,1,-2);f(t,function(n,e){Zn[n.replace(/:|\./g,"")]=decodeURIComponent(r[e])}),c.mount(n,e[o])}),!0}}function ln(n){if(n=n||event,!(n.ctrlKey||n.metaKey||n.shiftKey||2===n.which)){n.preventDefault?n.preventDefault():n.returnValue=!1;var e,t=n.currentTarget||n.srcElement;for(e="pathname"===c.route.mode&&t.search?dn(t.search.slice(1)):{};t&&!/a/i.test(t.nodeName);)t=t.parentNode;Mn=0,c.route(t[c.route.mode].slice(Xn[c.route.mode].length),e)}}function cn(){"hash"!==c.route.mode&&kn.hash?kn.hash=kn.hash:n.scrollTo(0,0)}function fn(n,t){var i={},a=[];for(var o in n)if(An.call(n,o)){var u=t?t+"["+o+"]":o,s=n[o];if(null===s)a.push(encodeURIComponent(u));else if(r(s))a.push(fn(s,u));else if(En(s)){var l=[];i[u]=i[u]||{},f(s,function(n){i[u][n]||(i[u][n]=!0,l.push(encodeURIComponent(u)+"="+encodeURIComponent(n)))}),a.push(l.join("&"))}else s!==e&&a.push(encodeURIComponent(u)+"="+encodeURIComponent(s))}return a.join("&")}function dn(n){if(""===n||null==n)return{};"?"===n.charAt(0)&&(n=n.slice(1));var e=n.split("&"),t={};return f(e,function(n){var e=n.split("="),r=decodeURIComponent(e[0]),i=2===e.length?decodeURIComponent(e[1]):null;null!=t[r]?(En(t[r])||(t[r]=[t[r]]),t[r].push(i)):t[r]=i}),t}function hn(n){var t=X(n);G(n.childNodes,zn[t]),zn[t]=e}function pn(n,e){var t=c.prop(e);return n.then(t),t.then=function(t,r){return pn(n.then(t,r),e)},t["catch"]=t.then.bind(null,null),t}function gn(n,e){function i(n){s=n||ae,f.map(function(n){s===ie?n.resolve(l):n.reject(l)})}function a(n,e,i,a){if((null!=l&&r(l)||t(l))&&t(n))try{var o=0;n.call(l,function(n){o++||(l=n,e())},function(n){o++||(l=n,i())})}catch(u){c.deferred.onerror(u),l=u,i()}else a()}function o(){var r;try{r=l&&l.then}catch(f){return c.deferred.onerror(f),l=f,s=re,o()}s===re&&c.deferred.onerror(l),a(r,function(){s=te,o()},function(){s=re,o()},function(){try{s===te&&t(n)?l=n(l):s===re&&t(e)&&(l=e(l),s=te)}catch(o){return c.deferred.onerror(o),l=o,i()}l===u?(l=TypeError(),i()):a(r,function(){i(ie)},i,function(){i(s===te&&ie)})})}var u=this,s=0,l=0,f=[];u.promise={},u.resolve=function(n){return s||(l=n,s=te,o()),u},u.reject=function(n){return s||(l=n,s=re,o()),u},u.promise.then=function(n,e){var t=new gn(n,e);return s===ie?t.resolve(l):s===ae?t.reject(l):f.push(t),t.promise}}function mn(n){return n}function vn(t){var r="mithril_callback_"+(new Date).getTime()+"_"+Math.round(1e16*Math.random()).toString(36),i=xn.createElement("script");n[r]=function(a){i.parentNode.removeChild(i),t.onload({type:"load",target:{responseText:a}}),n[r]=e},i.onerror=function(){return i.parentNode.removeChild(i),t.onerror({type:"error",target:{status:500,responseText:JSON.stringify({error:"Error making jsonp request"})}}),n[r]=e,!1},i.onload=function(){return!1},i.src=t.url+(t.url.indexOf("?")>0?"&":"?")+(t.callbackKey?t.callbackKey:"callback")+"="+r+"&"+fn(t.data||{}),xn.body.appendChild(i)}function yn(e){var r=new n.XMLHttpRequest;if(r.open(e.method,e.url,!0,e.user,e.password),r.onreadystatechange=function(){4===r.readyState&&(r.status>=200&&r.status<300?e.onload({type:"load",target:r}):e.onerror({type:"error",target:r}))},e.serialize===JSON.stringify&&e.data&&"GET"!==e.method&&r.setRequestHeader("Content-Type","application/json; charset=utf-8"),e.deserialize===JSON.parse&&r.setRequestHeader("Accept","application/json, text/*"),t(e.config)){var a=e.config(r,e);null!=a&&(r=a)}var o="GET"!==e.method&&e.data?e.data:"";if(o&&!i(o)&&o.constructor!==n.FormData)throw new Error("Request data should be either be a string or FormData. Check the `serialize` option in `m.request`");return r.send(o),r}function _n(n){return n.dataType&&"jsonp"===n.dataType.toLowerCase()?vn(n):yn(n)}function bn(n,e,t){if("GET"===n.method&&"jsonp"!==n.dataType){var r=n.url.indexOf("?")<0?"?":"&",i=fn(e);n.url+=i?r+i:""}else n.data=t(e)}function wn(n,e){return e&&(n=n.replace(/:[a-z]\w+/gi,function(n){var t=n.slice(1),r=e[t];return delete e[t],r})),n}c.version=function(){return"v0.2.3"};var xn,kn,jn,Cn,An={}.hasOwnProperty,On={}.toString,En=Array.isArray||function(n){return"[object Array]"===On.call(n)},Rn={AREA:1,BASE:1,BR:1,COL:1,COMMAND:1,EMBED:1,HR:1,IMG:1,INPUT:1,KEYGEN:1,LINK:1,META:1,PARAM:1,SOURCE:1,TRACK:1,WBR:1};c.deps=function(e){return o(n=e||window),n},c.deps(n);var Sn=1,In=2,Tn=3,Mn=0;c.startComputation=function(){Mn++},c.endComputation=function(){Mn>1?Mn--:(Mn=0,c.redraw())};var Ln,Pn=[],Dn=!1,Nn={list:1,style:1,form:1,type:1,width:1,height:1},$n={appendChild:function(n){Ln===e&&(Ln=xn.createElement("html")),xn.documentElement&&xn.documentElement!==n?xn.replaceChild(n,xn.documentElement):xn.appendChild(n),this.childNodes=xn.childNodes},insertBefore:function(n){this.appendChild(n)},childNodes:[]},qn=[],zn={};c.render=function(n,t,r){if(!n)throw new Error("Ensure the DOM element being passed to m.route/m.mount/m.render is not undefined.");var i,a=[],o=X(n),u=n===xn;i=u||n===xn.documentElement?$n:n,u&&"html"!==t.tag&&(t={tag:"html",attrs:{},children:t}),zn[o]===e&&G(i.childNodes),r===!0&&hn(n),zn[o]=B(i,null,e,e,t,zn[o],!1,0,null,e,a),f(a,function(n){n()})},c.trust=function(n){return n=new String(n),n.$trusted=!0,n},c.prop=function(n){return(null!=n&&r(n)||t(n))&&t(n.then)?pn(n):nn(n)};var Fn,Bn=[],Un=[],Kn=[],Wn=null,Vn=0,Hn=null,Gn=null,Jn=16;c.component=function(n){var e=[].slice.call(arguments,1);return en(n,e)},c.mount=c.module=function(n,e){if(!n)throw new Error("Please ensure the DOM element exists before rendering a template into it.");var r=Bn.indexOf(n);0>r&&(r=Bn.length);var i=!1,a={preventDefault:function(){i=!0,Hn=Gn=null}};return f(Pn,function(n){n.handler.call(n.controller,a),n.controller.onunload=null}),i?f(Pn,function(n){n.controller.onunload=n.handler}):Pn=[],Kn[r]&&t(Kn[r].onunload)&&Kn[r].onunload(a),tn(e,n,r,i)};var Yn=!1;c.redraw=function(e){if(!Yn){Yn=!0,e&&(Dn=!0);try{Wn&&!e?(jn===n.requestAnimationFrame||new Date-Vn>Jn)&&(Wn>0&&Cn(Wn),Wn=jn(an,Jn)):(an(),Wn=jn(function(){Wn=null},Jn))}finally{Yn=Dn=!1}}},c.redraw.strategy=c.prop(),c.withAttr=function(n,e,t){return function(r){r=r||event;var i=r.currentTarget||this,a=t||this,o=n in i?i[n]:i.getAttribute(n);e.call(a,o)}};var Zn,Qn,Xn={pathname:"",hash:"#",search:"?"},ne=a,ee=!1;c.route=function(e,t,r,a){if(0===arguments.length)return Qn;if(3===arguments.length&&i(t)){ne=function(n){var i=Qn=un(n);if(!sn(e,r,i)){if(ee)throw new Error("Ensure the default route matches one of the routes defined in m.route");ee=!0,c.route(t,!0),ee=!1}};var o="hash"===c.route.mode?"onhashchange":"onpopstate";return n[o]=function(){var n=kn[c.route.mode];"pathname"===c.route.mode&&(n+=kn.search),Qn!==un(n)&&ne(n)},Hn=cn,void n[o]()}if(e.addEventListener||e.attachEvent){var u="pathname"!==c.route.mode?kn.pathname:"";return e.href=u+Xn[c.route.mode]+a.attrs.href,void(e.addEventListener?(e.removeEventListener("click",ln),e.addEventListener("click",ln)):(e.detachEvent("onclick",ln),e.attachEvent("onclick",ln)))}if(i(e)){var s=Qn;Qn=e;var l,f=t||{},d=Qn.indexOf("?");l=d>-1?dn(Qn.slice(d+1)):{};for(var h in f)An.call(f,h)&&(l[h]=f[h]);var p,g=fn(l);p=d>-1?Qn.slice(0,d):Qn,g&&(Qn=p+(-1===p.indexOf("?")?"?":"&")+g);var m=(3===arguments.length?r:t)===!0||s===e;if(n.history.pushState){var v=m?"replaceState":"pushState";Hn=cn,Gn=function(){n.history[v](null,xn.title,Xn[c.route.mode]+Qn)},ne(Xn[c.route.mode]+Qn)}else kn[c.route.mode]=Qn,ne(Xn[c.route.mode]+Qn)}},c.route.param=function(n){if(!Zn)throw new Error("You must call m.route(element, defaultRoute, routes) before calling m.route.param()");return n?Zn[n]:Zn},c.route.mode="search",c.route.buildQueryString=fn,c.route.parseQueryString=dn,c.deferred=function(){var n=new gn;return n.promise=pn(n.promise),n};var te=1,re=2,ie=3,ae=4;return c.deferred.onerror=function(n){if("[object Error]"===On.call(n)&&!/ Error/.test(n.constructor.toString()))throw Mn=0,n},c.sync=function(n){function e(n,e){return function(o){return i[n]=o,e||(a="reject"),0===--r&&(t.promise(i),t[a](i)),o}}var t=c.deferred(),r=n.length,i=new Array(r),a="resolve";return n.length>0?f(n,function(n,t){n.then(e(t,!0),e(t,!1))}):t.resolve([]),t.promise},c.request=function(n){n.background!==!0&&c.startComputation();var e,t,r,i=new gn,a=n.dataType&&"jsonp"===n.dataType.toLowerCase();return a?(e=n.serialize=t=n.deserialize=mn,r=function(n){return n.responseText}):(e=n.serialize=n.serialize||JSON.stringify,t=n.deserialize=n.deserialize||JSON.parse,r=n.extract||function(n){return n.responseText.length||t!==JSON.parse?n.responseText:null}),n.method=(n.method||"GET").toUpperCase(),n.url=wn(n.url,n.data),bn(n,n.data,e),n.onload=n.onerror=function(e){try{e=e||event;var a=t(r(e.target,n));"load"===e.type?(n.unwrapSuccess&&(a=n.unwrapSuccess(a,e.target)),En(a)&&n.type?f(a,function(e,t){a[t]=new n.type(e)}):n.type&&(a=new n.type(a)),i.resolve(a)):(n.unwrapError&&(a=n.unwrapError(a,e.target)),i.reject(a))}catch(o){i.reject(o)}finally{n.background!==!0&&c.endComputation()}},_n(n),i.promise=pn(i.promise,n.initialValue),i.promise},c})}).call(e,t(2)(n))},function(n,e){n.exports=function(n){return n.webpackPolyfill||(n.deprecate=function(){},n.paths=[],n.children=[],n.webpackPolyfill=1),n}},function(n,e,t){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}Object.defineProperty(e,"__esModule",{value:!0});var i=t(4),a=r(i),o=t(5),u=r(o);e["default"]={controller:a["default"],view:u["default"]}},function(n,e){"use strict";function t(){return{}}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=t},function(n,e,t){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}function i(n){return(0,o["default"])("div#top-header",[(0,o["default"])("figure#img-wrapper",[(0,o["default"])('a[href="/blog"]',{config:o["default"].route},(0,o["default"])('img#top-img[src="../../../assets/img/avatar.png"]'))]),(0,o["default"])("div#social-links",[(0,o["default"])('a[href="https://github.com/mtwtkman"]',(0,o["default"])("i.fa.fa-github-alt.my-i-size")),(0,o["default"])('a[href="https://twitter.com/mtwtkman"]',(0,o["default"])("i.fa.fa-twitter.my-i-size")),(0,o["default"])('a[href="rss.xml"]',(0,o["default"])("i.fa.fa-rss.my-i-size"))])])}Object.defineProperty(e,"__esModule",{value:!0});var a=t(1),o=r(a);e["default"]=i},function(n,e,t){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}Object.defineProperty(e,"__esModule",{value:!0});var i=t(7),a=r(i),o=t(30),u=r(o);e["default"]={controller:a["default"],view:u["default"]}},function(n,e,t){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}function i(){return{props:(0,u["default"])()}}Object.defineProperty(e,"__esModule",{value:!0});var a=t(1),o=(r(a),t(8)),u=r(o);e["default"]=i},function(n,e,t){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}function i(){var n=o["default"].parseYaml();return n.map(function(n){return{title:n.title,date:n.date,href:n.date.split(" ")[0]+"/"+n.slug}})}Object.defineProperty(e,"__esModule",{value:!0});var a=t(9),o=r(a);e["default"]=i},function(n,e,t){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}function i(){return o["default"].compact(s["default"].split("\n").map(function(n){var e=t(12)("./"+n);return e.publish?e:void 0}))}Object.defineProperty(e,"__esModule",{value:!0});var a=t(10),o=r(a),u=t(11),s=r(u);e["default"]={parseYaml:i}},function(n,e,t){var r;(function(n,i){(function(){function a(n,e){return n.set(e[0],e[1]),n}function o(n,e){return n.add(e),n}function u(n,e,t){var r=t.length;switch(r){case 0:return n.call(e);case 1:return n.call(e,t[0]);case 2:return n.call(e,t[0],t[1]);case 3:return n.call(e,t[0],t[1],t[2])}return n.apply(e,t)}function s(n,e,t,r){for(var i=-1,a=n.length;++i<a;){var o=n[i];e(r,o,t(o),n)}return r}function l(n,e){for(var t=-1,r=n.length,i=-1,a=e.length,o=Array(r+a);++t<r;)o[t]=n[t];for(;++i<a;)o[t++]=e[i];return o}function c(n,e){for(var t=-1,r=n.length;++t<r&&e(n[t],t,n)!==!1;);return n}function f(n,e){for(var t=n.length;t--&&e(n[t],t,n)!==!1;);return n}function d(n,e){for(var t=-1,r=n.length;++t<r;)if(!e(n[t],t,n))return!1;return!0}function h(n,e){for(var t=-1,r=n.length,i=-1,a=[];++t<r;){var o=n[t];e(o,t,n)&&(a[++i]=o)}return a}function p(n,e){return!!n.length&&j(n,e,0)>-1}function g(n,e,t){for(var r=-1,i=n.length;++r<i;)if(t(e,n[r]))return!0;return!1}function m(n,e){for(var t=-1,r=n.length,i=Array(r);++t<r;)i[t]=e(n[t],t,n);return i}function v(n,e){for(var t=-1,r=e.length,i=n.length;++t<r;)n[i+t]=e[t];return n}function y(n,e,t,r){var i=-1,a=n.length;for(r&&a&&(t=n[++i]);++i<a;)t=e(t,n[i],i,n);return t}function _(n,e,t,r){var i=n.length;for(r&&i&&(t=n[--i]);i--;)t=e(t,n[i],i,n);return t}function b(n,e){for(var t=-1,r=n.length;++t<r;)if(e(n[t],t,n))return!0;return!1}function w(n,e,t){for(var r=-1,i=n.length;++r<i;){var a=n[r],o=e(a);if(null!=o&&(u===Q?o===o:t(o,u)))var u=o,s=a}return s}function x(n,e,t,r){var i;return t(n,function(n,t,a){return e(n,t,a)?(i=r?t:n,!1):void 0}),i}function k(n,e,t){for(var r=n.length,i=t?r:-1;t?i--:++i<r;)if(e(n[i],i,n))return i;return-1}function j(n,e,t){if(e!==e)return F(n,t);for(var r=t-1,i=n.length;++r<i;)if(n[r]===e)return r;return-1}function C(n,e,t,r,i){return i(n,function(n,i,a){t=r?(r=!1,n):e(t,n,i,a)}),t}function A(n,e){var t=n.length;for(n.sort(e);t--;)n[t]=n[t].value;return n}function O(n,e){for(var t,r=-1,i=n.length;++r<i;){var a=e(n[r]);a!==Q&&(t=t===Q?a:t+a)}return t}function E(n,e){for(var t=-1,r=Array(n);++t<n;)r[t]=e(t);return r}function R(n,e){return m(e,function(e){return[e,n[e]]})}function S(n){return function(e){return n(e)}}function I(n,e){return m(e,function(e){return n[e]})}function T(n,e){for(var t=-1,r=n.length;++t<r&&j(e,n[t],0)>-1;);return t}function M(n,e){for(var t=n.length;t--&&j(e,n[t],0)>-1;);return t}function L(n){return n&&n.Object===Object?n:null}function P(n,e){if(n!==e){var t=null===n,r=n===Q,i=n===n,a=null===e,o=e===Q,u=e===e;if(n>e&&!a||!i||t&&!o&&u||r&&u)return 1;if(e>n&&!t||!u||a&&!r&&i||o&&i)return-1}return 0}function D(n,e,t){for(var r=-1,i=n.criteria,a=e.criteria,o=i.length,u=t.length;++r<o;){var s=P(i[r],a[r]);if(s){if(r>=u)return s;var l=t[r];return s*("desc"==l?-1:1)}}return n.index-e.index}function N(n,e){for(var t=n.length,r=0;t--;)n[t]===e&&r++;return r}function $(n){return kt[n]}function q(n){return jt[n]}function z(n){return"\\"+Ot[n]}function F(n,e,t){for(var r=n.length,i=e+(t?0:-1);t?i--:++i<r;){var a=n[i];if(a!==a)return i}return-1}function B(n){var e=!1;if(null!=n&&"function"!=typeof n.toString)try{e=!!(n+"")}catch(t){}return e}function U(n,e){return n="number"==typeof n||Re.test(n)?+n:-1,e=null==e?jn:e,n>-1&&n%1==0&&e>n}function K(n){for(var e,t=[];!(e=n.next()).done;)t.push(e.value);return t}function W(n){var e=-1,t=Array(n.size);return n.forEach(function(n,r){t[++e]=[r,n]}),t}function V(n,e){for(var t=-1,r=n.length,i=-1,a=[];++t<r;){var o=n[t];o!==e&&o!==Sn||(n[t]=Sn,a[++i]=t)}return a}function H(n){var e=-1,t=Array(n.size);return n.forEach(function(n){t[++e]=n}),t}function G(n){if(!n||!gt.test(n))return n.length;for(var e=pt.lastIndex=0;pt.test(n);)e++;return e}function J(n){return n.match(pt)}function Y(n){return Ct[n]}function Z(n){function e(n){if(qo(n)&&!wc(n)&&!(n instanceof i)){if(n instanceof r)return n;if(Ks.call(n,"__wrapped__"))return Mi(n)}return new r(n)}function t(){}function r(n,e){this.__wrapped__=n,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=Q}function i(n){this.__wrapped__=n,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=On,this.__views__=[]}function L(){var n=new i(this.__wrapped__);return n.__actions__=$r(this.__actions__),n.__dir__=this.__dir__,n.__filtered__=this.__filtered__,n.__iteratees__=$r(this.__iteratees__),n.__takeCount__=this.__takeCount__,n.__views__=$r(this.__views__),n}function Re(){if(this.__filtered__){var n=new i(this);n.__dir__=-1,n.__filtered__=!0}else n=this.clone(),n.__dir__*=-1;return n}function Me(){var n=this.__wrapped__.value(),e=this.__dir__,t=wc(n),r=0>e,i=t?n.length:0,a=mi(0,i,this.__views__),o=a.start,u=a.end,s=u-o,l=r?u:o-1,c=this.__iteratees__,f=c.length,d=0,h=gl(s,this.__takeCount__);if(!t||vn>i||i==s&&h==s)return Ar(n,this.__actions__);var p=[];n:for(;s--&&h>d;){l+=e;for(var g=-1,m=n[l];++g<f;){var v=c[g],y=v.iteratee,_=v.type,b=y(m);if(_==_n)m=b;else if(!b){if(_==yn)continue n;break n}}p[d++]=m}return p}function Le(){}function Pe(n,e){return Ne(n,e)&&delete n[e]}function De(n,e){if(xl){var t=n[e];return t===xn?Q:t}return Ks.call(n,e)?n[e]:Q}function Ne(n,e){return xl?n[e]!==Q:Ks.call(n,e)}function $e(n,e,t){n[e]=xl&&t===Q?xn:t}function qe(n){var e=-1,t=n?n.length:0;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}function ze(){this.__data__={hash:new Le,map:_l?new _l:[],string:new Le}}function Fe(n){var e=this.__data__;return ji(n)?Pe("string"==typeof n?e.string:e.hash,n):_l?e.map["delete"](n):nt(e.map,n)}function Be(n){var e=this.__data__;return ji(n)?De("string"==typeof n?e.string:e.hash,n):_l?e.map.get(n):et(e.map,n)}function Ue(n){var e=this.__data__;return ji(n)?Ne("string"==typeof n?e.string:e.hash,n):_l?e.map.has(n):tt(e.map,n)}function Ke(n,e){var t=this.__data__;return ji(n)?$e("string"==typeof n?t.string:t.hash,n,e):_l?t.map.set(n,e):it(t.map,n,e),this}function We(n){var e=-1,t=n?n.length:0;for(this.__data__=new qe;++e<t;)this.push(n[e])}function Ve(n,e){var t=n.__data__;if(ji(e)){var r=t.__data__,i="string"==typeof e?r.string:r.hash;return i[e]===xn}return t.has(e)}function He(n){var e=this.__data__;if(ji(n)){var t=e.__data__,r="string"==typeof n?t.string:t.hash;r[n]=xn}else e.set(n,xn)}function Ge(n){var e=-1,t=n?n.length:0;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}function Je(){this.__data__={array:[],map:null}}function Ye(n){var e=this.__data__,t=e.array;return t?nt(t,n):e.map["delete"](n)}function Ze(n){var e=this.__data__,t=e.array;return t?et(t,n):e.map.get(n)}function Qe(n){var e=this.__data__,t=e.array;return t?tt(t,n):e.map.has(n)}function Xe(n,e){var t=this.__data__,r=t.array;r&&(r.length<vn-1?it(r,n,e):(t.array=null,t.map=new qe(r)));var i=t.map;return i&&i.set(n,e),this}function nt(n,e){var t=rt(n,e);if(0>t)return!1;var r=n.length-1;return t==r?n.pop():sl.call(n,t,1),!0}function et(n,e){var t=rt(n,e);return 0>t?Q:n[t][1]}function tt(n,e){return rt(n,e)>-1}function rt(n,e){for(var t=n.length;t--;)if(bo(n[t][0],e))return t;return-1}function it(n,e,t){var r=rt(n,e);0>r?n.push([e,t]):n[r][1]=t}function at(n,e,t,r){return n===Q||bo(n,Bs[t])&&!Ks.call(r,t)?e:n}function ot(n,e,t){(t===Q||bo(n[e],t))&&("number"!=typeof e||t!==Q||e in n)||(n[e]=t)}function ut(n,e,t){var r=n[e];Ks.call(n,e)&&bo(r,t)&&(t!==Q||e in n)||(n[e]=t)}function st(n,e,t,r){return Il(n,function(n,i,a){e(r,n,t(n),a)}),r}function lt(n,e){return n&&qr(e,Cu(e),n)}function ct(n,e){for(var t=-1,r=null==n,i=e.length,a=Array(i);++t<i;)a[t]=r?Q:xu(n,e[t]);return a}function ft(n){return Ao(n)?n:[]}function dt(n){return"function"==typeof n?n:ps}function pt(n){return wc(n)?n:Ti(n)}function kt(n,e,t){return n===n&&(t!==Q&&(n=t>=n?n:t),e!==Q&&(n=n>=e?n:e)),n}function jt(n,e,t,r,i,a){var o;if(t&&(o=i?t(n,r,i,a):t(n)),o!==Q)return o;if(!$o(n))return n;var u=wc(n);if(u){if(o=yi(n),!e)return $r(n,o)}else{var s=gi(n),l=s==Dn||s==Nn;if(xc(n))return Rr(n,e);if(s==zn||s==In||l&&!i){if(B(n))return i?n:{};if(o=_i(l?{}:n),!e)return Fr(n,lt(o,n))}else{if(!xt[s])return i?n:{};o=bi(n,s,e)}}a||(a=new Ge);var f=a.get(n);return f?f:(a.set(n,o),(u?c:qt)(n,function(r,i){ut(o,i,jt(r,e,t,i,n,a))}),u?o:Fr(n,o))}function Ct(n){var e=Cu(n),t=e.length;return function(r){if(null==r)return!t;for(var i=t;i--;){var a=e[i],o=n[a],u=r[a];if(u===Q&&!(a in Object(r))||!o(u))return!1}return!0}}function At(n){return $o(n)?al(n):{}}function Ot(n,e,t){if("function"!=typeof n)throw new zs(wn);return ul(function(){n.apply(Q,t)},e)}function St(n,e,t,r){var i=-1,a=p,o=!0,u=n.length,s=[],l=e.length;if(!u)return s;t&&(e=m(e,S(t))),r?(a=g,o=!1):e.length>=vn&&(a=Ve,o=!1,e=new We(e));n:for(;++i<u;){var c=n[i],f=t?t(c):c;if(o&&f===f){for(var d=l;d--;)if(e[d]===f)continue n;s.push(c)}else a(e,f,r)||s.push(c)}return s}function It(n,e){var t=!0;return Il(n,function(n,r,i){return t=!!e(n,r,i)}),t}function Mt(n,e,t,r){var i=n.length;for(t=uu(t),0>t&&(t=-t>i?0:i+t),r=r===Q||r>i?i:uu(r),0>r&&(r+=i),r=t>r?0:su(r);r>t;)n[t++]=e;return n}function Lt(n,e){var t=[];return Il(n,function(n,r,i){e(n,r,i)&&t.push(n)}),t}function Pt(n,e,t,r){r||(r=[]);for(var i=-1,a=n.length;++i<a;){var o=n[i];e>0&&Ao(o)&&(t||wc(o)||ko(o))?e>1?Pt(o,e-1,t,r):v(r,o):t||(r[r.length]=o)}return r}function Dt(n,e){return null==n?n:Ml(n,e,Au)}function qt(n,e){return n&&Ml(n,e,Cu)}function zt(n,e){return n&&Ll(n,e,Cu)}function Ft(n,e){
return h(e,function(e){return Po(n[e])})}function Bt(n,e){e=ki(e,n)?[e+""]:pt(e);for(var t=0,r=e.length;null!=n&&r>t;)n=n[e[t++]];return t&&t==r?n:Q}function Ut(n,e){return Ks.call(n,e)||"object"==typeof n&&e in n&&null===tl(n)}function Kt(n,e){return e in Object(n)}function Wt(n,e,t){return n>=gl(e,t)&&n<pl(e,t)}function Vt(n,e,t){for(var r=t?g:p,i=n.length,a=i,o=Array(i),u=[];a--;){var s=n[a];a&&e&&(s=m(s,S(e))),o[a]=!t&&(e||s.length>=120)?new We(a&&s):Q}s=n[0];var l=-1,c=s.length,f=o[0];n:for(;++l<c;){var d=s[l],h=e?e(d):d;if(!(f?Ve(f,h):r(u,h,t))){for(var a=i;--a;){var v=o[a];if(!(v?Ve(v,h):r(n[a],h,t)))continue n}f&&f.push(h),u.push(d)}}return u}function Ht(n,e,t,r){return qt(n,function(n,i,a){e(r,t(n),i,a)}),r}function Gt(n,e,t){ki(e,n)||(e=pt(e),n=Si(n,e),e=Zi(e));var r=null==n?n:n[e];return null==r?Q:u(r,n,t)}function Jt(n,e,t,r,i){return n===e?!0:null==n||null==e||!$o(n)&&!qo(e)?n!==n&&e!==e:Yt(n,e,Jt,t,r,i)}function Yt(n,e,t,r,i,a){var o=wc(n),u=wc(e),s=Tn,l=Tn;o||(s=gi(n),s==In?s=zn:s!=zn&&(o=nu(n))),u||(l=gi(e),l==In?l=zn:l!=zn&&(u=nu(e)));var c=s==zn&&!B(n),f=l==zn&&!B(e),d=s==l;if(d&&!o&&!c)return si(n,e,s,t,r,i);var h=i&dn;if(!h){var p=c&&Ks.call(n,"__wrapped__"),g=f&&Ks.call(e,"__wrapped__");if(p||g)return t(p?n.value():n,g?e.value():e,r,i,a)}return d?(a||(a=new Ge),(o?ui:li)(n,e,t,r,i,a)):!1}function Zt(n,e,t,r){var i=t.length,a=i,o=!r;if(null==n)return!a;for(n=Object(n);i--;){var u=t[i];if(o&&u[2]?u[1]!==n[u[0]]:!(u[0]in n))return!1}for(;++i<a;){u=t[i];var s=u[0],l=n[s],c=u[1];if(o&&u[2]){if(l===Q&&!(s in n))return!1}else{var f=new Ge,d=r?r(l,c,s,n,e,f):Q;if(!(d===Q?Jt(c,l,r,fn|dn,f):d))return!1}}return!0}function Qt(n){var e=typeof n;return"function"==e?n:null==n?ps:"object"==e?wc(n)?rr(n[0],n[1]):tr(n):xs(n)}function Xt(n){return hl(Object(n))}function nr(n){n=null==n?n:Object(n);var e=[];for(var t in n)e.push(t);return e}function er(n,e){var t=-1,r=Co(n)?Array(n.length):[];return Il(n,function(n,i,a){r[++t]=e(n,i,a)}),r}function tr(n){var e=di(n);if(1==e.length&&e[0][2]){var t=e[0][0],r=e[0][1];return function(n){return null==n?!1:n[t]===r&&(r!==Q||t in Object(n))}}return function(t){return t===n||Zt(t,n,e)}}function rr(n,e){return function(t){var r=xu(t,n);return r===Q&&r===e?ju(t,n):Jt(e,r,Q,fn|dn)}}function ir(n,e,t,r,i){if(n!==e){var a=wc(e)||nu(e)?Q:Au(e);c(a||e,function(o,u){if(a&&(u=o,o=e[u]),$o(o))i||(i=new Ge),ar(n,e,u,t,ir,r,i);else{var s=r?r(n[u],o,u+"",n,e,i):Q;s===Q&&(s=o),ot(n,u,s)}})}}function ar(n,e,t,r,i,a,o){var u=n[t],s=e[t],l=o.get(s);if(l)return void ot(n,t,l);var c=a?a(u,s,t+"",n,e,o):Q,f=c===Q;f&&(c=s,wc(s)||nu(s)?wc(u)?c=u:Ao(u)?c=$r(u):(f=!1,c=jt(s,!0)):Go(s)||ko(s)?ko(u)?c=cu(u):!$o(u)||r&&Po(u)?(f=!1,c=jt(s,!0)):c=u:f=!1),o.set(s,c),f&&i(c,s,r,a,o),ot(n,t,c)}function or(n,e,t){var r=-1,i=fi();e=m(e.length?e:Array(1),function(n){return i(n)});var a=er(n,function(n,t,i){var a=m(e,function(e){return e(n)});return{criteria:a,index:++r,value:n}});return A(a,function(n,e){return D(n,e,t)})}function ur(n,e){return n=Object(n),y(e,function(e,t){return t in n&&(e[t]=n[t]),e},{})}function sr(n,e){var t={};return Dt(n,function(n,r){e(n,r)&&(t[r]=n)}),t}function lr(n){return function(e){return null==e?Q:e[n]}}function cr(n){return function(e){return Bt(e,n)}}function fr(n,e){return dr(n,e)}function dr(n,e,t){var r=-1,i=e.length,a=n;for(t&&(a=m(n,function(n){return t(n)}));++r<i;)for(var o=0,u=e[r],s=t?t(u):u;(o=j(a,s,o))>-1;)a!==n&&sl.call(a,o,1),sl.call(n,o,1);return n}function hr(n,e){for(var t=n?e.length:0,r=t-1;t--;){var i=e[t];if(r==t||i!=a){var a=i;if(U(i))sl.call(n,i,1);else if(ki(i,n))delete n[i];else{var o=pt(i),u=Si(n,o);null!=u&&delete u[Zi(o)]}}}return n}function pr(n,e){return n+cl(vl()*(e-n+1))}function gr(n,e,t,r){for(var i=-1,a=pl(ll((e-n)/(t||1)),0),o=Array(a);a--;)o[r?a:++i]=n,n+=t;return o}function mr(n,e,t,r){e=ki(e,n)?[e+""]:pt(e);for(var i=-1,a=e.length,o=a-1,u=n;null!=u&&++i<a;){var s=e[i];if($o(u)){var l=t;if(i!=o){var c=u[s];l=r?r(c,s,u):Q,l===Q&&(l=null==c?U(e[i+1])?[]:{}:c)}ut(u,s,l)}u=u[s]}return n}function vr(n,e,t){var r=-1,i=n.length;0>e&&(e=-e>i?0:i+e),t=t>i?i:t,0>t&&(t+=i),i=e>t?0:t-e>>>0,e>>>=0;for(var a=Array(i);++r<i;)a[r]=n[r+e];return a}function yr(n,e){var t;return Il(n,function(n,r,i){return t=e(n,r,i),!t}),!!t}function _r(n,e,t){var r=0,i=n?n.length:r;if("number"==typeof e&&e===e&&Rn>=i){for(;i>r;){var a=r+i>>>1,o=n[a];(t?e>=o:e>o)&&null!==o?r=a+1:i=a}return i}return br(n,e,ps,t)}function br(n,e,t,r){e=t(e);for(var i=0,a=n?n.length:0,o=e!==e,u=null===e,s=e===Q;a>i;){var l=cl((i+a)/2),c=t(n[l]),f=c!==Q,d=c===c;if(o)var h=d||r;else h=u?d&&f&&(r||null!=c):s?d&&(r||f):null==c?!1:r?e>=c:e>c;h?i=l+1:a=l}return gl(a,En)}function wr(n){return xr(n)}function xr(n,e){for(var t=0,r=n.length,i=n[0],a=e?e(i):i,o=a,u=0,s=[i];++t<r;)i=n[t],a=e?e(i):i,bo(a,o)||(o=a,s[++u]=i);return s}function kr(n,e,t){var r=-1,i=p,a=n.length,o=!0,u=[],s=u;if(t)o=!1,i=g;else if(a>=vn){var l=e?null:Dl(n);if(l)return H(l);o=!1,i=Ve,s=new We}else s=e?[]:u;n:for(;++r<a;){var c=n[r],f=e?e(c):c;if(o&&f===f){for(var d=s.length;d--;)if(s[d]===f)continue n;e&&s.push(f),u.push(c)}else i(s,f,t)||(s!==u&&s.push(f),u.push(c))}return u}function jr(n,e){e=ki(e,n)?[e+""]:pt(e),n=Si(n,e);var t=Zi(e);return null!=n&&ku(n,t)?delete n[t]:!0}function Cr(n,e,t,r){for(var i=n.length,a=r?i:-1;(r?a--:++a<i)&&e(n[a],a,n););return t?vr(n,r?0:a,r?a+1:i):vr(n,r?a+1:0,r?i:a)}function Ar(n,e){var t=n;return t instanceof i&&(t=t.value()),y(e,function(n,e){return e.func.apply(e.thisArg,v([n],e.args))},t)}function Or(n,e,t){for(var r=-1,i=n.length;++r<i;)var a=a?v(St(a,n[r],e,t),St(n[r],a,e,t)):n[r];return a&&a.length?kr(a,e,t):[]}function Er(n,e,t){for(var r=-1,i=n.length,a=e.length,o={};++r<i;)t(o,n[r],a>r?e[r]:Q);return o}function Rr(n,e){if(e)return n.slice();var t=n.constructor,r=new t(n.length);return n.copy(r),r}function Sr(n){var e=n.constructor,t=new e(n.byteLength),r=new Xs(t);return r.set(new Xs(n)),t}function Ir(n){var e=n.constructor;return y(W(n),a,new e)}function Tr(n){var e=n.constructor,t=new e(n.source,ke.exec(n));return t.lastIndex=n.lastIndex,t}function Mr(n){var e=n.constructor;return y(H(n),o,new e)}function Lr(n){return Qs?Object(El.call(n)):{}}function Pr(n,e){var t=n.buffer,r=e?Sr(t):t,i=n.constructor;return new i(r,n.byteOffset,n.length)}function Dr(n,e,t,r){for(var i=-1,a=n.length,o=t.length,u=-1,s=e.length,l=pl(a-o,0),c=Array(s+l),f=!r;++u<s;)c[u]=e[u];for(;++i<o;)(f||a>i)&&(c[t[i]]=n[i]);for(;l--;)c[u++]=n[i++];return c}function Nr(n,e,t,r){for(var i=-1,a=n.length,o=-1,u=t.length,s=-1,l=e.length,c=pl(a-u,0),f=Array(c+l),d=!r;++i<c;)f[i]=n[i];for(var h=i;++s<l;)f[h+s]=e[s];for(;++o<u;)(d||a>i)&&(f[h+t[o]]=n[i++]);return f}function $r(n,e){var t=-1,r=n.length;for(e||(e=Array(r));++t<r;)e[t]=n[t];return e}function qr(n,e,t){return zr(n,e,t)}function zr(n,e,t,r){t||(t={});for(var i=-1,a=e.length;++i<a;){var o=e[i],u=r?r(t[o],n[o],o,t,n):n[o];ut(t,o,u)}return t}function Fr(n,e){return qr(n,ql(n),e)}function Br(n,e){return function(t,r){var i=wc(t)?s:st,a=e?e():{};return i(t,n,fi(r),a)}}function Ur(n){return lo(function(e,t){var r=-1,i=t.length,a=i>1?t[i-1]:Q,o=i>2?t[2]:Q;for(a="function"==typeof a?(i--,a):Q,o&&xi(t[0],t[1],o)&&(a=3>i?Q:a,i=1),e=Object(e);++r<i;){var u=t[r];u&&n(e,u,r,a)}return e})}function Kr(n,e){return function(t,r){if(null==t)return t;if(!Co(t))return n(t,r);for(var i=t.length,a=e?i:-1,o=Object(t);(e?a--:++a<i)&&r(o[a],a,o)!==!1;);return t}}function Wr(n){return function(e,t,r){for(var i=-1,a=Object(e),o=r(e),u=o.length;u--;){var s=o[n?u:++i];if(t(a[s],s,a)===!1)break}return e}}function Vr(n,e,t){function r(){var e=this&&this!==Nt&&this instanceof r?a:n;return e.apply(i?t:this,arguments)}var i=e&nn,a=Jr(n);return r}function Hr(n){return function(e){e=du(e);var t=gt.test(e)?J(e):Q,r=t?t[0]:e.charAt(0),i=t?t.slice(1).join(""):e.slice(1);return r[n]()+i}}function Gr(n){return function(e){return y(cs(Ku(e)),n,"")}}function Jr(n){return function(){var e=arguments;switch(e.length){case 0:return new n;case 1:return new n(e[0]);case 2:return new n(e[0],e[1]);case 3:return new n(e[0],e[1],e[2]);case 4:return new n(e[0],e[1],e[2],e[3]);case 5:return new n(e[0],e[1],e[2],e[3],e[4]);case 6:return new n(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new n(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var t=At(n.prototype),r=n.apply(t,e);return $o(r)?r:t}}function Yr(n,e,t){function r(){for(var a=arguments.length,o=Array(a),s=a,l=pi(r);s--;)o[s]=arguments[s];var c=3>a&&o[0]!==l&&o[a-1]!==l?[]:V(o,l);if(a-=c.length,t>a)return ii(n,e,Qr,r.placeholder,Q,o,c,Q,Q,t-a);var f=this&&this!==Nt&&this instanceof r?i:n;return u(f,this,o)}var i=Jr(n);return r}function Zr(n){return lo(function(e){e=Pt(e,1);var t=e.length,i=t,a=r.prototype.thru;for(n&&e.reverse();i--;){var o=e[i];if("function"!=typeof o)throw new zs(wn);if(a&&!u&&"wrapper"==ci(o))var u=new r([],!0)}for(i=u?i:t;++i<t;){o=e[i];var s=ci(o),l="wrapper"==s?Nl(o):Q;u=l&&Ci(l[0])&&l[1]==(sn|rn|on|ln)&&!l[4].length&&1==l[9]?u[ci(l[0])].apply(u,l[3]):1==o.length&&Ci(o)?u[s]():u.thru(o)}return function(){var n=arguments,r=n[0];if(u&&1==n.length&&wc(r)&&r.length>=vn)return u.plant(r).value();for(var i=0,a=t?e[i].apply(this,n):r;++i<t;)a=e[i].call(this,a);return a}})}function Qr(n,e,t,r,i,a,o,u,s,l){function c(){for(var v=arguments.length,y=v,_=Array(v);y--;)_[y]=arguments[y];if(p)var b=pi(c),w=N(_,b);if(r&&(_=Dr(_,r,i,p)),a&&(_=Nr(_,a,o,p)),v-=w,p&&l>v){var x=V(_,b);return ii(n,e,Qr,c.placeholder,t,_,x,u,s,l-v)}var k=d?t:this,j=h?k[n]:n;return v=_.length,u?_=Ii(_,u):g&&v>1&&_.reverse(),f&&v>s&&(_.length=s),this&&this!==Nt&&this instanceof c&&(j=m||Jr(j)),j.apply(k,_)}var f=e&sn,d=e&nn,h=e&en,p=e&(rn|an),g=e&cn,m=h?Q:Jr(n);return c}function Xr(n,e){return function(t,r){return Ht(t,n,e(r),{})}}function ni(n){return lo(function(e){return e=m(Pt(e,1),fi()),lo(function(t){var r=this;return n(e,function(n){return u(n,r,t)})})})}function ei(n,e,t){e=uu(e);var r=G(n);if(!e||r>=e)return"";var i=e-r;t=t===Q?" ":t+"";var a=Qu(t,ll(i/G(t)));return gt.test(t)?J(a).slice(0,i).join(""):a.slice(0,i)}function ti(n,e,t,r){function i(){for(var e=-1,s=arguments.length,l=-1,c=r.length,f=Array(c+s),d=this&&this!==Nt&&this instanceof i?o:n;++l<c;)f[l]=r[l];for(;s--;)f[l++]=arguments[++e];return u(d,a?t:this,f)}var a=e&nn,o=Jr(n);return i}function ri(n){return function(e,t,r){return r&&"number"!=typeof r&&xi(e,t,r)&&(t=r=Q),e=lu(e),e=e===e?e:0,t===Q?(t=e,e=0):t=lu(t)||0,r=r===Q?t>e?1:-1:lu(r)||0,gr(e,t,r,n)}}function ii(n,e,t,r,i,a,o,u,s,l){var c=e&rn,f=u?$r(u):Q,d=c?o:Q,h=c?Q:o,p=c?a:Q,g=c?Q:a;e|=c?on:un,e&=~(c?un:on),e&tn||(e&=~(nn|en));var m=[n,e,i,p,d,g,h,f,s,l],v=t.apply(Q,m);return Ci(n)&&zl(v,m),v.placeholder=r,v}function ai(n){var e=$s[n];return function(n,t){if(n=lu(n),t=uu(t)){var r=(du(n)+"e").split("e"),i=e(r[0]+"e"+(+r[1]+t));return r=(du(i)+"e").split("e"),+(r[0]+"e"+(+r[1]-t))}return e(n)}}function oi(n,e,t,r,i,a,o,u){var s=e&en;if(!s&&"function"!=typeof n)throw new zs(wn);var l=r?r.length:0;if(l||(e&=~(on|un),r=i=Q),o=o===Q?o:pl(uu(o),0),u=u===Q?u:uu(u),l-=i?i.length:0,e&un){var c=r,f=i;r=i=Q}var d=s?Q:Nl(n),h=[n,e,t,r,i,c,f,a,o,u];if(d&&Ei(h,d),n=h[0],e=h[1],t=h[2],r=h[3],i=h[4],u=h[9]=null==h[9]?s?0:n.length:pl(h[9]-l,0),!u&&e&(rn|an)&&(e&=~(rn|an)),e&&e!=nn)p=e==rn||e==an?Yr(n,e,u):e!=on&&e!=(nn|on)||i.length?Qr.apply(Q,h):ti(n,e,t,r);else var p=Vr(n,e,t);var g=d?Pl:zl;return g(p,h)}function ui(n,e,t,r,i,a){var o=-1,u=i&dn,s=i&fn,l=n.length,c=e.length;if(l!=c&&!(u&&c>l))return!1;var f=a.get(n);if(f)return f==e;var d=!0;for(a.set(n,e);++o<l;){var h=n[o],p=e[o];if(r)var g=u?r(p,h,o,e,n,a):r(h,p,o,n,e,a);if(g!==Q){if(g)continue;d=!1;break}if(s){if(!b(e,function(n){return h===n||t(h,n,r,i,a)})){d=!1;break}}else if(h!==p&&!t(h,p,r,i,a)){d=!1;break}}return a["delete"](n),d}function si(n,e,t,r,i,a){switch(t){case Hn:return!(n.byteLength!=e.byteLength||!r(new Xs(n),new Xs(e)));case Mn:case Ln:return+n==+e;case Pn:return n.name==e.name&&n.message==e.message;case qn:return n!=+n?e!=+e:n==+e;case Fn:case Un:return n==e+"";case $n:var o=W;case Bn:var u=a&dn;return o||(o=H),(u||n.size==e.size)&&r(o(n),o(e),i,a|fn);case Kn:return!!Qs&&El.call(n)==El.call(e)}return!1}function li(n,e,t,r,i,a){var o=i&dn,u=Cu(n),s=u.length,l=Cu(e),c=l.length;if(s!=c&&!o)return!1;for(var f=s;f--;){var d=u[f];if(!(o?d in e:Ut(e,d)))return!1}var h=a.get(n);if(h)return h==e;var p=!0;a.set(n,e);for(var g=o;++f<s;){d=u[f];var m=n[d],v=e[d];if(r)var y=o?r(v,m,d,e,n,a):r(m,v,d,n,e,a);if(!(y===Q?m===v||t(m,v,r,i,a):y)){p=!1;break}g||(g="constructor"==d)}if(p&&!g){var _=n.constructor,b=e.constructor;_!=b&&"constructor"in n&&"constructor"in e&&!("function"==typeof _&&_ instanceof _&&"function"==typeof b&&b instanceof b)&&(p=!1)}return a["delete"](n),p}function ci(n){for(var e=n.name+"",t=Sl[e],r=Ks.call(Sl,e)?t.length:0;r--;){var i=t[r],a=i.func;if(null==a||a==n)return i.name}return e}function fi(){var n=e.iteratee||gs;return n=n===gs?Qt:n,arguments.length?n(arguments[0],arguments[1]):n}function di(n){for(var e=Lu(n),t=e.length;t--;)e[t][2]=Oi(e[t][1]);return e}function hi(n,e){var t=null==n?Q:n[e];return Ko(t)?t:Q}function pi(n){var t=Ks.call(e,"placeholder")?e:n;return t.placeholder}function gi(n){return Hs.call(n)}function mi(n,e,t){for(var r=-1,i=t.length;++r<i;){var a=t[r],o=a.size;switch(a.type){case"drop":n+=o;break;case"dropRight":e-=o;break;case"take":e=gl(e,n+o);break;case"takeRight":n=pl(n,e-o)}}return{start:n,end:e}}function vi(n,e,t){if(null==n)return!1;var r=t(n,e);r||ki(e)||(e=pt(e),n=Si(n,e),null!=n&&(e=Zi(e),r=t(n,e)));var i=n?n.length:Q;return r||!!i&&No(i)&&U(e,i)&&(wc(n)||Qo(n)||ko(n))}function yi(n){var e=n.length,t=n.constructor(e);return e&&"string"==typeof n[0]&&Ks.call(n,"index")&&(t.index=n.index,t.input=n.input),t}function _i(n){return Po(n.constructor)&&!Ai(n)?At(tl(n)):{}}function bi(n,e,t){var r=n.constructor;switch(e){case Hn:return Sr(n);case Mn:case Ln:return new r(+n);case Gn:case Jn:case Yn:case Zn:case Qn:case Xn:case ne:case ee:case te:return Pr(n,t);case $n:return Ir(n);case qn:case Un:return new r(n);case Fn:return Tr(n);case Bn:return Mr(n);case Kn:return Lr(n)}}function wi(n){var e=n?n.length:Q;return No(e)&&(wc(n)||Qo(n)||ko(n))?E(e,String):null}function xi(n,e,t){if(!$o(t))return!1;var r=typeof e;return("number"==r?Co(t)&&U(e,t.length):"string"==r&&e in t)?bo(t[e],n):!1}function ki(n,e){return"number"==typeof n?!0:!wc(n)&&(pe.test(n)||!he.test(n)||null!=e&&n in Object(e))}function ji(n){var e=typeof n;return"number"==e||"boolean"==e||"string"==e&&"__proto__"!=n||null==n}function Ci(n){var t=ci(n),r=e[t];if("function"!=typeof r||!(t in i.prototype))return!1;if(n===r)return!0;var a=Nl(r);return!!a&&n===a[0]}function Ai(n){var e=n&&n.constructor,t=Po(e)&&e.prototype||Bs;return n===t}function Oi(n){return n===n&&!$o(n)}function Ei(n,e){var t=n[1],r=e[1],i=t|r,a=(nn|en|sn)>i,o=r==sn&&t==rn||r==sn&&t==ln&&n[7].length<=e[8]||r==(sn|ln)&&e[7].length<=e[8]&&t==rn;if(!a&&!o)return n;r&nn&&(n[2]=e[2],i|=t&nn?0:tn);var u=e[3];if(u){var s=n[3];n[3]=s?Dr(s,u,e[4]):$r(u),n[4]=s?V(n[3],Sn):$r(e[4])}return u=e[5],u&&(s=n[5],n[5]=s?Nr(s,u,e[6]):$r(u),n[6]=s?V(n[5],Sn):$r(e[6])),u=e[7],u&&(n[7]=$r(u)),r&sn&&(n[8]=null==n[8]?e[8]:gl(n[8],e[8])),null==n[9]&&(n[9]=e[9]),n[0]=e[0],n[1]=i,n}function Ri(n,e,t,r,i,a){return $o(n)&&$o(e)&&(a.set(e,n),ir(n,e,Q,Ri,a)),n}function Si(n,e){return 1==e.length?n:xu(n,vr(e,0,-1))}function Ii(n,e){for(var t=n.length,r=gl(e.length,t),i=$r(n);r--;){var a=e[r];n[r]=U(a,t)?i[a]:Q}return n}function Ti(n){var e=[];return du(n).replace(ge,function(n,t,r,i){e.push(r?i.replace(we,"$1"):t||n)}),e}function Mi(n){if(n instanceof i)return n.clone();var e=new r(n.__wrapped__,n.__chain__);return e.__actions__=$r(n.__actions__),e.__index__=n.__index__,e.__values__=n.__values__,e}function Li(n,e){e=pl(uu(e),0);var t=n?n.length:0;if(!t||1>e)return[];for(var r=0,i=-1,a=Array(ll(t/e));t>r;)a[++i]=vr(n,r,r+=e);return a}function Pi(n){for(var e=-1,t=n?n.length:0,r=-1,i=[];++e<t;){var a=n[e];a&&(i[++r]=a)}return i}function Di(n,e,t){var r=n?n.length:0;return r?(e=t||e===Q?1:uu(e),vr(n,0>e?0:e,r)):[]}function Ni(n,e,t){var r=n?n.length:0;return r?(e=t||e===Q?1:uu(e),e=r-e,vr(n,0,0>e?0:e)):[]}function $i(n,e){return n&&n.length?Cr(n,fi(e,3),!0,!0):[]}function qi(n,e){return n&&n.length?Cr(n,fi(e,3),!0):[]}function zi(n,e,t,r){var i=n?n.length:0;return i?(t&&"number"!=typeof t&&xi(n,e,t)&&(t=0,r=i),Mt(n,e,t,r)):[]}function Fi(n,e){return n&&n.length?k(n,fi(e,3)):-1}function Bi(n,e){return n&&n.length?k(n,fi(e,3),!0):-1}function Ui(n){var e=n?n.length:0;return e?Pt(n,1):[]}function Ki(n){var e=n?n.length:0;return e?Pt(n,kn):[]}function Wi(n,e){var t=n?n.length:0;return t?(e=e===Q?1:uu(e),Pt(n,e)):[]}function Vi(n){for(var e=-1,t=n?n.length:0,r={};++e<t;){var i=n[e];r[i[0]]=i[1]}return r}function Hi(n){return n?n[0]:Q}function Gi(n,e,t){var r=n?n.length:0;return r?(t=uu(t),0>t&&(t=pl(r+t,0)),j(n,e,t)):-1}function Ji(n){return Ni(n,1)}function Yi(n,e){return n?dl.call(n,e):""}function Zi(n){var e=n?n.length:0;return e?n[e-1]:Q}function Qi(n,e,t){var r=n?n.length:0;if(!r)return-1;var i=r;if(t!==Q&&(i=uu(t),i=(0>i?pl(r+i,0):gl(i,r-1))+1),e!==e)return F(n,i,!0);for(;i--;)if(n[i]===e)return i;return-1}function Xi(n,e){return n&&n.length&&e&&e.length?fr(n,e):n}function na(n,e,t){return n&&n.length&&e&&e.length?dr(n,e,fi(t)):n}function ea(n,e){var t=[];if(!n||!n.length)return t;var r=-1,i=[],a=n.length;for(e=fi(e,3);++r<a;){var o=n[r];e(o,r,n)&&(t.push(o),i.push(r))}return hr(n,i),t}function ta(n){return n?yl.call(n):n}function ra(n,e,t){var r=n?n.length:0;return r?(t&&"number"!=typeof t&&xi(n,e,t)?(e=0,t=r):(e=null==e?0:uu(e),t=t===Q?r:uu(t)),vr(n,e,t)):[]}function ia(n,e){return _r(n,e)}function aa(n,e,t){return br(n,e,fi(t))}function oa(n,e){var t=n?n.length:0;if(t){var r=_r(n,e);if(t>r&&bo(n[r],e))return r}return-1}function ua(n,e){return _r(n,e,!0)}function sa(n,e,t){return br(n,e,fi(t),!0)}function la(n,e){var t=n?n.length:0;if(t){var r=_r(n,e,!0)-1;if(bo(n[r],e))return r}return-1}function ca(n){return n&&n.length?wr(n):[]}function fa(n,e){return n&&n.length?xr(n,fi(e)):[]}function da(n){return Di(n,1)}function ha(n,e,t){return n&&n.length?(e=t||e===Q?1:uu(e),vr(n,0,0>e?0:e)):[]}function pa(n,e,t){var r=n?n.length:0;return r?(e=t||e===Q?1:uu(e),e=r-e,vr(n,0>e?0:e,r)):[]}function ga(n,e){return n&&n.length?Cr(n,fi(e,3),!1,!0):[]}function ma(n,e){return n&&n.length?Cr(n,fi(e,3)):[]}function va(n){return n&&n.length?kr(n):[]}function ya(n,e){return n&&n.length?kr(n,fi(e)):[]}function _a(n,e){return n&&n.length?kr(n,Q,e):[]}function ba(n){if(!n||!n.length)return[];var e=0;return n=h(n,function(n){return Ao(n)?(e=pl(n.length,e),!0):void 0}),E(e,function(e){return m(n,lr(e))})}function wa(n,e){if(!n||!n.length)return[];var t=ba(n);return null==e?t:m(t,function(n){return u(e,Q,n)})}function xa(n,e){return Er(n||[],e||[],ut)}function ka(n,e){return Er(n||[],e||[],mr)}function ja(n){var t=e(n);return t.__chain__=!0,t}function Ca(n,e){return e(n),n}function Aa(n,e){return e(n)}function Oa(){return ja(this)}function Ea(){return new r(this.value(),this.__chain__)}function Ra(n){return this.map(n).flatten()}function Sa(){this.__values__===Q&&(this.__values__=ou(this.value()));var n=this.__index__>=this.__values__.length,e=n?Q:this.__values__[this.__index__++];return{done:n,value:e}}function Ia(){return this}function Ta(n){for(var e,r=this;r instanceof t;){var i=Mi(r);i.__index__=0,i.__values__=Q,e?a.__wrapped__=i:e=i;var a=i;r=r.__wrapped__}return a.__wrapped__=n,e}function Ma(){var n=this.__wrapped__;if(n instanceof i){var e=n;return this.__actions__.length&&(e=new i(this)),e=e.reverse(),e.__actions__.push({func:Aa,args:[ta],thisArg:Q}),new r(e,this.__chain__)}return this.thru(ta)}function La(){return Ar(this.__wrapped__,this.__actions__)}function Pa(n,e,t){var r=wc(n)?d:It;return t&&xi(n,e,t)&&(e=Q),r(n,fi(e,3))}function Da(n,e){var t=wc(n)?h:Lt;return t(n,fi(e,3))}function Na(n,e){if(e=fi(e,3),wc(n)){var t=k(n,e);return t>-1?n[t]:Q}return x(n,e,Il)}function $a(n,e){if(e=fi(e,3),wc(n)){var t=k(n,e,!0);return t>-1?n[t]:Q}return x(n,e,Tl)}function qa(n,e){return Pt(Ua(n,e),1)}function za(n,e){return"function"==typeof e&&wc(n)?c(n,e):Il(n,dt(e))}function Fa(n,e){return"function"==typeof e&&wc(n)?f(n,e):Tl(n,dt(e))}function Ba(n,e,t,r){n=Co(n)?n:$u(n),t=t&&!r?uu(t):0;var i=n.length;return 0>t&&(t=pl(i+t,0)),Qo(n)?i>=t&&n.indexOf(e,t)>-1:!!i&&j(n,e,t)>-1}function Ua(n,e){var t=wc(n)?m:er;return t(n,fi(e,3))}function Ka(n,e,t,r){return null==n?[]:(wc(e)||(e=null==e?[]:[e]),t=r?Q:t,wc(t)||(t=null==t?[]:[t]),or(n,e,t))}function Wa(n,e,t){var r=wc(n)?y:C,i=arguments.length<3;return r(n,fi(e,4),t,i,Il)}function Va(n,e,t){var r=wc(n)?_:C,i=arguments.length<3;return r(n,fi(e,4),t,i,Tl)}function Ha(n,e){var t=wc(n)?h:Lt;return e=fi(e,3),t(n,function(n,t,r){return!e(n,t,r)})}function Ga(n){var e=Co(n)?n:$u(n),t=e.length;return t>0?e[pr(0,t-1)]:Q}function Ja(n,e){var t=-1,r=ou(n),i=r.length,a=i-1;for(e=kt(uu(e),0,i);++t<e;){var o=pr(t,a),u=r[o];r[o]=r[t],r[t]=u}return r.length=e,r}function Ya(n){return Ja(n,On)}function Za(n){if(null==n)return 0;if(Co(n)){var e=n.length;return e&&Qo(n)?G(n):e}return Cu(n).length}function Qa(n,e,t){var r=wc(n)?b:yr;return t&&xi(n,e,t)&&(e=Q),r(n,fi(e,3))}function Xa(n,e){if("function"!=typeof e)throw new zs(wn);return n=uu(n),function(){return--n<1?e.apply(this,arguments):void 0}}function no(n,e,t){return e=t?Q:e,e=n&&null==e?n.length:e,oi(n,sn,Q,Q,Q,Q,e)}function eo(n,e){var t;if("function"!=typeof e)throw new zs(wn);return n=uu(n),function(){return--n>0&&(t=e.apply(this,arguments)),1>=n&&(e=Q),t}}function to(n,e,t){e=t?Q:e;var r=oi(n,rn,Q,Q,Q,Q,Q,e);return r.placeholder=to.placeholder,r}function ro(n,e,t){e=t?Q:e;var r=oi(n,an,Q,Q,Q,Q,Q,e);return r.placeholder=ro.placeholder,r}function io(n,e,t){function r(){p&&nl(p),c&&nl(c),m=0,l=c=h=p=g=Q}function i(e,t){t&&nl(t),c=p=g=Q,e&&(m=dc(),f=n.apply(h,l),p||c||(l=h=Q))}function a(){var n=e-(dc()-d);0>=n||n>e?i(g,c):p=ul(a,n)}function o(){return(p&&g||c&&_)&&(f=n.apply(h,l)),r(),f}function u(){i(_,p)}function s(){if(l=arguments,d=dc(),h=this,g=_&&(p||!v),y===!1)var t=v&&!p;else{m||c||v||(m=d);var r=y-(d-m),i=(0>=r||r>y)&&(v||c);i?(c&&(c=nl(c)),m=d,f=n.apply(h,l)):c||(c=ul(u,r))}return i&&p?p=nl(p):p||e===y||(p=ul(a,e)),t&&(i=!0,f=n.apply(h,l)),!i||p||c||(l=h=Q),f}var l,c,f,d,h,p,g,m=0,v=!1,y=!1,_=!0;if("function"!=typeof n)throw new zs(wn);return e=lu(e)||0,$o(t)&&(v=!!t.leading,y="maxWait"in t&&pl(lu(t.maxWait)||0,e),_="trailing"in t?!!t.trailing:_),s.cancel=r,s.flush=o,s}function ao(n){return oi(n,cn)}function oo(n,e){if("function"!=typeof n||e&&"function"!=typeof e)throw new zs(wn);var t=function(){var r=arguments,i=e?e.apply(this,r):r[0],a=t.cache;if(a.has(i))return a.get(i);var o=n.apply(this,r);return t.cache=a.set(i,o),o};return t.cache=new oo.Cache,t}function uo(n){if("function"!=typeof n)throw new zs(wn);return function(){return!n.apply(this,arguments)}}function so(n){return eo(2,n)}function lo(n,e){if("function"!=typeof n)throw new zs(wn);return e=pl(e===Q?n.length-1:uu(e),0),function(){for(var t=arguments,r=-1,i=pl(t.length-e,0),a=Array(i);++r<i;)a[r]=t[e+r];switch(e){case 0:return n.call(this,a);case 1:return n.call(this,t[0],a);case 2:return n.call(this,t[0],t[1],a)}var o=Array(e+1);for(r=-1;++r<e;)o[r]=t[r];return o[e]=a,u(n,this,o)}}function co(n,e){if("function"!=typeof n)throw new zs(wn);return e=e===Q?0:pl(uu(e),0),lo(function(t){var r=t[e],i=t.slice(0,e);return r&&v(i,r),u(n,this,i)})}function fo(n,e,t){var r=!0,i=!0;if("function"!=typeof n)throw new zs(wn);return $o(t)&&(r="leading"in t?!!t.leading:r,i="trailing"in t?!!t.trailing:i),io(n,e,{leading:r,maxWait:e,trailing:i})}function ho(n){return no(n,1)}function po(n,e){return e=null==e?ps:e,yc(e,n)}function go(){if(!arguments.length)return[];var n=arguments[0];return wc(n)?n:[n]}function mo(n){return jt(n)}function vo(n,e){return jt(n,!1,e)}function yo(n){return jt(n,!0)}function _o(n,e){return jt(n,!0,e)}function bo(n,e){return n===e||n!==n&&e!==e}function wo(n,e){return n>e}function xo(n,e){return n>=e}function ko(n){return Ao(n)&&Ks.call(n,"callee")&&(!ol.call(n,"callee")||Hs.call(n)==In)}function jo(n){return qo(n)&&Hs.call(n)==Hn}function Co(n){return null!=n&&!("function"==typeof n&&Po(n))&&No($l(n))}function Ao(n){return qo(n)&&Co(n)}function Oo(n){return n===!0||n===!1||qo(n)&&Hs.call(n)==Mn}function Eo(n){return qo(n)&&Hs.call(n)==Ln}function Ro(n){return!!n&&1===n.nodeType&&qo(n)&&!Go(n)}function So(n){if(Co(n)&&(wc(n)||Qo(n)||Po(n.splice)||ko(n)))return!n.length;for(var e in n)if(Ks.call(n,e))return!1;return!0}function Io(n,e){return Jt(n,e)}function To(n,e,t){t="function"==typeof t?t:Q;var r=t?t(n,e):Q;return r===Q?Jt(n,e,t):!!r}function Mo(n){return qo(n)?Hs.call(n)==Pn||"string"==typeof n.message&&"string"==typeof n.name:!1}function Lo(n){return"number"==typeof n&&fl(n)}function Po(n){var e=$o(n)?Hs.call(n):"";return e==Dn||e==Nn}function Do(n){return"number"==typeof n&&n==uu(n)}function No(n){return"number"==typeof n&&n>-1&&n%1==0&&jn>=n}function $o(n){var e=typeof n;return!!n&&("object"==e||"function"==e)}function qo(n){return!!n&&"object"==typeof n}function zo(n){return qo(n)&&gi(n)==$n}function Fo(n,e){return n===e||Zt(n,e,di(e))}function Bo(n,e,t){return t="function"==typeof t?t:Q,Zt(n,e,di(e),t)}function Uo(n){return Ho(n)&&n!=+n}function Ko(n){return null==n?!1:Po(n)?Js.test(Us.call(n)):qo(n)&&(B(n)?Js:Oe).test(n)}function Wo(n){return null===n}function Vo(n){return null==n}function Ho(n){return"number"==typeof n||qo(n)&&Hs.call(n)==qn}function Go(n){if(!qo(n)||Hs.call(n)!=zn||B(n))return!1;var e=tl(n);if(null===e)return!0;var t=e.constructor;return"function"==typeof t&&t instanceof t&&Us.call(t)==Vs}function Jo(n){return $o(n)&&Hs.call(n)==Fn}function Yo(n){return Do(n)&&n>=-jn&&jn>=n}function Zo(n){return qo(n)&&gi(n)==Bn}function Qo(n){return"string"==typeof n||!wc(n)&&qo(n)&&Hs.call(n)==Un}function Xo(n){return"symbol"==typeof n||qo(n)&&Hs.call(n)==Kn}function nu(n){return qo(n)&&No(n.length)&&!!wt[Hs.call(n)]}function eu(n){return n===Q}function tu(n){return qo(n)&&gi(n)==Wn}function ru(n){return qo(n)&&Hs.call(n)==Vn}function iu(n,e){return e>n}function au(n,e){return e>=n}function ou(n){if(!n)return[];if(Co(n))return Qo(n)?J(n):$r(n);if(il&&n[il])return K(n[il]());var e=gi(n),t=e==$n?W:e==Bn?H:$u;return t(n)}function uu(n){if(!n)return 0===n?n:0;if(n=lu(n),n===kn||n===-kn){var e=0>n?-1:1;return e*Cn}var t=n%1;return n===n?t?n-t:n:0}function su(n){return n?kt(uu(n),0,On):0}function lu(n){if($o(n)){var e=Po(n.valueOf)?n.valueOf():n;n=$o(e)?e+"":e}if("string"!=typeof n)return 0===n?n:+n;n=n.replace(ye,"");var t=Ae.test(n);return t||Ee.test(n)?Rt(n.slice(2),t?2:8):Ce.test(n)?An:+n}function cu(n){return qr(n,Au(n))}function fu(n){return kt(uu(n),-jn,jn)}function du(n){if("string"==typeof n)return n;if(null==n)return"";if(Xo(n))return Qs?Rl.call(n):"";var e=n+"";return"0"==e&&1/n==-kn?"-0":e}function hu(n,e){var t=At(n);return e?lt(t,e):t}function pu(n,e){return x(n,fi(e,3),qt,!0)}function gu(n,e){return x(n,fi(e,3),zt,!0)}function mu(n,e){return null==n?n:Ml(n,dt(e),Au)}function vu(n,e){return null==n?n:Ll(n,dt(e),Au)}function yu(n,e){return n&&qt(n,dt(e))}function _u(n,e){return n&&zt(n,dt(e))}function bu(n){return null==n?[]:Ft(n,Cu(n))}function wu(n){return null==n?[]:Ft(n,Au(n))}function xu(n,e,t){var r=null==n?Q:Bt(n,e);return r===Q?t:r}function ku(n,e){return vi(n,e,Ut)}function ju(n,e){return vi(n,e,Kt)}function Cu(n){var e=Ai(n);if(!e&&!Co(n))return Xt(n);var t=wi(n),r=!!t,i=t||[],a=i.length;for(var o in n)!Ut(n,o)||r&&("length"==o||U(o,a))||e&&"constructor"==o||i.push(o);return i}function Au(n){for(var e=-1,t=Ai(n),r=nr(n),i=r.length,a=wi(n),o=!!a,u=a||[],s=u.length;++e<i;){var l=r[e];o&&("length"==l||U(l,s))||"constructor"==l&&(t||!Ks.call(n,l))||u.push(l)}return u}function Ou(n,e){var t={};return e=fi(e,3),qt(n,function(n,r,i){t[e(n,r,i)]=n}),t}function Eu(n,e){var t={};return e=fi(e,3),qt(n,function(n,r,i){t[r]=e(n,r,i)}),t}function Ru(n,e){return e=fi(e),sr(n,function(n,t){return!e(n,t)})}function Su(n,e){return null==n?{}:sr(n,fi(e))}function Iu(n,e,t){if(ki(e,n))r=null==n?Q:n[e];else{e=pt(e);var r=xu(n,e);n=Si(n,e)}return r===Q&&(r=t),Po(r)?r.call(n):r}function Tu(n,e,t){return null==n?n:mr(n,e,t)}function Mu(n,e,t,r){return r="function"==typeof r?r:Q,null==n?n:mr(n,e,t,r)}function Lu(n){return R(n,Cu(n))}function Pu(n){return R(n,Au(n))}function Du(n,e,t){var r=wc(n)||nu(n);if(e=fi(e,4),null==t)if(r||$o(n)){var i=n.constructor;t=r?wc(n)?new i:[]:Po(i)?At(tl(n)):{}}else t={};return(r?c:qt)(n,function(n,r,i){return e(t,n,r,i)}),t}function Nu(n,e){return null==n?!0:jr(n,e)}function $u(n){return n?I(n,Cu(n)):[]}function qu(n){return null==n?[]:I(n,Au(n))}function zu(n,e,t){return t===Q&&(t=e,e=Q),t!==Q&&(t=lu(t),t=t===t?t:0),e!==Q&&(e=lu(e),e=e===e?e:0),kt(lu(n),e,t)}function Fu(n,e,t){return e=lu(e)||0,t===Q?(t=e,e=0):t=lu(t)||0,n=lu(n),Wt(n,e,t)}function Bu(n,e,t){if(t&&"boolean"!=typeof t&&xi(n,e,t)&&(e=t=Q),t===Q&&("boolean"==typeof e?(t=e,e=Q):"boolean"==typeof n&&(t=n,n=Q)),n===Q&&e===Q?(n=0,e=1):(n=lu(n)||0,e===Q?(e=n,n=0):e=lu(e)||0),n>e){var r=n;n=e,e=r}if(t||n%1||e%1){var i=vl();return gl(n+i*(e-n+Et("1e-"+((i+"").length-1))),e)}return pr(n,e)}function Uu(n){return Fc(du(n).toLowerCase())}function Ku(n){return n=du(n),n&&n.replace(Se,$).replace(ht,"")}function Wu(n,e,t){n=du(n),e="string"==typeof e?e:e+"";var r=n.length;return t=t===Q?r:kt(uu(t),0,r),t-=e.length,t>=0&&n.indexOf(e,t)==t}function Vu(n){return n=du(n),n&&le.test(n)?n.replace(ue,q):n}function Hu(n){return n=du(n),n&&ve.test(n)?n.replace(me,"\\$&"):n}function Gu(n,e,t){n=du(n),e=uu(e);var r=G(n);if(!e||r>=e)return n;var i=(e-r)/2,a=cl(i),o=ll(i);return ei("",a,t)+n+ei("",o,t)}function Ju(n,e,t){return n=du(n),n+ei(n,e,t)}function Yu(n,e,t){return n=du(n),ei(n,e,t)+n}function Zu(n,e,t){return t||null==e?e=0:e&&(e=+e),n=du(n).replace(ye,""),ml(n,e||(je.test(n)?16:10))}function Qu(n,e){n=du(n),e=uu(e);var t="";if(!n||1>e||e>jn)return t;do e%2&&(t+=n),e=cl(e/2),n+=n;while(e);return t}function Xu(){var n=arguments,e=du(n[0]);return n.length<3?e:e.replace(n[1],n[2])}function ns(n,e,t){return du(n).split(e,t)}function es(n,e,t){return n=du(n),t=kt(uu(t),0,n.length),n.lastIndexOf(e,t)==t}function ts(n,t,r){var i=e.templateSettings;r&&xi(n,t,r)&&(t=Q),n=du(n),t=Cc({},t,i,at);var a,o,u=Cc({},t.imports,i.imports,at),s=Cu(u),l=I(u,s),c=0,f=t.interpolate||Ie,d="__p += '",h=qs((t.escape||Ie).source+"|"+f.source+"|"+(f===de?xe:Ie).source+"|"+(t.evaluate||Ie).source+"|$","g"),p="//# sourceURL="+("sourceURL"in t?t.sourceURL:"lodash.templateSources["+ ++bt+"]")+"\n";n.replace(h,function(e,t,r,i,u,s){return r||(r=i),d+=n.slice(c,s).replace(Te,z),t&&(a=!0,d+="' +\n__e("+t+") +\n'"),u&&(o=!0,d+="';\n"+u+";\n__p += '"),r&&(d+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),c=s+e.length,e}),d+="';\n";var g=t.variable;g||(d="with (obj) {\n"+d+"\n}\n"),d=(o?d.replace(re,""):d).replace(ie,"$1").replace(ae,"$1;"),d="function("+(g||"obj")+") {\n"+(g?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(a?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var m=Wc(function(){return Function(s,p+"return "+d).apply(Q,l)});if(m.source=d,Mo(m))throw m;return m}function rs(n){return du(n).toLowerCase()}function is(n){return du(n).toUpperCase()}function as(n,e,t){if(n=du(n),!n)return n;if(t||e===Q)return n.replace(ye,"");if(e+="",!e)return n;var r=J(n),i=J(e);return r.slice(T(r,i),M(r,i)+1).join("")}function os(n,e,t){if(n=du(n),!n)return n;if(t||e===Q)return n.replace(be,"");if(e+="",!e)return n;var r=J(n);return r.slice(0,M(r,J(e))+1).join("")}function us(n,e,t){if(n=du(n),!n)return n;if(t||e===Q)return n.replace(_e,"");if(e+="",!e)return n;var r=J(n);return r.slice(T(r,J(e))).join("")}function ss(n,e){var t=hn,r=pn;if($o(e)){var i="separator"in e?e.separator:i;t="length"in e?uu(e.length):t,r="omission"in e?du(e.omission):r}n=du(n);var a=n.length;if(gt.test(n)){
var o=J(n);a=o.length}if(t>=a)return n;var u=t-G(r);if(1>u)return r;var s=o?o.slice(0,u).join(""):n.slice(0,u);if(i===Q)return s+r;if(o&&(u+=s.length-u),Jo(i)){if(n.slice(u).search(i)){var l,c=s;for(i.global||(i=qs(i.source,du(ke.exec(i))+"g")),i.lastIndex=0;l=i.exec(c);)var f=l.index;s=s.slice(0,f===Q?u:f)}}else if(n.indexOf(i,u)!=u){var d=s.lastIndexOf(i);d>-1&&(s=s.slice(0,d))}return s+r}function ls(n){return n=du(n),n&&se.test(n)?n.replace(oe,Y):n}function cs(n,e,t){return n=du(n),e=t?Q:e,e===Q&&(e=yt.test(n)?vt:mt),n.match(e)||[]}function fs(n){var e=n?n.length:0,t=fi();return n=e?m(n,function(n){if("function"!=typeof n[1])throw new zs(wn);return[t(n[0]),n[1]]}):[],lo(function(t){for(var r=-1;++r<e;){var i=n[r];if(u(i[0],this,t))return u(i[1],this,t)}})}function ds(n){return Ct(jt(n,!0))}function hs(n){return function(){return n}}function ps(n){return n}function gs(n){return Qt("function"==typeof n?n:jt(n,!0))}function ms(n){return tr(jt(n,!0))}function vs(n,e){return rr(n,jt(e,!0))}function ys(n,e,t){var r=Cu(e),i=Ft(e,r);null!=t||$o(e)&&(i.length||!r.length)||(t=e,e=n,n=this,i=Ft(e,Cu(e)));var a=$o(t)&&"chain"in t?t.chain:!0,o=Po(n);return c(i,function(t){var r=e[t];n[t]=r,o&&(n.prototype[t]=function(){var e=this.__chain__;if(a||e){var t=n(this.__wrapped__),i=t.__actions__=$r(this.__actions__);return i.push({func:r,args:arguments,thisArg:n}),t.__chain__=e,t}return r.apply(n,v([this.value()],arguments))})}),n}function _s(){return Nt._===this&&(Nt._=Gs),this}function bs(){}function ws(n){return n=uu(n),function(){return arguments[n]}}function xs(n){return ki(n)?lr(n):cr(n)}function ks(n){return function(e){return null==n?Q:Bt(n,e)}}function js(n,e){if(n=uu(n),1>n||n>jn)return[];var t=On,r=gl(n,On);e=dt(e),n-=On;for(var i=E(r,e);++t<n;)e(t);return i}function Cs(n){return wc(n)?m(n,String):Ti(n)}function As(n){var e=++Ws;return du(n)+e}function Os(n,e){var t;return n===Q&&e===Q?0:(n!==Q&&(t=n),e!==Q&&(t=t===Q?e:t+e),t)}function Es(n){return n&&n.length?w(n,ps,wo):Q}function Rs(n,e){return n&&n.length?w(n,fi(e),wo):Q}function Ss(n){return Ls(n)/(n?n.length:0)}function Is(n){return n&&n.length?w(n,ps,iu):Q}function Ts(n,e){return n&&n.length?w(n,fi(e),iu):Q}function Ms(n,e){var t;return n===Q&&e===Q?0:(n!==Q&&(t=n),e!==Q&&(t=t===Q?e:t-e),t)}function Ls(n){return n&&n.length?O(n,ps):0}function Ps(n,e){return n&&n.length?O(n,fi(e)):0}n=n?$t.defaults({},n,$t.pick(Nt,_t)):Nt;var Ds=n.Date,Ns=n.Error,$s=n.Math,qs=n.RegExp,zs=n.TypeError,Fs=n.Array.prototype,Bs=n.Object.prototype,Us=n.Function.prototype.toString,Ks=Bs.hasOwnProperty,Ws=0,Vs=Us.call(Object),Hs=Bs.toString,Gs=Nt._,Js=qs("^"+Us.call(Ks).replace(me,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ys=Tt?n.Buffer:Q,Zs=n.Reflect,Qs=n.Symbol,Xs=n.Uint8Array,nl=n.clearTimeout,el=Zs?Zs.enumerate:Q,tl=Object.getPrototypeOf,rl=Object.getOwnPropertySymbols,il="symbol"==typeof(il=Qs&&Qs.iterator)?il:Q,al=Object.create,ol=Bs.propertyIsEnumerable,ul=n.setTimeout,sl=Fs.splice,ll=$s.ceil,cl=$s.floor,fl=n.isFinite,dl=Fs.join,hl=Object.keys,pl=$s.max,gl=$s.min,ml=n.parseInt,vl=$s.random,yl=Fs.reverse,_l=hi(n,"Map"),bl=hi(n,"Set"),wl=hi(n,"WeakMap"),xl=hi(Object,"create"),kl=wl&&new wl,jl=_l?Us.call(_l):"",Cl=bl?Us.call(bl):"",Al=wl?Us.call(wl):"",Ol=Qs?Qs.prototype:Q,El=Qs?Ol.valueOf:Q,Rl=Qs?Ol.toString:Q,Sl={};e.templateSettings={escape:ce,evaluate:fe,interpolate:de,variable:"",imports:{_:e}};var Il=Kr(qt),Tl=Kr(zt,!0),Ml=Wr(),Ll=Wr(!0);el&&!ol.call({valueOf:1},"valueOf")&&(nr=function(n){return K(el(n))});var Pl=kl?function(n,e){return kl.set(n,e),n}:ps,Dl=bl&&2===new bl([1,2]).size?function(n){return new bl(n)}:bs,Nl=kl?function(n){return kl.get(n)}:bs,$l=lr("length"),ql=rl||function(){return[]};(_l&&gi(new _l)!=$n||bl&&gi(new bl)!=Bn||wl&&gi(new wl)!=Wn)&&(gi=function(n){var e=Hs.call(n),t=e==zn?n.constructor:null,r="function"==typeof t?Us.call(t):"";if(r)switch(r){case jl:return $n;case Cl:return Bn;case Al:return Wn}return e});var zl=function(){var n=0,e=0;return function(t,r){var i=dc(),a=mn-(i-e);if(e=i,a>0){if(++n>=gn)return t}else n=0;return Pl(t,r)}}(),Fl=lo(function(n,e){return wc(n)||(n=null==n?[]:[Object(n)]),e=Pt(e,1),l(n,e)}),Bl=lo(function(n,e){return Ao(n)?St(n,Pt(e,1,!0)):[]}),Ul=lo(function(n,e){var t=Zi(e);return Ao(t)&&(t=Q),Ao(n)?St(n,Pt(e,1,!0),fi(t)):[]}),Kl=lo(function(n,e){var t=Zi(e);return Ao(t)&&(t=Q),Ao(n)?St(n,Pt(e,1,!0),Q,t):[]}),Wl=lo(function(n){var e=m(n,ft);return e.length&&e[0]===n[0]?Vt(e):[]}),Vl=lo(function(n){var e=Zi(n),t=m(n,ft);return e===Zi(t)?e=Q:t.pop(),t.length&&t[0]===n[0]?Vt(t,fi(e)):[]}),Hl=lo(function(n){var e=Zi(n),t=m(n,ft);return e===Zi(t)?e=Q:t.pop(),t.length&&t[0]===n[0]?Vt(t,Q,e):[]}),Gl=lo(Xi),Jl=lo(function(n,e){e=m(Pt(e,1),String);var t=ct(n,e);return hr(n,e.sort(P)),t}),Yl=lo(function(n){return kr(Pt(n,1,!0))}),Zl=lo(function(n){var e=Zi(n);return Ao(e)&&(e=Q),kr(Pt(n,1,!0),fi(e))}),Ql=lo(function(n){var e=Zi(n);return Ao(e)&&(e=Q),kr(Pt(n,1,!0),Q,e)}),Xl=lo(function(n,e){return Ao(n)?St(n,e):[]}),nc=lo(function(n){return Or(h(n,Ao))}),ec=lo(function(n){var e=Zi(n);return Ao(e)&&(e=Q),Or(h(n,Ao),fi(e))}),tc=lo(function(n){var e=Zi(n);return Ao(e)&&(e=Q),Or(h(n,Ao),Q,e)}),rc=lo(ba),ic=lo(function(n){var e=n.length,t=e>1?n[e-1]:Q;return t="function"==typeof t?(n.pop(),t):Q,wa(n,t)}),ac=lo(function(n){n=Pt(n,1);var e=n.length,t=e?n[0]:0,a=this.__wrapped__,o=function(e){return ct(e,n)};return!(e>1||this.__actions__.length)&&a instanceof i&&U(t)?(a=a.slice(t,+t+(e?1:0)),a.__actions__.push({func:Aa,args:[o],thisArg:Q}),new r(a,this.__chain__).thru(function(n){return e&&!n.length&&n.push(Q),n})):this.thru(o)}),oc=Br(function(n,e,t){Ks.call(n,t)?++n[t]:n[t]=1}),uc=Br(function(n,e,t){Ks.call(n,t)?n[t].push(e):n[t]=[e]}),sc=lo(function(n,e,t){var r=-1,i="function"==typeof e,a=ki(e),o=Co(n)?Array(n.length):[];return Il(n,function(n){var s=i?e:a&&null!=n?n[e]:Q;o[++r]=s?u(s,n,t):Gt(n,e,t)}),o}),lc=Br(function(n,e,t){n[t]=e}),cc=Br(function(n,e,t){n[t?0:1].push(e)},function(){return[[],[]]}),fc=lo(function(n,e){if(null==n)return[];var t=e.length;return t>1&&xi(n,e[0],e[1])?e=[]:t>2&&xi(e[0],e[1],e[2])&&(e.length=1),or(n,Pt(e,1),[])}),dc=Ds.now,hc=lo(function(n,e,t){var r=nn;if(t.length){var i=V(t,pi(hc));r|=on}return oi(n,r,e,t,i)}),pc=lo(function(n,e,t){var r=nn|en;if(t.length){var i=V(t,pi(pc));r|=on}return oi(e,r,n,t,i)}),gc=lo(function(n,e){return Ot(n,1,e)}),mc=lo(function(n,e,t){return Ot(n,lu(e)||0,t)}),vc=lo(function(n,e){e=m(Pt(e,1),fi());var t=e.length;return lo(function(r){for(var i=-1,a=gl(r.length,t);++i<a;)r[i]=e[i].call(this,r[i]);return u(n,this,r)})}),yc=lo(function(n,e){var t=V(e,pi(yc));return oi(n,on,Q,e,t)}),_c=lo(function(n,e){var t=V(e,pi(_c));return oi(n,un,Q,e,t)}),bc=lo(function(n,e){return oi(n,ln,Q,Q,Q,Pt(e,1))}),wc=Array.isArray,xc=Ys?function(n){return n instanceof Ys}:hs(!1),kc=Ur(function(n,e){qr(e,Cu(e),n)}),jc=Ur(function(n,e){qr(e,Au(e),n)}),Cc=Ur(function(n,e,t,r){zr(e,Au(e),n,r)}),Ac=Ur(function(n,e,t,r){zr(e,Cu(e),n,r)}),Oc=lo(function(n,e){return ct(n,Pt(e,1))}),Ec=lo(function(n){return n.push(Q,at),u(Cc,Q,n)}),Rc=lo(function(n){return n.push(Q,Ri),u(Lc,Q,n)}),Sc=Xr(function(n,e,t){n[e]=t},hs(ps)),Ic=Xr(function(n,e,t){Ks.call(n,e)?n[e].push(t):n[e]=[t]},fi),Tc=lo(Gt),Mc=Ur(function(n,e,t){ir(n,e,t)}),Lc=Ur(function(n,e,t,r){ir(n,e,t,r)}),Pc=lo(function(n,e){return null==n?{}:(e=m(Pt(e,1),String),ur(n,St(Au(n),e)))}),Dc=lo(function(n,e){return null==n?{}:ur(n,Pt(e,1))}),Nc=Gr(function(n,e,t){return e=e.toLowerCase(),n+(t?Uu(e):e)}),$c=Gr(function(n,e,t){return n+(t?"-":"")+e.toLowerCase()}),qc=Gr(function(n,e,t){return n+(t?" ":"")+e.toLowerCase()}),zc=Hr("toLowerCase"),Fc=Hr("toUpperCase"),Bc=Gr(function(n,e,t){return n+(t?"_":"")+e.toLowerCase()}),Uc=Gr(function(n,e,t){return n+(t?" ":"")+Uu(e)}),Kc=Gr(function(n,e,t){return n+(t?" ":"")+e.toUpperCase()}),Wc=lo(function(n,e){try{return u(n,Q,e)}catch(t){return Mo(t)?t:new Ns(t)}}),Vc=lo(function(n,e){return c(Pt(e,1),function(e){n[e]=hc(n[e],n)}),n}),Hc=Zr(),Gc=Zr(!0),Jc=lo(function(n,e){return function(t){return Gt(t,n,e)}}),Yc=lo(function(n,e){return function(t){return Gt(n,t,e)}}),Zc=ni(m),Qc=ni(d),Xc=ni(b),nf=ri(),ef=ri(!0),tf=ai("ceil"),rf=ai("floor"),af=ai("round");return e.prototype=t.prototype,r.prototype=At(t.prototype),r.prototype.constructor=r,i.prototype=At(t.prototype),i.prototype.constructor=i,Le.prototype=xl?xl(null):Bs,qe.prototype.clear=ze,qe.prototype["delete"]=Fe,qe.prototype.get=Be,qe.prototype.has=Ue,qe.prototype.set=Ke,We.prototype.push=He,Ge.prototype.clear=Je,Ge.prototype["delete"]=Ye,Ge.prototype.get=Ze,Ge.prototype.has=Qe,Ge.prototype.set=Xe,oo.Cache=qe,e.after=Xa,e.ary=no,e.assign=kc,e.assignIn=jc,e.assignInWith=Cc,e.assignWith=Ac,e.at=Oc,e.before=eo,e.bind=hc,e.bindAll=Vc,e.bindKey=pc,e.castArray=go,e.chain=ja,e.chunk=Li,e.compact=Pi,e.concat=Fl,e.cond=fs,e.conforms=ds,e.constant=hs,e.countBy=oc,e.create=hu,e.curry=to,e.curryRight=ro,e.debounce=io,e.defaults=Ec,e.defaultsDeep=Rc,e.defer=gc,e.delay=mc,e.difference=Bl,e.differenceBy=Ul,e.differenceWith=Kl,e.drop=Di,e.dropRight=Ni,e.dropRightWhile=$i,e.dropWhile=qi,e.fill=zi,e.filter=Da,e.flatMap=qa,e.flatten=Ui,e.flattenDeep=Ki,e.flattenDepth=Wi,e.flip=ao,e.flow=Hc,e.flowRight=Gc,e.fromPairs=Vi,e.functions=bu,e.functionsIn=wu,e.groupBy=uc,e.initial=Ji,e.intersection=Wl,e.intersectionBy=Vl,e.intersectionWith=Hl,e.invert=Sc,e.invertBy=Ic,e.invokeMap=sc,e.iteratee=gs,e.keyBy=lc,e.keys=Cu,e.keysIn=Au,e.map=Ua,e.mapKeys=Ou,e.mapValues=Eu,e.matches=ms,e.matchesProperty=vs,e.memoize=oo,e.merge=Mc,e.mergeWith=Lc,e.method=Jc,e.methodOf=Yc,e.mixin=ys,e.negate=uo,e.nthArg=ws,e.omit=Pc,e.omitBy=Ru,e.once=so,e.orderBy=Ka,e.over=Zc,e.overArgs=vc,e.overEvery=Qc,e.overSome=Xc,e.partial=yc,e.partialRight=_c,e.partition=cc,e.pick=Dc,e.pickBy=Su,e.property=xs,e.propertyOf=ks,e.pull=Gl,e.pullAll=Xi,e.pullAllBy=na,e.pullAt=Jl,e.range=nf,e.rangeRight=ef,e.rearg=bc,e.reject=Ha,e.remove=ea,e.rest=lo,e.reverse=ta,e.sampleSize=Ja,e.set=Tu,e.setWith=Mu,e.shuffle=Ya,e.slice=ra,e.sortBy=fc,e.sortedUniq=ca,e.sortedUniqBy=fa,e.split=ns,e.spread=co,e.tail=da,e.take=ha,e.takeRight=pa,e.takeRightWhile=ga,e.takeWhile=ma,e.tap=Ca,e.throttle=fo,e.thru=Aa,e.toArray=ou,e.toPairs=Lu,e.toPairsIn=Pu,e.toPath=Cs,e.toPlainObject=cu,e.transform=Du,e.unary=ho,e.union=Yl,e.unionBy=Zl,e.unionWith=Ql,e.uniq=va,e.uniqBy=ya,e.uniqWith=_a,e.unset=Nu,e.unzip=ba,e.unzipWith=wa,e.values=$u,e.valuesIn=qu,e.without=Xl,e.words=cs,e.wrap=po,e.xor=nc,e.xorBy=ec,e.xorWith=tc,e.zip=rc,e.zipObject=xa,e.zipObjectDeep=ka,e.zipWith=ic,e.extend=jc,e.extendWith=Cc,ys(e,e),e.add=Os,e.attempt=Wc,e.camelCase=Nc,e.capitalize=Uu,e.ceil=tf,e.clamp=zu,e.clone=mo,e.cloneDeep=yo,e.cloneDeepWith=_o,e.cloneWith=vo,e.deburr=Ku,e.endsWith=Wu,e.eq=bo,e.escape=Vu,e.escapeRegExp=Hu,e.every=Pa,e.find=Na,e.findIndex=Fi,e.findKey=pu,e.findLast=$a,e.findLastIndex=Bi,e.findLastKey=gu,e.floor=rf,e.forEach=za,e.forEachRight=Fa,e.forIn=mu,e.forInRight=vu,e.forOwn=yu,e.forOwnRight=_u,e.get=xu,e.gt=wo,e.gte=xo,e.has=ku,e.hasIn=ju,e.head=Hi,e.identity=ps,e.includes=Ba,e.indexOf=Gi,e.inRange=Fu,e.invoke=Tc,e.isArguments=ko,e.isArray=wc,e.isArrayBuffer=jo,e.isArrayLike=Co,e.isArrayLikeObject=Ao,e.isBoolean=Oo,e.isBuffer=xc,e.isDate=Eo,e.isElement=Ro,e.isEmpty=So,e.isEqual=Io,e.isEqualWith=To,e.isError=Mo,e.isFinite=Lo,e.isFunction=Po,e.isInteger=Do,e.isLength=No,e.isMap=zo,e.isMatch=Fo,e.isMatchWith=Bo,e.isNaN=Uo,e.isNative=Ko,e.isNil=Vo,e.isNull=Wo,e.isNumber=Ho,e.isObject=$o,e.isObjectLike=qo,e.isPlainObject=Go,e.isRegExp=Jo,e.isSafeInteger=Yo,e.isSet=Zo,e.isString=Qo,e.isSymbol=Xo,e.isTypedArray=nu,e.isUndefined=eu,e.isWeakMap=tu,e.isWeakSet=ru,e.join=Yi,e.kebabCase=$c,e.last=Zi,e.lastIndexOf=Qi,e.lowerCase=qc,e.lowerFirst=zc,e.lt=iu,e.lte=au,e.max=Es,e.maxBy=Rs,e.mean=Ss,e.min=Is,e.minBy=Ts,e.noConflict=_s,e.noop=bs,e.now=dc,e.pad=Gu,e.padEnd=Ju,e.padStart=Yu,e.parseInt=Zu,e.random=Bu,e.reduce=Wa,e.reduceRight=Va,e.repeat=Qu,e.replace=Xu,e.result=Iu,e.round=af,e.runInContext=Z,e.sample=Ga,e.size=Za,e.snakeCase=Bc,e.some=Qa,e.sortedIndex=ia,e.sortedIndexBy=aa,e.sortedIndexOf=oa,e.sortedLastIndex=ua,e.sortedLastIndexBy=sa,e.sortedLastIndexOf=la,e.startCase=Uc,e.startsWith=es,e.subtract=Ms,e.sum=Ls,e.sumBy=Ps,e.template=ts,e.times=js,e.toInteger=uu,e.toLength=su,e.toLower=rs,e.toNumber=lu,e.toSafeInteger=fu,e.toString=du,e.toUpper=is,e.trim=as,e.trimEnd=os,e.trimStart=us,e.truncate=ss,e.unescape=ls,e.uniqueId=As,e.upperCase=Kc,e.upperFirst=Fc,e.each=za,e.eachRight=Fa,e.first=Hi,ys(e,function(){var n={};return qt(e,function(t,r){Ks.call(e.prototype,r)||(n[r]=t)}),n}(),{chain:!1}),e.VERSION=X,c(["bind","bindKey","curry","curryRight","partial","partialRight"],function(n){e[n].placeholder=e}),c(["drop","take"],function(n,e){i.prototype[n]=function(t){var r=this.__filtered__;if(r&&!e)return new i(this);t=t===Q?1:pl(uu(t),0);var a=this.clone();return r?a.__takeCount__=gl(t,a.__takeCount__):a.__views__.push({size:gl(t,On),type:n+(a.__dir__<0?"Right":"")}),a},i.prototype[n+"Right"]=function(e){return this.reverse()[n](e).reverse()}}),c(["filter","map","takeWhile"],function(n,e){var t=e+1,r=t==yn||t==bn;i.prototype[n]=function(n){var e=this.clone();return e.__iteratees__.push({iteratee:fi(n,3),type:t}),e.__filtered__=e.__filtered__||r,e}}),c(["head","last"],function(n,e){var t="take"+(e?"Right":"");i.prototype[n]=function(){return this[t](1).value()[0]}}),c(["initial","tail"],function(n,e){var t="drop"+(e?"":"Right");i.prototype[n]=function(){return this.__filtered__?new i(this):this[t](1)}}),i.prototype.compact=function(){return this.filter(ps)},i.prototype.find=function(n){return this.filter(n).head()},i.prototype.findLast=function(n){return this.reverse().find(n)},i.prototype.invokeMap=lo(function(n,e){return"function"==typeof n?new i(this):this.map(function(t){return Gt(t,n,e)})}),i.prototype.reject=function(n){return n=fi(n,3),this.filter(function(e){return!n(e)})},i.prototype.slice=function(n,e){n=uu(n);var t=this;return t.__filtered__&&(n>0||0>e)?new i(t):(0>n?t=t.takeRight(-n):n&&(t=t.drop(n)),e!==Q&&(e=uu(e),t=0>e?t.dropRight(-e):t.take(e-n)),t)},i.prototype.takeRightWhile=function(n){return this.reverse().takeWhile(n).reverse()},i.prototype.toArray=function(){return this.take(On)},qt(i.prototype,function(n,t){var a=/^(?:filter|find|map|reject)|While$/.test(t),o=/^(?:head|last)$/.test(t),u=e[o?"take"+("last"==t?"Right":""):t],s=o||/^find/.test(t);u&&(e.prototype[t]=function(){var t=this.__wrapped__,l=o?[1]:arguments,c=t instanceof i,f=l[0],d=c||wc(t),h=function(n){var t=u.apply(e,v([n],l));return o&&p?t[0]:t};d&&a&&"function"==typeof f&&1!=f.length&&(c=d=!1);var p=this.__chain__,g=!!this.__actions__.length,m=s&&!p,y=c&&!g;if(!s&&d){t=y?t:new i(this);var _=n.apply(t,l);return _.__actions__.push({func:Aa,args:[h],thisArg:Q}),new r(_,p)}return m&&y?n.apply(this,l):(_=this.thru(h),m?o?_.value()[0]:_.value():_)})}),c(["pop","push","shift","sort","splice","unshift"],function(n){var t=Fs[n],r=/^(?:push|sort|unshift)$/.test(n)?"tap":"thru",i=/^(?:pop|shift)$/.test(n);e.prototype[n]=function(){var n=arguments;return i&&!this.__chain__?t.apply(this.value(),n):this[r](function(e){return t.apply(e,n)})}}),qt(i.prototype,function(n,t){var r=e[t];if(r){var i=r.name+"",a=Sl[i]||(Sl[i]=[]);a.push({name:t,func:r})}}),Sl[Qr(Q,en).name]=[{name:"wrapper",func:Q}],i.prototype.clone=L,i.prototype.reverse=Re,i.prototype.value=Me,e.prototype.at=ac,e.prototype.chain=Oa,e.prototype.commit=Ea,e.prototype.flatMap=Ra,e.prototype.next=Sa,e.prototype.plant=Ta,e.prototype.reverse=Ma,e.prototype.toJSON=e.prototype.valueOf=e.prototype.value=La,il&&(e.prototype[il]=Ia),e}var Q,X="4.5.1",nn=1,en=2,tn=4,rn=8,an=16,on=32,un=64,sn=128,ln=256,cn=512,fn=1,dn=2,hn=30,pn="...",gn=150,mn=16,vn=200,yn=1,_n=2,bn=3,wn="Expected a function",xn="__lodash_hash_undefined__",kn=1/0,jn=9007199254740991,Cn=1.7976931348623157e308,An=NaN,On=4294967295,En=On-1,Rn=On>>>1,Sn="__lodash_placeholder__",In="[object Arguments]",Tn="[object Array]",Mn="[object Boolean]",Ln="[object Date]",Pn="[object Error]",Dn="[object Function]",Nn="[object GeneratorFunction]",$n="[object Map]",qn="[object Number]",zn="[object Object]",Fn="[object RegExp]",Bn="[object Set]",Un="[object String]",Kn="[object Symbol]",Wn="[object WeakMap]",Vn="[object WeakSet]",Hn="[object ArrayBuffer]",Gn="[object Float32Array]",Jn="[object Float64Array]",Yn="[object Int8Array]",Zn="[object Int16Array]",Qn="[object Int32Array]",Xn="[object Uint8Array]",ne="[object Uint8ClampedArray]",ee="[object Uint16Array]",te="[object Uint32Array]",re=/\b__p \+= '';/g,ie=/\b(__p \+=) '' \+/g,ae=/(__e\(.*?\)|\b__t\)) \+\n'';/g,oe=/&(?:amp|lt|gt|quot|#39|#96);/g,ue=/[&<>"'`]/g,se=RegExp(oe.source),le=RegExp(ue.source),ce=/<%-([\s\S]+?)%>/g,fe=/<%([\s\S]+?)%>/g,de=/<%=([\s\S]+?)%>/g,he=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,pe=/^\w*$/,ge=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]/g,me=/[\\^$.*+?()[\]{}|]/g,ve=RegExp(me.source),ye=/^\s+|\s+$/g,_e=/^\s+/,be=/\s+$/,we=/\\(\\)?/g,xe=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ke=/\w*$/,je=/^0x/i,Ce=/^[-+]0x[0-9a-f]+$/i,Ae=/^0b[01]+$/i,Oe=/^\[object .+?Constructor\]$/,Ee=/^0o[0-7]+$/i,Re=/^(?:0|[1-9]\d*)$/,Se=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,Ie=/($^)/,Te=/['\n\r\u2028\u2029\\]/g,Me="\\ud800-\\udfff",Le="\\u0300-\\u036f\\ufe20-\\ufe23",Pe="\\u20d0-\\u20f0",De="\\u2700-\\u27bf",Ne="a-z\\xdf-\\xf6\\xf8-\\xff",$e="\\xac\\xb1\\xd7\\xf7",qe="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",ze="\\u2018\\u2019\\u201c\\u201d",Fe=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Be="A-Z\\xc0-\\xd6\\xd8-\\xde",Ue="\\ufe0e\\ufe0f",Ke=$e+qe+ze+Fe,We="["+Me+"]",Ve="["+Ke+"]",He="["+Le+Pe+"]",Ge="\\d+",Je="["+De+"]",Ye="["+Ne+"]",Ze="[^"+Me+Ke+Ge+De+Ne+Be+"]",Qe="\\ud83c[\\udffb-\\udfff]",Xe="(?:"+He+"|"+Qe+")",nt="[^"+Me+"]",et="(?:\\ud83c[\\udde6-\\uddff]){2}",tt="[\\ud800-\\udbff][\\udc00-\\udfff]",rt="["+Be+"]",it="\\u200d",at="(?:"+Ye+"|"+Ze+")",ot="(?:"+rt+"|"+Ze+")",ut=Xe+"?",st="["+Ue+"]?",lt="(?:"+it+"(?:"+[nt,et,tt].join("|")+")"+st+ut+")*",ct=st+ut+lt,ft="(?:"+[Je,et,tt].join("|")+")"+ct,dt="(?:"+[nt+He+"?",He,et,tt,We].join("|")+")",ht=RegExp(He,"g"),pt=RegExp(Qe+"(?="+Qe+")|"+dt+ct,"g"),gt=RegExp("["+it+Me+Le+Pe+Ue+"]"),mt=/[a-zA-Z0-9]+/g,vt=RegExp([rt+"?"+Ye+"+(?="+[Ve,rt,"$"].join("|")+")",ot+"+(?="+[Ve,rt+at,"$"].join("|")+")",rt+"?"+at+"+",rt+"+",Ge,ft].join("|"),"g"),yt=/[a-z][A-Z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,_t=["Array","Buffer","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Reflect","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],bt=-1,wt={};wt[Gn]=wt[Jn]=wt[Yn]=wt[Zn]=wt[Qn]=wt[Xn]=wt[ne]=wt[ee]=wt[te]=!0,wt[In]=wt[Tn]=wt[Hn]=wt[Mn]=wt[Ln]=wt[Pn]=wt[Dn]=wt[$n]=wt[qn]=wt[zn]=wt[Fn]=wt[Bn]=wt[Un]=wt[Wn]=!1;var xt={};xt[In]=xt[Tn]=xt[Hn]=xt[Mn]=xt[Ln]=xt[Gn]=xt[Jn]=xt[Yn]=xt[Zn]=xt[Qn]=xt[$n]=xt[qn]=xt[zn]=xt[Fn]=xt[Bn]=xt[Un]=xt[Kn]=xt[Xn]=xt[ne]=xt[ee]=xt[te]=!0,xt[Pn]=xt[Dn]=xt[Wn]=!1;var kt={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss"},jt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},Ct={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},At={"function":!0,object:!0},Ot={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Et=parseFloat,Rt=parseInt,St=At[typeof e]&&e&&!e.nodeType?e:Q,It=At[typeof n]&&n&&!n.nodeType?n:Q,Tt=It&&It.exports===St?St:Q,Mt=L(St&&It&&"object"==typeof i&&i),Lt=L(At[typeof self]&&self),Pt=L(At[typeof window]&&window),Dt=L(At[typeof this]&&this),Nt=Mt||Pt!==(Dt&&Dt.window)&&Pt||Lt||Dt||Function("return this")(),$t=Z();(Pt||Lt||{})._=$t,r=function(){return $t}.call(e,t,e,n),!(r!==Q&&(n.exports=r))}).call(this)}).call(e,t(2)(n),function(){return this}())},function(n,e){n.exports="2017/02/23/try-to-understand-ownership.yml\n2016/10/23/mithril-ospec.yml\n2016/09/21/pycurry.yml\n2016/08/27/reading-mithriljs-4.yml\n2016/08/25/reading-mithriljs-3.yml\n2016/08/24/reading-mithriljs-2.yml\n2016/08/22/reading-mithriljs.yml\n2016/07/29/js-test-with-karma-webpack-es6.yml\n2016/05/05/module-global-vs-class-variable.yml\n2016/04/14/rop.yml\n2016/03/21/pipe.yml\n2016/03/19/v8-optimization.yml\n2016/03/13/pyazo.yml\n2016/02/26/expert-python-chapter3.yml\n2016/02/21/mithrilify.yml\n2016/02/14/moved-to-gh-page.yml"},function(n,e,t){function r(n){return t(i(n))}function i(n){return a[n]||function(){throw new Error("Cannot find module '"+n+"'.")}()}var a={"./2016/02/14/moved-to-gh-page.yml":13,"./2016/02/21/mithrilify.yml":14,"./2016/02/26/expert-python-chapter3.yml":15,"./2016/03/13/pyazo.yml":16,"./2016/03/19/v8-optimization.yml":17,"./2016/03/21/pipe.yml":18,"./2016/04/14/rop.yml":19,"./2016/05/05/module-global-vs-class-variable.yml":20,"./2016/07/29/js-test-with-karma-webpack-es6.yml":21,"./2016/08/22/reading-mithriljs.yml":22,"./2016/08/24/reading-mithriljs-2.yml":23,"./2016/08/25/reading-mithriljs-3.yml":24,"./2016/08/27/reading-mithriljs-4.yml":25,"./2016/08/28/reading-mithriljs-5.yml":26,"./2016/09/21/pycurry.yml":27,"./2016/10/23/mithril-ospec.yml":28,"./2017/02/23/try-to-understand-ownership.yml":41,"./index.txt":29};r.keys=function(){return Object.keys(a)},r.resolve=i,n.exports=r,r.id=12},function(n,e){n.exports={title:"github pagesに引越し",slug:"moved-to-gh-page",utime:1455438723,date:"2016/02/14 17:32:03",tags:["misc"],publish:!0,body:"jekyllとか色々覚えることが多そうなのでpythonで必要最低限のhtmlのジェネレータを作ってgithub pagesにお引越ししてみました。\n\n記事の情報はyamlで管理して、そいつをパースしてhtmlに吐き出すという感じにしてるのですが、自分しか使わないしかなり雑。\n\n記事の情報管理をyamlでやるのはすごくいいということがわかってきました。\n\nyamlは\n```yaml\ntitle: github pagesに引越し\nslug: moved_to_gh_page\nutime: 1455438723\ndate: 2016/02/14 17:32:03\ntags:\n  - タグ\nactive: true\nbody: |-\n  ほにゃらら\n```\n\nという構成にしていて、こいつをpythonのPyYamlで読み込んだ結果をjinja2で書いたテンプレートにrenderしてやるようにしています。\n\n面倒なのが、リポジトリのトップにあるindex.htmlへ記事の追加を反映しなくてはいけないので都度ビルドコマンドを叩くようにしています。\n\nこの辺はいちいちコマンドを叩かずに変更を監視して自動でビルドするようにしたいなぁと。\n\nまあとにかくブログに特化するというのであればgithub pagesでもイケそうな気がする。"}},function(n,e){n.exports={title:"github pagesの構成を変えた",slug:"mithrilify",utime:1456047517,date:"2016/02/21 18:38:37",tags:["python","javascript","mithril","webpack"],publish:!0,body:"引越しをした時は、pythonで記事データになるyamlファイルをビルドしてhtmlをした後にindex.htmlにリンクを載せるという方法を取っていました。\n\nこのやり方でも問題はないんですが、yamlとhtmlが重複してしまいなんともいけてない感じがしたので、yamlをjsで読み取る方法にしました。\n\nどうせgithubがストレージなんだし記事の目録を作ってやってjsでyamlファイルをパースしてやればええがなという動機です。SPAの利です。\n\njsのフレームワークはなんとなく好きなmithrilを使って組んでいます。ブログみたいな単純なものならちょろっと書けるので最高。\n\nでも結局は、目録を作るというのに変わっただけで記事を新規作成ないし削除をしたら目録を更新しないといけません。circleciとか使ってうまくできないか調べよう。\n\nところで、webpackのloaderは本当に最高で何も考えずにただただ`yaml-loader`を使えば全てが丸く収まるのでもうwebpackから抜け出せなくなりました。\n\nガンガン使っていきましょう。"}},function(n,e){n.exports={title:"pythonの__new__とかtypeなど",slug:"expert-python-chapter3",utime:1456457568,date:"2016/02/26 12:32:48",tags:["python"],publish:!0,body:"pythonコードの読み書き練習のために便利ツールの[percol](https://github.com/mooz/percol)のリファクタリングを始めました。\n\n`percol.finder`という文字列検索処理をしてるっぽいモジュールでメタクラスが使われていたのでメタクラスについてエキパイを読み直しました。\n\nつっても、`percol.finder.Finder`クラスは[ただの抽象基底クラスというだけっぽい。](https://github.com/mooz/percol/blob/master/percol/finder.py#L11-L37)\n\nメタプログラミングなんて高度なことをする場面は中々ないと思うけど、とりあえず`__new__`と`type()`について忘れたくないのでメモ。\n\n```\n$ python -V\nPython 3.5.0\n```\n\n# \\_\\_new\\_\\_\n`__new__`はインスタンスを作成しようとする時に毎回実行される。エキパイ的には`meta-constructor`と説明されている。\n\n```python\nclass C(object):\n  def __new__(cls, *args, **kwargs):\n      print('args: {}'.format(args))\n      print('kargs: {}'.format(kwargs))\n      print('__new__ called.')\n      ins = object.__new__(cls)\n      print('created instance')\n      ins.hoge = 'hoge'\n      return ins\n\n  def __init__(self, arg):\n      print('__init__ called.')\n      self._fuga = arg\n\n  @property\n  def fuga(self):\n      return self._fuga + self.hoge\n\n\nprint(C('fuga').fuga)\n# args: ('fuga',)\n# kargs: {}\n# __new__ called.\n# created instance\n# __init__ called.\n# fugahoge\n```\n\n`__new__`はクラスオブジェクトを引数にとって必ずインスタンスを返さなくてはいけない。つまり、インスタンスを作成する前にクラスオブジェクトを煮るなる焼くなり自由にいじり倒すことができるわけだ。\n\nで、この`C`クラスを継承した場合、子クラスから親クラスの`__init__()`を呼び出すには`super()`をしないといけない。\n\n```pytyhon\nclass C(object):\n    def __new__(cls, *args, **kwargs):\n        print('C.__new__ called.')\n        return object.__new__(cls)\n\n    def __init__(self):\n        print('C.__init__ called.')\n\n\nclass D(C):\n    def __init__(self):\n        print('D.__init__() called')\n\n\nclass E(C):\n    def __init__(self):\n        super().__init__()\n        print('E.__init__() called')\n\n\nprint(D())\n# C.__new__ called.\n# D.__init__() called\n# <__main__.D object at 0x104616f28>\n\nprint(E())\n# C.__new__ called.\n# C.__init__ called.\n# E.__init__() called\n# <__main__.E object at 0x104616f98>\n```\n\nなるほど。\n\n# metaclassとtype\n`metaclass`はクラスのコンストラクタに渡すキーワード引数になる。python2では`__metaclass__`というクラス属性。\n\n`metaclass`は`type()`と同じ形式の引数を取る関数が指定する。\n\n```python\ndef mymetaclass(cls, base, _dict):\n  if '__cat__' in _dict:\n      _dict['__cat__'] = \\\n          'oh! my {}'.format(_dict.get('__cat__', ''))\n  return type(cls, base, _dict)\n\n\nclass A(object, metaclass=mymetaclass):\n    __cat__ = 'neko'\n\n\nprint(a.__cat__)\n# oh! my neko\n```\n\n全く実用的な例ではないけど、クラスの属性を自由に操作できる。というか、`type()`に渡す基底クラスを変えてしまえば自由にクラスオブジェクトを変更できてしまう。\n\nエキパイにも\n\n>For changing the read-write attributes or adding new ones, metaclasses can be avoided for simpler solutions, based on dynamic changes over the class instance.\n\nというふうに書いてあるし、そう気軽に使っていいものではないことがわかる。(というか、使えないだろう。)\n\nで、エキパイのこのチャプタの最後にクラスを拡張するパッチの実装があるのでほぼ丸コピ。\n\n```python\ndef enhancer_1(cls):\n  cls.contracted_name = ''.join(\n      l for l in cls.__name__ if l.isupper()\n  )\n\n\ndef enhancer_2(cls):\n    def logger(func):\n        def wrapper(*args, **kwargs):\n            print('logging!')\n            return func(*args, **kwargs)\n        return wrapper\n    for el in dir(cls):\n        if el.startswith('_'):\n            continue\n        v = getattr(cls, el)\n        if not hasattr(v, '__func__'):\n            continue\n        setattr(cls, el, logger(v))\n\n\ndef enhance(cls, *enhancers):\n    for e in enhancers:\n        e(cls)\n\n\nclass ThisIsMyClass(object):\n    def hi(self):\n        return 'hi'\n\n\nenhance(ThisIsMyClass, enhancer_1, enhancer_2)\nins = ThisIsMyClass()\nassert ins.hi() == 'hi'\nassert ins.__class__.contracted_name == 'TIMC'\n```\n\nなお、メタプログラミングを使うべき時が来、適切に使える時が来るのかガチ不明。"}},function(n,e){n.exports={title:"Gyazo APIのクライアントを雑に作った",slug:"pyazo",utime:1457828361,date:"2016/03/13 09:19:21",tags:["python"],publish:!0,body:"Gyazo APIが非常にシンプルなため本当にシンプルな面白みのない実装になりました。\n\n[pypi](https://pypi.python.org/pypi/pyazo)\n\n[github](https://github.com/mtwtkman/pyazo)\n\npyazoって名前は別言語でかぶってたりしてアレ感ある。\n\nところでこういう外部のAPIのテストってどうしたらいいんじゃろ"}},function(n,e){n.exports={title:"V8で最適化されないjavascript",slug:"v8-optimization",utime:1458391960,date:"2016/03/19 21:52:40",tags:["javascript"],publish:!0,body:"[mithril](https://github.com/lhorie/mithril.js)のコードを読んでいて`for`文で`argumets`の要素をぐるぐる回しながらインデクスアクセスをして配列にデータを詰め込んでる処理が気持ち悪かったので`map`にしてプルリクしたところ、\nパフォーマンスを理由にリジェクトされました。\n\nで、そのプルリクでもらった返答にV8の最適化についてのリンクを併記してもらっていたので読むことにしました。\n\nちなみに[プルリクで修正した内容](https://github.com/lhorie/mithril.js/pull/993/commits/f384054947681d10696fcfeb2fab71f2a40dde1d)はクソ単純で\nArraylikeな`arguments`を`slice`で回すというものです。\n\n[Optimization killersのリンク](https://github.com/petkaantonov/bluebird/wiki/Optimization-killers)\n\n# Unsupported syntax\n2016/3/19現在、V8で最適化できない構文がいくつかある。\n\n- Generator functions\n- Functions that contain a for-of statement\n- Functions that contain a try-catch statement\n- Functions that contain a try-finally statement\n- Functions that contain a compound let assignment\n- Functions that contain a compound const assignment\n- Functions that contain object literals that contain __proto__, or get or set declarations.\n\n`try`文ダメってキツそう。あと`for-of`が最適化されないのもつらい。まあ`for-of`が最適化されるならそっち使うよな。\n\ngeneratorもダメとは…こう見ると単純にES2015以降に対応しきれていないだけという感じか。\n\nあとは↓の場合もダメっぽい\n\n- Functions that contain a debugger statement\n- Functions that call literally eval()\n- Functions that contain a with statement\n\nVBAみたいで悔しい思いをしそうな`with`を使うことはない気がするけど、`eval`や`with`を最適化ができない理由はスコープの判定ができないからとのことらしい。(曖昧)\n\nで、プロダクトコードで例外処理を避けるわけにもいかんということでワークアラウンドなコード例が書いてあったのでそのまま引用。\n\n```javascript\nvar errorObject = {value: null};\nfunction tryCatch(fn, ctx, args) {\n    try {\n        return fn.apply(ctx, args);\n    }\n    catch(e) {\n        errorObject.value = e;\n        return errorObject;\n    }\n}\n\nvar result = tryCatch(mightThrow, void 0, [1,2,3]);\n//Unambiguously tells whether the call threw\nif(result === errorObject) {\n    var error = errorObject.value;\n}\nelse {\n    //result is the returned value\n}\n```\n\nエラーハンドリングは独立した最小限の関数に切り出すのが良いらしい。\nそうすれば最適化されない範囲が最小限になるということだ。\n\n\n# Managing `arguments`\n`arguments`は最適化を阻害する多数の原因になりうるやつだそうだ。\n\n## 1. sloppyモード(=strictモードじゃないやつ)で`arguments`を評価しながら定義済みの引数に再代入する場合\n何言ってんだ？？？？例を見てみよう\n\n```javascript\nfunction defaultArgsReassign(a, b) {\n  if (arguments.length < 2) b = 5;\n}\n```\n\nとにかくこれがダメということらしい。じゃあどうしたらいいのかというと引数の値を新しい変数に保存しましょうとのこと\n\n```javascript\nfunction reAssignParam(a, b_) {\n  var b = b_;\n  //unlike b_, b can safely be reassigned\n  if (arguments.length < 2) b = 5;\n}\n```\n\nただし、今回の場合だとただ引数が与えられているのかをチェックしているだけなので下記のように書くのがいいっぽい。\n\n```javascript\nfunction reAssignParam(a, b) {\n  if (b === void 0) b = 5;\n}\n```\n\nまあでもおとなしく端からstrictモードにしておけば考える必要のない問題ですね。\n\n## 2. `arguments`漏れ\n```javascript\nfunction leaksArguments1() {\n  return arguments;\n}\n\nfunction leaksArguments2() {\n  var args = [].slice.call(arguments);\n}\n\nfunction leaksArguments3() {\n  var a = arguments;\n  return function() {\n      return a;\n  };\n}\n```\n\n今回のプルリクで指摘されたのが`leaksArguments2`と同じケースだった。`arguments`はどこにも漏らしたり渡したりしてはいけないらしい。\n\nつまり`slice.call`や`map`の引数に渡すのはご法度いうわけだ。対処法は以下(mithrilの`m()`でまさに下の実装になっていた)\n\n```javascript\nfunction doesntLeakArguments() {\n                  //.length is just an integer, this doesn't leak\n                  //the arguments object itself\n  var args = new Array(arguments.length);\n  for(var i = 0; i < args.length; ++i) {\n              //i is always valid index in the arguments object\n      args[i] = arguments[i];\n  }\n  return args;\n}\n```\n\n## 3. `arguments`への代入\nこんなことする必要性がないと思うけど、これも例によってsloppyモードの時だけ。\n\n```javascript\nfunction assignToArguments() {\n  arguments = 3;\n  return arguments;\n}\n```\n\n## 結局のところ`arguments`はどうやったら安全に扱えるのか\n以下を厳守すればok\n\n- `arguments.length`使おう。\n- 適切なインデクスアクセスで`arguments`の要素を取得する。で、そいつは外に出さない。\n- `argumets`を**絶対に**直接扱わない。`.length`やインデクスアクセスは`arguments`そのものじゃないからおk。\n- **厳密に言えば**`fn.apply(y, arguments)`はおk。他はいかなる場合もダメ。例えば`.slice`とか。 `Function#apply`だけが特別。\n- `Function#apply`を使って関数のプロパティを追加するときと`Function#bind`で隠れクラスができてしまうような場合に気をつける。\n\n\n# Switch-case\n`switch`文は`case`の節が128を超えると最適化がされなくなる。なので`if-else`使おう。\n\n# For-in\n幾つかの場合で最適化を妨げることになる。\n\n## 1. キーがローカル変数でない場合\n```javascript\nfunction nonLocalKey1() {\n  var obj = {}\n  for(var key in obj);\n  return function() {\n      return key;\n  };\n}\n\nvar key;\nfunction nonLocalKey2() {\n  var obj = {}\n  for(key in obj);\n}\n```\n\nそもそもオブジェクトのキーは上のスコープから参照できない。純粋にローカルスコープの変数でないとダメ。\n\n## 2. イテレートできるようなオブジェクトは'simple enumerable'ではない\n### `hash table mode`(あるいは`normalized objects`, `dictionary mode`)のオブジェクトは'simple enumerable'ではない。\n\n```javascript\nfunction hashTableIteration() {\n  var hashTable = {\"-\": 3};\n  for(var key in hashTable);\n}\n```\n\nこれわかりづらいのだけど、コンストラクタ外で動的に`hash table mode`のオブジェクトを作るのがよくないらしい。\n\nオブジェクトが`hash table mode`になっているかはコード内に`console.log(%HasFastProperties(obj))`を仕込んでnodeのオプションに`--allow-natives-syntax`を指定してやればいいらしい。\n\n\n### プロトタイプチェインで定義されたオブジェクトがenumerableなプロパティを持っている\n\n```javascript\nObject.prototype.fn = function() {};\n```\n\nプロトタイプチェインで追加した値は`for-in`文を含んでしまうらしい。\n\n`Object.defineProperty`を使えばそれは避けられるらしい。慣れていないと難しい話だ。\n\n### 配列のインデクスを持っている\nこれは結構やりがちかもしれない\n\n```javascript\nfunction iteratesOverArray() {\n  var arr = [1, 2, 3];\n  for (var index in arr) {\n\n  }\n}\n```\n\nそもそも`for-in`は`for`より遅いらしい。なおかつ`for-in`を含む関数は含んでいるというそれだけで関数全体の最適化がなされない。\n\nこれらの問題に対する処置としてキー名のリストを作ってしまえということだ。\n\n```javascript\nfunction inheritedKeys(obj) {\n  var ret = [];\n  for(var key in obj) {\n      ret.push(key);\n  }\n  return ret;\n}\n```\n\nまじかよ\n\n\n# 無限ループと曖昧な脱出の条件\n必ず一回はループを通るなら`do-while`使おう。あとはまあロジックを踏まえて適切にexit仕掛けようね。ということらしい。\n\n現場からは以上です。"
}},function(n,e){n.exports={title:"shellのパイプをpythonで実装",slug:"pipe",utime:1458563690,date:"2016/03/21 21:34:50",tags:["python"],publish:!0,body:"なんかふとできるかなと思って試してみたところ以下のような感じになりました。\n\n```python\nclass Pipable:\n    def __init__(self, cmd):\n        if callable(cmd):\n            self.cmd = cmd\n        else:\n            raise ValueError\n\n    def __ror__(self, other):\n        return self.cmd(other)\n\n    def __call__(self, *args):\n        return self.cmd(*args)\n\n\ndef cat(f):\n    with open(f) as fp:\n        data = fp.read()\n    return data\n\n\np1 = Pipable(cat)\np2 = Pipable(lambda x: x.upper())\np3 = Pipable(lambda x: '-'.join(x))\n\n\nraise p1('hoge.txt') == 'neko\\n'\nraise p1('hoge.txt') | p2 == 'NEKO\\n'\nraise p1('hoge.txt') | p2 | p3 == 'N-E-K-O-\\n'\n```\n\n要は`p3(p2(p1('hoge.txt')))`という状態にしてやればいいので(関数合成というやつ？)`__ror__`で左側の処理の結果を受け取るようにしました。\n\n実用性皆無マンです。"}},function(n,e){n.exports={title:"鉄道指向プログラミングをpythonで",slug:"rop",utime:1460642362,date:"2016/04/14 22:59:22",tags:["python"],publish:!0,body:"[Railway oriented programming](http://fsharpforfunandprofit.com/posts/recipe-part2/)を参考にpythonでも鉄道指向プログラミングを実装してみます。\n\nF#全くわらかないけど、どうやら[判別共用体](https://msdn.microsoft.com/ja-jp/library/dd233226.aspx)というやつで処理結果の型を持ち回るということらしいので、そんな風に書いてみます。\n\n```python\nfrom functools import partial\n\n\nclass TSuccess:\n    def __init__(self, result):\n        self.result = result\n\n    def __call__(self):\n        return self.result\n\n\nclass TFailure:\n    def __init__(self, msg):\n        self.msg = msg\n\n    def __call__(self):\n        return lambda : self.msg\n\n\ndef bind(switch_func, two_track_input):\n    if isinstance(two_track_input, TSuccess):\n        return switch_func(two_track_input())\n    elif isinstance(two_track_input, TFailure):\n        return two_track_input\n\n\ndef validate1(inp):\n    if inp.name == '':\n        return TFailure('input name.')\n    else:\n        return TSuccess(inp)\n\n\ndef validate2(inp):\n    if len(inp.name) > 50:\n        return TFailure('name length must be less than 50.')\n    else:\n        return TSuccess(inp)\n\n\ndef validate3(inp):\n    if inp.email == '':\n        return TFailure('input email.')\n    else:\n        return TSuccess(inp)\n\n\nclass Input:\n    def __init__(self, name, email):\n        self._name = name\n        self._email = email\n\n    @property\n    def name(self):\n        return self._name\n\n    @property\n    def email(self):\n        return self._email\n\n    def __call__(self):\n        return 'Success name={}, email={}'.format(self._name, self._email)\n\n\ndef combined_validation(inp):\n    result1 = validate1(inp)\n    result2 = bind(validate2, result1)\n    result3 = bind(validate3, result2)\n    return result3()()\n\n\nassert combined_validation(Input(name='', email='')) == 'input name.'\nassert combined_validation(Input(name='neko', email='')) == 'input email.'\nassert combined_validation(Input(name='neko', email='meow')) == 'Success name=neko, email=meow'\n```\n\nF#では`Result`という判別共用体に`Success`と`Failure`を持っていて、型によってディスパッチするみたいですが、pythonでこれを実現する方法がわからなかった。\n\nというか、これっていわゆるパターンマッチだと思うのでまあそれができればいいかということで`bind`で全てを丸く収めた感があります。"}},function(n,e){n.exports={title:"モジュールグローバルよりクラス変数の方がパフォーマンス的に有利",slug:"module-global-vs-class-variable",utime:1462419084,date:"2016/05/05 12:31:24",tags:["python"],publish:!0,body:"[falcon](http://falconframework.org/)のソース読んでたら[こんなの](https://github.com/falconry/falcon/blob/50fec0fd6dc6e0019099f11a001097e1baccc9ee/falcon/api.py#L128-L135)があった。\n\n```python\n...\n# PERF(kgriffs): Reference via self since that is faster than\n# module global...\n_BODILESS_STATUS_CODES = set([\n    status.HTTP_100,\n    status.HTTP_101,\n    status.HTTP_204,\n    status.HTTP_304\n])\n...\n```\n\nモジュールグローバルのインポートよりもクラス変数のアクセスの方が速いということらしい。\n\nパス探索やらのプロセスがなくなるんだから当たり前だと思うけどどの程度差があるのか気になったのでプロファイルとってみた。\n\n\n`module.py`\n\n```python\nvar = 'I am module global.'\n```\n\n`test.py`\n\n```python\nimport cProfile\n\n\nTRIAL = 100000\n\n\nclass A:\n    var = 'I am class variable'\n\n\ndef test_module_global():\n    for x in range(TRIAL):\n        from mod import var\n\n\ndef test_class_variable():\n    for x in range(TRIAL):\n        a = A()\n        a.var\n\n\nif __name__ == '__main__':\n    cProfile.run('test_module_global()')\n    cProfile.run('test_class_variable()')\n\n```\n\n10万回参照するということがあり得るのかわからないけど、試行回数は10万回とする。\n\n結果から言うと\n\nモジュールグローバルのインポートは\n> 200161 function calls (200160 primitive calls) in 0.185 seconds\n\nクラス変数のアクセスはインスタンスを作るのを含めても\n> 4 function calls in 0.016 seconds\n\nだった。\n\nまあ圧倒的にクラス変数の方が速い。\n\nけどもこれ別モジュールからこのクラスをインポートして使うとかだと大してコスト変わらん気がする。\n\n`falcon.API` は基本的にアプリケーションを実行するためのインスタンスを作るのが目的のオブジェクトなんだろうけどどうせインポートするしなぁ。謎"}},function(n,e){n.exports={title:"ES6で書いたコードをkarma+webpackでテスト",slug:"js-test-with-karma-webpack-es6",utime:1469803820,date:"2016/07/29 23:50:20",tags:["javascript"],publish:!0,body:"`webpack.config.js`がそのまま使えるのでES6向けの設定が非常に楽でした。その割には`karma webpack es6`とかでググっても情報が全然なくて悲しい。\n\n前準備として`npm i -D karam-webpack`をしておきます。\n\n```\n// karama.conf.js\nvar webpackConfig = require('./webpack.config.js');\n\nmodule.exports = function(config) {\n  config.set({\n    basePath: '',\n    frameworks: ['jasmine'],\n    files: [\n      'src/tests/**/*Spec.js'\n    ],\n    exclude: [],\n    preprocessors: {\n      'src/**/*.js': ['webpack'],\n      'src/tests/**/*Spec.js': ['webpack']\n    },\n    webpack: webpackConfig,\n    reporters: ['progress'],\n    port: 9876,\n    colors: true,\n    logLevel: config.LOG_INFO,\n    autoWatch: true,\n    browsers: ['PhantomJS'],\n    singleRun: false,\n    concurrency: Infinity\n  })\n}\n```\n\nこんな設定ファイルを用意して`karma test`を実行するだけでES6で書いたコードのテストが実行できます。\n`webpack.config.js`のエントリポイントをそのまま使っているのでインポートのパス探索を考える必要がないのが良いと思います。\n\n`browserify`の方が楽かと思ったけどこれはこれで問題ないかと。"}},function(n,e){n.exports={title:"mithriljsのコードを読む",slug:"reading-mithriljs",utime:1471866841,date:"2016/08/22 20:54:01",tags:["javascript","mithril"],publish:!0,body:'[mithriljs](https://github.com/lhorie/mithril.js/tree/0159cd667ad85cd82d92fcb31a33f75be6539f6d)のコード読む。\n\n現時点で`v0.2.5`だけど、コアな部分はそう変わらんだろう。コアなというのは、つまり`m.mount`とか。\n\nというわけで`mithril`がレンダリングする`m.mount`から読むことにしよう。(2000行程度なら単体のファイルは読むのが比較的楽ということが知られています)\n\n[ここ](https://github.com/lhorie/mithril.js/blob/0159cd667ad85cd82d92fcb31a33f75be6539f6d/mithril.js#L1475)\n```js\nm.mount = m.module = function (root, component) {\n  if (!root) {\n    throw new Error("Please ensure the DOM element exists before " +\n      "rendering a template into it.")\n  }\n  var index = roots.indexOf(root)\n  if (index < 0) index = roots.length\n  var isPrevented = false\n  var event = {\n    preventDefault: function () {\n      isPrevented = true\n      computePreRedrawHook = computePostRedrawHook = null\n    }\n  }\n  forEach(unloaders, function (unloader) {\n    unloader.handler.call(unloader.controller, event)\n    unloader.controller.onunload = null\n  })\n  if (isPrevented) {\n    forEach(unloaders, function (unloader) {\n      unloader.controller.onunload = unloader.handler\n    })\n  } else {\n    unloaders = []\n  }\n  if (controllers[index] && isFunction(controllers[index].onunload)) {\n    controllers[index].onunload(event)\n  }\n  return checkPrevented(component, root, index, isPrevented)\n}\n```\n`m.mount`がやってることはUnloadableControllerな場合に`unloader`のイベントハンドラを登録しているというだけ。\n注意を払わないといけないのは`event`内で定義されている`preventDefault`関数の中で`isPrevented`を巻き上げてる点だろうか。\n\nまあ、大したことはやっていないので`checkPrevented`を見てみる。\n\n[ここやで](https://github.com/lhorie/mithril.js/blob/0159cd667ad85cd82d92fcb31a33f75be6539f6d/mithril.js#L1437)\n\n```js\nfunction checkPrevented(component, root, index, isPrevented) {\n  if (!isPrevented) {\n    m.redraw.strategy("all")\n    m.startComputation()\n    roots[index] = root\n    var currentComponent\n    if (component) {\n      currentComponent = topComponent = component\n    } else {\n      currentComponent = topComponent = component = {controller: noop}\n    }\n    var controller = new (component.controller || noop)()\n    // controllers may call m.mount recursively (via m.route redirects,\n    // for example)\n    // 訳: controllersはm.mountを再帰的に呼び出し得る。(例えば、m.routeのリダイレクトを通じてとか)\n    // this conditional ensures only the last recursive m.mount call is\n    // applied\n    // 訳: この条件式はm.mountが呼び出す最後の再帰が適用されてるかを確かめてるだけ。\n    if (currentComponent === topComponent) {\n      controllers[index] = controller\n      components[index] = component\n    }\n    endFirstComputation()\n    if (component === null) {\n      removeRootElement(root, index)\n    }\n    return controllers[index]\n  } else {\n    if (component == null) {\n      removeRootElement(root, index)\n    }\n    if (previousRoute) {\n      currentRoute = previousRoute\n    }\n  }\n}\n```\n`isPrevented`でない場合、`m.redraw.strategy`は[`m.prop`](https://github.com/lhorie/mithril.js/blob/0159cd667ad85cd82d92fcb31a33f75be6539f6d/mithril.js#L1553)だから、`all`を初期値としてセット。\n`startComputation`を呼び出しているのでここでredrawのカウンタが始まる。\n\nComponentを作ってからControllerをインスタンス化してる。`currentComponent === topComponent`はよくわからん。`currentComponent = topComponent = ほにゃらら`って必ずどちらも通る分岐に書いてあるし、常にtrueになるんでは？\n\nで、[`endFirstComputation`](https://github.com/lhorie/mithril.js/blob/0159cd667ad85cd82d92fcb31a33f75be6539f6d/mithril.js#L1578)は`endComputation`に読み替えていい。\n\nここでこのDOMの描画のカウンタが終了した。初回の描画はとにかくComponentをインスタンス化するだけのようだ。詳しい描画処理については別の部分を見ないとダメみたいだ。(`endComputation`の`m.redraw`呼び出しなんだけど)\n\nあと、どうやら`m.mount(document.body)`が合法という事らしい。\n\n[`removeRootElement`](https://github.com/lhorie/mithril.js/blob/0159cd667ad85cd82d92fcb31a33f75be6539f6d/mithril.js#L1512)はメソッド名通り、DOM要素からControllerやComponent、仮想DOMのCacheなどを削除している。\n\nところで、描画の処理が全然わからないので続く。'}},function(n,e){n.exports={title:"mithriljsのコードを読む(2)",slug:"reading-mithriljs-2",utime:1472042534,date:"2016/08/24 21:42:14",tags:["javascript","mithril"],publish:!0,body:'さて、前回は`m.mount`の内容を見たところ、描画についてはわからなかった。\n\n`endComputation`内で呼んでいる`m.redraw`の正体を暴こう。\n\n[ここ](https://github.com/lhorie/mithril.js/blob/0159cd667ad85cd82d92fcb31a33f75be6539f6d/mithril.js#L1522)\n```javascript\nm.redraw = function (force) {\n  if (redrawing) return\n  redrawing = true\n  if (force) forcing = true\n  try {\n    // lastRedrawId is a positive number if a second redraw is requested\n    // before the next animation frame\n    // lastRedrawId is null if it\'s the first redraw and not an event\n    // handler\n    // 超意訳: lastRedrawIdはフレームの更新が必要な時に正の数値を持つ。\n    if (lastRedrawId && !force) {\n      // when setTimeout: only reschedule redraw if time between now\n      // and previous redraw is bigger than a frame, otherwise keep\n      // currently scheduled timeout\n      // when rAF: always reschedule redraw\n      // 超意訳: フレームの更新時間が規定を超えていれば更新する\n      if ($requestAnimationFrame === global.requestAnimationFrame ||\n          new Date() - lastRedrawCallTime > FRAME_BUDGET) {\n        if (lastRedrawId > 0) $cancelAnimationFrame(lastRedrawId)\n        lastRedrawId = $requestAnimationFrame(redraw, FRAME_BUDGET)\n      }\n    } else {\n      redraw()\n      lastRedrawId = $requestAnimationFrame(function () {\n        lastRedrawId = null\n      }, FRAME_BUDGET)\n    }\n  } finally {\n    redrawing = forcing = false\n  }\n}\n```\nここではフレームの更新有無を判定している。再描画処理の本体は`redraw`という内部関数のようだ。\n\n[ここ](https://github.com/lhorie/mithril.js/blob/0159cd667ad85cd82d92fcb31a33f75be6539f6d/mithril.js#L1554)\n```javascript\nfunction redraw() {\n  if (computePreRedrawHook) {\n    computePreRedrawHook()\n    computePreRedrawHook = null\n  }\n  forEach(roots, function (root, i) {\n    var component = components[i]\n    if (controllers[i]) {\n      var args = [controllers[i]]\n      m.render(root,\n        component.view ? component.view(controllers[i], args) : "")\n    }\n  })\n  // after rendering within a routed context, we need to scroll back to\n  // the top, and fetch the document title for history.pushState\n  // 訳: routeされているコンテキスト(うまく訳せない)内での描画後、ドキュメントのトップにスクロールする必要がある。\n  //     後history.pushStateするためのドキュメントのタイトルを取得する\n  if (computePostRedrawHook) {\n    computePostRedrawHook()\n    computePostRedrawHook = null\n  }\n  lastRedrawId = null\n  lastRedrawCallTime = new Date()\n  m.redraw.strategy("diff")\n}\n```\n溜め込まれた`roots`のviewを`m.render`に渡している。いよいよ核心に迫ってきた感出てきた。\n\n`computePreRedrawHook`と`computePostRedrawHook`は訳に書いてある処理をやっているだけ。描画が終われば`m.redraw.strategy`がdiffに更新されて、差分だけの更新になるわけだ。\n\n`m.render`を見てみよう。\n\n[ここ](https://github.com/lhorie/mithril.js/blob/0159cd667ad85cd82d92fcb31a33f75be6539f6d/mithril.js#L1316)\n```javascript\nm.render = function (root, cell, forceRecreation) {\n  if (!root) {\n    throw new Error("Ensure the DOM element being passed to " +\n      "m.route/m.mount/m.render is not undefined.")\n  }\n  var configs = []\n  var id = getCellCacheKey(root)\n  var isDocumentRoot = root === $document\n  var node\n\n  if (isDocumentRoot || root === $document.documentElement) {\n    node = documentNode\n  } else {\n    node = root\n  }\n\n  if (isDocumentRoot && cell.tag !== "html") {\n    cell = {tag: "html", attrs: {}, children: cell}\n  }\n\n  if (cellCache[id] === undefined) clear(node.childNodes)\n  if (forceRecreation === true) reset(root)\n\n  cellCache[id] = build(\n    node,\n    null,\n    undefined,\n    undefined,\n    cell,\n    cellCache[id],\n    false,\n    0,\n    null,\n    undefined,\n    configs)\n\n  forEach(configs, function (config) { config() })\n}\n```\n\nmithrilでは仮想DOMをcellと呼んでいるようで、`getCellCacheKey`はキャッシュされているrootの仮想DOMのidを取得している。\n\nで、nodeはまさにDOMのノードの事(まさに本当の意味でのDOMオブジェクト)で、キャッシュされていないDOMの場合、`clear`を呼び出している。\n\n```javascript\nfunction clear(nodes, cached) {\n  for (var i = nodes.length - 1; i > -1; i--) {\n    if (nodes[i] && nodes[i].parentNode) {\n      try {\n        nodes[i].parentNode.removeChild(nodes[i])\n      } catch (e) {\n        /* eslint-disable max-len */\n        // ignore if this fails due to order of events (see\n        // http://stackoverflow.com/questions/21926083/failed-to-execute-removechild-on-node)\n        /* eslint-enable max-len */\n      }\n      cached = [].concat(cached)\n      if (cached[i]) unload(cached[i])\n    }\n  }\n  // release memory if nodes is an array. This check should fail if nodes\n  // is a NodeList (see loop above)\n  if (nodes.length) {\n    nodes.length = 0\n  }\n}\n```\n\n`clear`は一番後ろの子ノードを親から削除している。ループ処理の対象の長さを変えてしまう倫理観は別の問題として、要するにこれは子ノードを一掃するだけの関数だ。\n\n`m.render`に戻ろう。\n\nようやくたどり着いた`build`がDOM作成の本体だ。\n\nこれがまたしんどそうなので次回'}},function(n,e){n.exports={title:"mithriljsのコードを読む(3)",slug:"reading-mithriljs-3",utime:1472123644,date:"2016/08/25 20:14:04",tags:["javascript","mithril"],publish:!0,body:'`build`の中身読むぞ〜〜〜〜\n\n[ここ](https://github.com/lhorie/mithril.js/blob/0159cd667ad85cd82d92fcb31a33f75be6539f6d/mithril.js#L916)\n\nまず長いコメントが目を引くのでそれを片付ける。\n```javascript\nfunction build(\n  parentElement,\n  parentTag,\n  parentCache,\n  parentIndex,\n  data,\n  cached,\n  shouldReattach,\n  index,\n  editable,\n  namespace,\n  configs\n) {\n  /*\n   * `build` is a recursive function that manages creation/diffing/removal\n   * of DOM elements based on comparison between `data` and `cached` the\n   * diff algorithm can be summarized as this:\n   *\n   * 1 - compare `data` and `cached`\n   * 2 - if they are different, copy `data` to `cached` and update the DOM\n   *     based on what the difference is\n   * 3 - recursively apply this algorithm for every array and for the\n   *     children of every virtual element\n```\n\nアルゴリズムは以下の通り。\n\n1. `data`と`cached`を比較する\n2. 差分があれば`cached`に`data`をコピーして差分に基づいた更新をDOMに対して行う\n3. 全ての`data`の配列と仮想要素の子に対して上記工程を全て再帰的に適用する\n\nなかなかシンプルだ。そして、差分産出の要となる`data`と`cached`についての説明が続く。\n```javascript\n   * The `cached` data structure is essentially the same as the previous\n   * redraw\'s `data` data structure, with a few additions:\n   * - `cached` always has a property called `nodes`, which is a list of\n   *    DOM elements that correspond to the data represented by the\n   *    respective virtual element\n   * - in order to support attaching `nodes` as a property of `cached`,\n   *    `cached` is *always* a non-primitive object, i.e. if the data was\n   *    a string, then cached is a String instance. If data was `null` or\n   *    `undefined`, cached is `new String("")`\n   * - `cached also has a `configContext` property, which is the state\n   *    storage object exposed by config(element, isInitialized, context)\n   * - when `cached` is an Object, it represents a virtual element; when\n   *    it\'s an Array, it represents a list of elements; when it\'s a\n   *    String, Number or Boolean, it represents a text node\n```\n\n`cached`は前回再描画した`data`のデータ構造と本質的には同じデータ構造である。以下補足。\n- `cached`は常に`nodes`と呼ばれるプロパティを持つ。`nodes`はそれぞれの仮想要素に対応するDOM要素のリストである。\n- `cached`のプロパティとして`nodes`をくっつけられるように`cached`は*常に*プリミティブでないオブジェクトである。(例えば文字列データはcachedにおいてはString型となる。`null`や`undefined`であればcachedは`new String(\'\')`とする)\n- `cached`は`configContext`プロパティも持っている。これは`config`によって作成された状態を保持するためのものである。\n- `cached`がObject型である場合、仮想要素を表している。Array型だった場合は要素のリストであり、String, Number, Boolean型の場合はテキストノードとなる。\n\nつまり、`cached`は純粋なjavascriptの型ではなくDOMオブジェクトとして子ノードを持ちうる状態であることらしい。\n\n以降は残りの引数についてのコメント。\n```javascript\n   * `parentElement` is a DOM element used for W3C DOM API calls\n   * `parentTag` is only used for handling a corner case for textarea\n   * values\n   * `parentCache` is used to remove nodes in some multi-node cases\n   * `parentIndex` and `index` are used to figure out the offset of nodes.\n   * They\'re artifacts from before arrays started being flattened and are\n   * likely refactorable\n   * `data` and `cached` are, respectively, the new and old nodes being\n   * diffed\n   * `shouldReattach` is a flag indicating whether a parent node was\n   * recreated (if so, and if this node is reused, then this node must\n   * reattach itself to the new parent)\n   * `editable` is a flag that indicates whether an ancestor is\n   * contenteditable\n   * `namespace` indicates the closest HTML namespace as it cascades down\n   * from an ancestor\n   * `configs` is a list of config functions to run after the topmost\n   * `build` call finishes running\n   *\n   * there\'s logic that relies on the assumption that null and undefined\n   * data are equivalent to empty strings\n   * - this prevents lifecycle surprises from procedural helpers that mix\n   *   implicit and explicit return statements (e.g.\n   *   function foo() {if (cond) return m("div")}\n   * - it simplifies diffing code\n   */\n```\n| 引数 | 説明 |\n|------|------|\n|parentElement|W3C DOM APIが呼んでいるDOM要素|\n|parentTag|textareaの値の処理の場合にのみ使われる|\n|parentCache|複数のノードが存在する場合にノードを削除するために使われる|\n|parentIndex, index|ノードのオフセットを算出するために使用される|\n|data|差分算出の新しい方|\n|cached|差分算出の古い方|\n|shouldReattach|親ノードを再作成するかしないかを判定するフラグ|\n|editable|祖先の要素がcontenteditableかどうかを判定するフラグ|\n|namespace|直近のHTML名前空間(祖先からカスケードダウンしてくる)|\n|configs|buildの実行が終わった後に動くconfig関数のリスト|\n\nで、この処理でやってることを上から見ていくと`data`がtoStringできるかどうかを判定し、cacheを作り、`data`のデータ型によって処理を分けている。\n\n```javascript\n  data = dataToString(data)\n  if (data.subtree === "retain") return cached\n  cached = makeCache(data, cached, index, parentIndex, parentCache)\n\n  if (isArray(data)) {\n    return buildArray(\n      data,\n      cached,\n      parentElement,\n      index,\n      parentTag,\n      shouldReattach,\n      editable,\n      namespace,\n      configs)\n  } else if (data != null && isObject(data)) {\n    return buildObject(\n      data,\n      cached,\n      editable,\n      parentElement,\n      index,\n      shouldReattach,\n      namespace,\n      configs)\n  } else if (!isFunction(data)) {\n    return handleTextNode(\n      cached,\n      data,\n      index,\n      parentElement,\n      shouldReattach,\n      editable,\n      parentTag)\n  } else {\n    return cached\n  }\n}\n```\n\n- Arrayだったら`buildArray`\n- Objectだったら`buildObject`\n- 上のデータ型でもFunctionでもなかったら`handleTextNode`\n- それでも条件が異なればcachedを返却\n\nとそれぞれ分岐している。\n\n`buildArray`は何をしているんだろう。[ここ](https://github.com/lhorie/mithril.js/blob/0159cd667ad85cd82d92fcb31a33f75be6539f6d/mithril.js#L584)\n\n```javascript\nfunction buildArray(\n  data,\n  cached,\n  parentElement,\n  index,\n  parentTag,\n  shouldReattach,\n  editable,\n  namespace,\n  configs\n) {\n  data = flatten(data)\n  var nodes = []\n  var intact = cached.length === data.length\n  var subArrayCount = 0\n```\n\n`key`を使うことで余計な要素の再作成を避けている。アルゴリズムはこうだ。\n\n```javascript\n  // keys algorithm: sort elements without recreating them if keys are\n  // present\n  //\n  // 1) create a map of all existing keys, and mark all for deletion\n  // 2) add new keys to map and mark them for addition\n  // 3) if key exists in new list, change action from deletion to a move\n  // 4) for each key, handle its corresponding action as marked in\n  //    previous steps\n```\n\n1. 存在している全てのkeysのマップを作成し、削除処理のためにマークする。\n2. マップに新しいkeysを追加し、それらを追加処理のためにマークする。\n3. keyが新しいリストに存在しているなら、削除処理から移動へとアクションを変更する。\n4. それぞれのkeyについて、ステップ3で決められたマークに対応するアクションを処理する。\n\nわかるようでイマイチわからないので大人しくコードを読み進める。\n\n```javascript\n  var existing = {}\n  var shouldMaintainIdentities = false\n\n  forKeys(cached, function (attrs, i) {\n    shouldMaintainIdentities = true\n    existing[cached[i].attrs.key] = {action: DELETION, index: i}\n  })\n```\n\nなるほど、`cached`をループして、アクションを`DELTION`に設定している。ステップ1だ。\n\n```javascript\n  buildArrayKeys(data)\n```\n\n今度は`buildArrayKeys`ですか(;´Д`)\n```javascript\nfunction buildArrayKeys(data) {\n  var guid = 0\n  forKeys(data, function () {\n    forEach(data, function (attrs) {\n      if ((attrs = attrs && attrs.attrs) && attrs.key == null) {\n        attrs.key = "__mithril__" + guid++\n      }\n    })\n    return 1\n  })\n}\n```\n\n`data`の属性をループして`key`が設定されていなければ識別子として設定している。ステップ2だ。\n\nで、`cached`が存在してさえいれば`diffKeys`を呼んで終わり。\n\n```javascript\n  if (shouldMaintainIdentities) {\n    cached = diffKeys(data, cached, existing, parentElement)\n  }\n  // end key algorithm\n```\n\nだるい\n\n```javascript\nfunction diffKeys(data, cached, existing, parentElement) {\n  var keysDiffer = data.length !== cached.length\n\n  if (!keysDiffer) {\n    forKeys(data, function (attrs, i) {\n      var cachedCell = cached[i]\n      return keysDiffer = cachedCell &&\n        cachedCell.attrs &&\n        cachedCell.attrs.key !== attrs.key\n    })\n  }\n\n  if (keysDiffer) {\n    return handleKeysDiffer(data, existing, cached, parentElement)\n  } else {\n    return cached\n  }\n}\n```\n\n`data`と`cached`の要素数が同じであれば`cached`と`data`の`key`が違うかどうかを判定しcachedをそのまま返却。\n\nそうでなければ`handleKeysDiffer`を呼び出して返却値をそのまま返却。しんどい\n\n```javascript\nfunction handleKeysDiffer(data, existing, cached, parentElement) {\n  forKeys(data, function (key, i) {\n    existing[key = key.key] = existing[key] ? {\n      action: MOVE,\n      index: i,\n      from: existing[key].index,\n      element: cached.nodes[existing[key].index] ||\n        $document.createElement("div")\n    } : {action: INSERTION, index: i}\n  })\n```\n\n`data`の`key`がすでに存在している場合は`MOVE`のアクションが与えられている。`element`が`cached`の`nodes`が持つ要素か、新規作成のdiv要素になっている。\n\n`data`の`key`がまだ存在していなければ`INSERTION`のアクションが与えられている。\n\nで、actionsにexistingのプロパティの値を溜め込んで\n\n```javascript\n  var actions = []\n  for (var prop in existing) {\n    if (hasOwn.call(existing, prop)) {\n      actions.push(existing[prop])\n    }\n  }\n```\n\nアクションごとに処理してる。\n\n```javascript\n  var changes = actions.sort(sortChanges)\n  var newCached = new Array(cached.length)\n\n  newCached.nodes = cached.nodes.slice()\n\n  forEach(changes, function (change) {\n    var index = change.index\n    if (change.action === DELETION) {\n      clear(cached[index].nodes, cached[index])\n      newCached.splice(index, 1)\n    }\n    if (change.action === INSERTION) {\n      var dummy = $document.createElement("div")\n      dummy.key = data[index].attrs.key\n      insertNode(parentElement, dummy, index)\n      newCached.splice(index, 0, {\n        attrs: {key: data[index].attrs.key},\n        nodes: [dummy]\n      })\n      newCached.nodes[index] = dummy\n    }\n\n    if (change.action === MOVE) {\n      var changeElement = change.element\n      var maybeChanged = parentElement.childNodes[index]\n      if (maybeChanged !== changeElement && changeElement !== null) {\n        parentElement.insertBefore(changeElement,\n          maybeChanged || null)\n      }\n      newCached[index] = cached[change.from]\n      newCached.nodes[index] = changeElement\n    }\n  })\n```\n\n大して難しいことしてない。`newCached`で`cache`を更新し、アクションごとに削除、追加、移動をしている。\n\nで、戻ってくる。\n\n```javascript\n  var cacheCount = 0\n  // faster explicitly written\n  for (var i = 0, len = data.length; i < len; i++) {\n    // diff each item in the array\n    var item = build(\n      parentElement,\n      parentTag,\n      cached,\n      index,\n      data[i],\n      cached[cacheCount],\n      shouldReattach,\n      index + subArrayCount || subArrayCount,\n      editable,\n      namespace,\n      configs)\n\n    if (item !== undefined) {\n      intact = intact && item.nodes.intact\n      subArrayCount += getSubArrayCount(item)\n      cached[cacheCount++] = item\n    }\n  }\n\n  if (!intact) diffArray(data, cached, nodes)\n  return cached\n}\n```\n\n`data`の要素に対して`build`を呼び出し再帰処理している。　\n\n最後の`diffArray`は`data`と`cached`の長さが異なる場合に呼ばれ、内容としては`nodes`から`cached`の要素を削除して`data`の長さに合わせている。\n\n`cached`に残っている不要な要素を削除する目的のようだ。\n\nまだ全然終わらんが、疲れたので続く'}},function(n,e){n.exports={title:"mithriljsのコードを読む(4)",slug:"reading-mithriljs-4",utime:1472296703,date:"2016/08/27 20:18:23",tags:["javascript","mithril"],publish:!0,body:'前回は`buildArray`まで読んだ。`buildObject`から読もうではないか。\n\n[ここ](https://github.com/lhorie/mithril.js/blob/0159cd667ad85cd82d92fcb31a33f75be6539f6d/mithril.js#L831)\n\n```javascript\nfunction buildObject( // eslint-disable-line max-statements\n  data,\n  cached,\n  editable,\n  parentElement,\n  index,\n  shouldReattach,\n  namespace,\n  configs\n) {\n  var views = []\n  var controllers = []\n\n  data = markViews(data, cached, views, controllers)\n```\n\n`data`がオブジェクトの場合、つまりコンポーネントの場合は`markViews`で何かをしている。見てみる。\n\n```javascript\nfunction markViews(data, cached, views, controllers) {\n  var cachedControllers = cached && cached.controllers\n\n  while (data.view != null) {\n    data = checkView(\n      data,\n      data.view.$original || data.view,\n      cached,\n      cachedControllers,\n      controllers,\n      views)\n  }\n\n  return data\n```\n\nキャッシュされているControllerがないかを判定して`checkView`から`data`を作っている。見てみる。\n\n```javascript\nfunction checkView(\n  data,\n  view,\n  cached,\n  cachedControllers,\n  controllers,\n  views\n) {\n  var controller = getController(\n    cached.views,\n    view,\n    cachedControllers,\n    data.controller)\n\n  var key = data && data.attrs && data.attrs.key\n```\nバケツリレーで頭がフットーしそうだが、`getController`でControllerを取得しているのは明白だ。さらに、`data`の`key`を取得している。\n\nこの辺はキャッシュされている仮想DOMをアレコレするためだろう。`getController`を見てみる。\n\n```javascript\nfunction getController(views, view, cachedControllers, controller) {\n  var controllerIndex\n\n  if (m.redraw.strategy() === "diff" && views) {\n    controllerIndex = views.indexOf(view)\n  } else {\n    controllerIndex = -1\n  }\n\n  if (controllerIndex > -1) {\n    return cachedControllers[controllerIndex]\n  } else if (isFunction(controller)) {\n    return new controller()\n  } else {\n    return {}\n  }\n}\n```\n\n差分描画のフラグで且つコンポーネントが作成されていればキャッシュされているControllerを返し、そうでなければ引数の`controller`をインスタンス化するか空のオブジェクトを返す。\n\nまあその名の通りControllerを返しているだけだ。\n\n`checkView`に戻ると\n\n```javascript\n  if (pendingRequests === 0 ||\n      forcing ||\n      cachedControllers &&\n        cachedControllers.indexOf(controller) > -1) {\n    data = data.view(controller)\n  } else {\n    data = {tag: "placeholder"}\n  }\n```\n\nこのif文は再描画を行える状態かキャッシュされているControllerが存在している場合に仮想DOM(`data.view`のreturn)を`data`に再代入している。\n\n```javascript\n\n  if (data.subtree === "retain") return data\n  data.attrs = data.attrs || {}\n  data.attrs.key = key\n  updateLists(views, controllers, view, controller)\n  return data\n}\n```\n\n`data.subtree === "retain"`であれば`data`の更新は行わない。ここは[ドキュメントにひっそりと書いてある。](http://mithril.js.org/mithril.html#persisting-dom-elements-across-route-changes)\n\n概要を書くと、retainが設定されていると`router`による画面再描画時にそのDOMは再構築されずにそのまま引き継がれるというもの。\nコンポーネントを使い回す時などに設定することになる。(この文脈でコンポーネントは`data`のこと)\n\nで、コンポーネントをキャッシュしている`views`と`controllers`に作成した`view`と`controller`突っ込んでいる。\n\n`buildObject`に戻ります。\n\n```javascript\n  if (data.subtree === "retain") return cached\n```\n\n上述した通り、retainの時はコンポーネントを使い回す。\n\n```javascript\n\n  if (!data.tag && controllers.length) {\n    throw new Error("Component template must return a virtual " +\n      "element, not an array, string, etc.")\n  }\n\n  data.attrs = data.attrs || {}\n  cached.attrs = cached.attrs || {}\n\n  var dataAttrKeys = Object.keys(data.attrs)\n  var hasKeys = dataAttrKeys.length > ("key" in data.attrs ? 1 : 0)\n\n  maybeRecreateObject(data, cached, dataAttrKeys)\n```\n\nここからはconfigの設定かな。`maybeRecreateObject`を見てみる。\n\n```javascript\nfunction maybeRecreateObject(data, cached, dataAttrKeys) {\n  // if an element is different enough from the one in cache, recreate it\n  if (isDifferentEnough(data, cached, dataAttrKeys)) {\n    if (cached.nodes.length) clear(cached.nodes)\n\n    if (cached.configContext &&\n        isFunction(cached.configContext.onunload)) {\n      cached.configContext.onunload()\n    }\n\n    if (cached.controllers) {\n      forEach(cached.controllers, function (controller) {\n        if (controller.onunload) {\n          controller.onunload({preventDefault: noop})\n        }\n      })\n    }\n  }\n}\n```\n\n差分があった時に再作成するような要素だった場合に再作成している。で、`diffrent enough`であることを`isDifferentEnough`で見ている。\n\n```javascript\nfunction isDifferentEnough(data, cached, dataAttrKeys) {\n  if (data.tag !== cached.tag) return true\n\n  if (dataAttrKeys.sort().join() !==\n      Object.keys(cached.attrs).sort().join()) {\n    return true\n  }\n\n  if (data.attrs.id !== cached.attrs.id) {\n    return true\n  }\n\n  if (data.attrs.key !== cached.attrs.key) {\n    return true\n  }\n\n  if (m.redraw.strategy() === "all") {\n    return !cached.configContext || cached.configContext.retain !== true\n  }\n\n  if (m.redraw.strategy() === "diff") {\n    return cached.configContext && cached.configContext.retain === false\n  }\n\n  return false\n}\n```\n\ntrueになるのは\n- attributesのキーがキャッシュされているのと異なる時\n- attrsのidがキャッシュされているのと異なる時\n- `key`がキャッシュされているのと異なる時\n- strategyが`all`でかつ、`config`がないまたはretainが設定されていない時\n- strategyが`diff`でかつ、`config`があってretainが設定されていない時\n\nちなみに、strategyは↓の通り\n| all | デフォルトの値。redrawのタイミングで現在のDOMを捨てて全部作り直す|\n| diff | 差分があったときだけその差分更新を行う |\n| none | redrawをすっ飛ばす。何も更新はしない |\n\n`all`でかつ`config`がない時というのがピンとこないが、おそらく`config`は`redraw`のタイミングで常に呼ばれるからキャッシュ前提のためだろう。\n\n```javascript\n\n  if (!isString(data.tag)) return\n```\n\nここはどういうことだかよくわからない。`tag`が文字型でなければエラーではなく無を返す…どういうことだ…\n\n[m()ではエラーにしてるぞ?](https://github.com/lhorie/mithril.js/blob/0159cd667ad85cd82d92fcb31a33f75be6539f6d/mithril.js#L168-L171)\n\nよくわからないのでgitterで聞いてる中。\n\n```javascript\n  var isNew = cached.nodes.length === 0\n\n  namespace = getObjectNamespace(data, namespace)\n  var node\n  if (isNew) {\n    node = constructNode(data, namespace)\n```\nここでDOM作ってる。\n\n```javascript\n    // set attributes first, then create children\n    var attrs = constructAttrs(data, node, namespace, hasKeys)\n```\n\nDOMにアトリビュートをセット\n\n```javascript\n    // add the node to its parent before attaching children to it\n    insertNode(parentElement, node, index)\n```\n\n子ノードとして親要素に追加\n\n```javascript\n    var children = constructChildren(data, node, cached, editable,\n      namespace, configs)\n```\n\n子ノードを作成。この中でさらに`build`を呼んで子ノードのDOMを作成している。\n\n```javascript\n    cached = reconstructCached(\n      data,\n      attrs,\n      children,\n      node,\n      namespace,\n      views,\n      controllers)\n  } else {\n    node = buildUpdatedNode(\n      cached,\n      data,\n      editable,\n      hasKeys,\n      namespace,\n      views,\n      configs,\n      controllers)\n  }\n\n```\n\n初回の`build`であればキャッシュを作り、そうでなければ`data`の情報で`cached`を更新する。\n\n```javascript\n  // edge case: setting value on <select> doesn\'t work before children\n  // exist, so set it again after children have been created/updated\n  if (data.tag === "select" && "value" in data.attrs) {\n    setAttributes(node, data.tag, {value: data.attrs.value}, {},\n      namespace)\n  }\n  if (!isNew && shouldReattach === true && node != null) {\n    insertNode(parentElement, node, index)\n  }\n\n  // The configs are called after `build` finishes running\n  scheduleConfigsToBeCalled(configs, data, node, isNew, cached)\n\n  return cached\n}\n```\nどうやらselectタグが指定されていた場合は子要素がないとうまく動かないとのことでもう一度属性の設定をしている。\n\nで、必要に応じて`node`を`index`の位置に追加して最後に`data`の`config`を`configs`に突っ込んで終了。\n\n\nとりあえずこれでおしまいなんだが、まだあるんや…'
}},function(n,e){n.exports={title:null,slug:"reading-mithriljs-5",utime:1472379897,date:"2016/08/28 19:24:57",tags:[null],publish:!1,body:""}},function(n,e){n.exports={title:"pythonでカリー化",slug:"pycurry",utime:1474465827,date:"2016/09/21 22:50:27",tags:["python"],publish:!0,body:"やり尽くされてるだろうけどpythonでカリー化を実装してみました\n\n```\nimport functools\n\n\nclass ArgumentCountError(Exception):\n    pass\n\n\ndef curry(function):\n    name = function.__name__\n    argcount = function.__code__.co_argcount\n    varnames = function.__code__.co_varnames\n    class Factory:\n        def __init__(self, function, params=None):\n            self.function = function\n            self._params = params if params else tuple()\n\n        @property\n        def name(self):\n            return name\n\n        @property\n        def argcount(self):\n            return argcount\n\n        @property\n        def varnames(self):\n            return varnames\n\n        def __call__(self, *args):\n            params = self._params + args\n            if self.argcount < len(params):\n                raise ArgumentCountError\n            elif self.argcount == len(params):\n                return self.function(*args)\n            else:\n                return self.__class__(functools.partial(self.function, *args), params)\n\n        def __str__(self):\n            params = ', '.join(\n                '{}={}'.format(*x) for x in zip(self.varnames, self._params)\n            ) if self._params else 'NO PARAM SUPPLIED'\n            return '<{}: {}>'.format(self.name, params)\n    return Factory(function)\n\n\nif __name__ == '__main__':\n    @curry\n    def add(x, y, z):\n        return x + y + z\n\n    assert add(1, 2, 3) == add(1, 2)(3) == add(1)(2)(3) == 6\n```\n\n特に工夫はしてないです"}},function(n,e){n.exports={title:"mithirl.jsのospec使ってみる",slug:"mithril-ospec",utime:1477227895,date:"2016/10/23 22:04:55",tags:["mithril"],publish:!0,body:"rewriteいいですね。mithrilのコードリーディングは完全に挫折したけどもうrewriteブランチを追うことにするのでいいやという感じ。\n\nrewriteブランチには[ospec](https://www.npmjs.com/package/ospec)というフルスクラッチのテストフレームワークがあってやばくなっているので見てみます。\n\n機能としては\n- テストのグループ化\n- アサーション\n- スパイ\n- `equals`, `notEquals`, `deepEquals`, `notDeepEquals`のアサーションタイプ\n- `before`/`after`/`beforeEach`/`afterEach`の各フック\n- 排他テスト(`.only`とか)\n- 非同期なテストとフック\nということで一通り必要なものは揃っている印象です。\n\n[APIも小柄です。](https://github.com/lhorie/mithril.js/tree/rewrite/ospec#api)\n\n# インストール\n`npm i ospec`\n\n# 使い方\n詳しくは[ドキュメント](https://github.com/lhorie/mithril.js/blob/rewrite/ospec/README.md)を見てください。\n\n## 基本的な使い方\n基本的な使い方は`o.spec`でテストのグループ化をして`o`でテストを作成。`o.run`でテストを実行という流れです。\n```javascript\nfunction kebabify(v) {\n  if (typeof v !== 'string') return null;\n  return v.split('').join('-');\n}\n\nvar o = require('ospec');\n\no.spec('kebabify', function() {\n  o('return kebabed string if passed string', function() {\n    o(kebabify('hoge')).equals('h-o-g-e');\n  })\n  o('return null if passed not string', function() {\n    o(kebabify(123)).equals(null);\n  })\n});\n\no.run();\n```\n\nテストが通るとアサーションの数だけが表示されます。\n> 2 assertions completed in 23ms\n\nテストが失敗するとどこで失敗したかが最低限表示されます。\n>kebabify > shoud return null if passed not string: null should equal \"1-2-3\"\n>\n> at /Users/boku/work/jswork/hoge/tests/one.js:13:22\n>\n>\n> 2 assertions completed in 23ms\n\n素っ気ないですね。\n\n`o.spec`はネストできます。\n\n```javascript\nfunction _anyfy(v, sign) {\n  if (typeof v !== 'string') return null;\n  return v.split('').join(sign);\n}\n\nfunction kebabify(v) { return _anyfy(v, '-') }\nfunction snakify(v) { return _anyfy(v, '_') }\n\nvar o = require('ospec');\n\no.spec('string case', function() {\n  o.spec('kebabify', function() {\n    o('shoud return kebabed string if passed string', function() {\n      o(kebabify('hoge')).equals('h-o-g-e');\n    })\n    o('shoud return null if passed not string', function() {\n      o(kebabify(123)).equals(null);\n    })\n  });\n  o.spec('snakify', function() {\n    o('shoud return snaked string if passed string', function() {\n      o(snakify('hoge')).equals('h_o_g_e');\n    })\n    o('shoud return null if passed not string', function() {\n      o(snakify(123)).equals(null);\n    })\n  });\n});\n\no.run();\n```\n\nまた、`bin`に`ospec`があるのでコマンドで呼び出すこともできます。コマンドで呼び出す場合は`tests/*.js`がテスト定義ファイルとみなされます。\n\n## スタブ\n`o.spy`はスタブとして利用できます。例えばコールバック関数を引数に取る関数をテストする時に利用できるわけです。\n\n```javascript\nfunction one(cb, x, y) {\n  console.log('yeah, wow, wow, yeah');\n  cb(x, y);\n  console.log('oh...');\n  cb(x, y);\n  console.log('hey...');\n}\n\nvar o = require('ospec');\n\no.spec('one()', function() {\n  o('shoud work for me.', function() {\n    var spy = o.spy();\n    one(spy, 10, 100);\n    o(spy.callCount).equals(2);\n    o(spy.args).deepEquals([10, 100]);\n  });\n});\n\no.run();\n```\n\n`o.spy`が返却するオブジェクトは`callCount`と`args`という属性を持っています。それぞれ呼ばれた回数とスタブ関数に**最後に渡された**引数の配列です。\n\n## 非同期テスト\nテストのスコープを作っている関数に引数を渡すとそれは非同期なものとみなされます。その引数はテスト完了時に必ず一度呼び出される関数です。\n\n慣例的には`done`とかつけるみたいです。\n\n```javascript\nfunction asyncFunc(cb, wait) {\n  wait = wait || 20;\n  setTimeout(cb(), wait);\n}\n\nvar o = require('ospec');\n\no('setTimeout calls callback', function(done, timeout) {\n  timeout(50);\n  asyncFunc(done, 10);\n});\n\no.run();\n```\n\nあまりいい例じゃないけど(;´Д`)\n\nちなみにデフォルトで非同期テストのタイムアウトは`20ms`とのことでこれはテストのスコープを作ってる関数の第二引数に渡す関数によって設定を変えられる。\n\nこの引数は慣例的に`timeout`と名付けるのがいいようだ。\n\n`done`が実行されれば成功してタイムアウトすると失敗とのことだけど、何度やっても成功してしまう。謎い。\n\n## フック\nテストの実行タイミングのフックがあります。\n`before`と`after`はテストグループの実行前後に一度だけ実行されるフックです。\n```javascript\nfunction id(x) { return x; }\n\nvar o = require('ospec');\n\no.spec('double', function() {\n  var acc;\n  o.before(function() {\n    acc = 0;\n  });\n  o('should return himself.', function() {\n    acc++;\n    o(id(acc)).equals(1);\n  });\n  o('should return himself again.', function() {\n    acc++\n    o(id(acc)).equals(2);\n  });\n});\n\no.run();\n```\n\nちなみにテストの実行される順番は定義順ぽいですね。\n\n`beforeEach`と`afterEach`はテストごとの実行前後のフックです。\n```javascript\nfunction id(x) { return x; }\n\nvar o = require('ospec');\n\no.spec('double', function() {\n  var acc;\n  o.beforeEach(function() {\n    acc = 0;\n  });\n  o('should return himself.', function() {\n    acc++;\n    o(id(acc)).equals(1);\n  });\n  o('should return himself again.', function() {\n    acc--;\n    o(id(acc)).equals(-1);\n  });\n});\n\no.run();\n```\n\nフックの関数に`done`を渡すと非同期なフックとなります。`done`が実行された前後にテストがはしります。\n```javascript\nfunction id(x) { return x; }\n\nvar o = require('ospec');\n\no.spec('double', function() {\n  var acc;\n  o.beforeEach(function(done) {\n    acc = 0;\n    done();\n  });\n\n  // 非同期フックが完了したらテストが実行される。\n  o('should return himself.', function() {\n    acc++;\n    o(id(acc)).equals(1);\n  });\n  o('should return himself again.', function() {\n    acc--;\n    o(id(acc)).equals(-1);\n  });\n});\n\no.run();\n```\n\nでもこれテストの結果に`beforeEach`内の非同期処理のアサーションも計上されているので微妙です。\n\n## 排他的テスト\n`o.only`によってそのテストだけを実行できます。\n```javascript\nvar o = require('ospec');\n\no.spec('test', function() {\n  o('does not run.', function() {\n    o(1 + 1).equals(2);\n  });\n\n  o.only('runs', function() {\n    o(1 * 10).equals(10);\n  });\n});\n\no.run();\n```\n\n> 1 ssertions completed in 22ms\n\n## テストの並列実行\n`o.new`することで新たな`o`のオブジェクトが生成できるので\n```javascript\nvar o = require('o');\nvar _o = o.new();\n...\no.run();\n_o.runt();\n```\n\nとして並列にテストが実行できます。\n\n\nまだまだ荒削りな部分がありますが、多機能になりすぎて肥大化するよりかはマシだと感じます。js界隈のテストフレームワークは覚えるのと環境を整えるが億劫というのがあるのでこのくらいシンプルでいいのではという気づきがありますね。"}},function(n,e){n.exports="2017/02/23/try-to-understand-ownership.yml 2016/10/23/mithril-ospec.yml 2016/09/21/pycurry.yml 2016/08/27/reading-mithriljs-4.yml 2016/08/25/reading-mithriljs-3.yml 2016/08/24/reading-mithriljs-2.yml 2016/08/22/reading-mithriljs.yml 2016/07/29/js-test-with-karma-webpack-es6.yml 2016/05/05/module-global-vs-class-variable.yml 2016/04/14/rop.yml 2016/03/21/pipe.yml 2016/03/19/v8-optimization.yml 2016/03/13/pyazo.yml 2016/02/26/expert-python-chapter3.yml 2016/02/21/mithrilify.yml 2016/02/14/moved-to-gh-page.yml"},function(n,e,t){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}function i(n){var e=n.props;return(0,o["default"])("div#article-list-wrapper",[(0,o["default"])("div#article-list",e.map(function(n){return(0,o["default"])("div.title",[(0,o["default"])("a[href='/blog/article/"+n.href+"']",{config:o["default"].route},n.title),(0,o["default"])("span.post-date","("+n.date+")")])})),(0,o["default"])("div#footer-trans"),(0,o["default"])("div#footer",[(0,o["default"])('a[href="/"]',{config:o["default"].route},(0,o["default"])('img[src="../../../../assets/img/avatar.png"]'))])])}Object.defineProperty(e,"__esModule",{value:!0});var a=t(1),o=r(a);e["default"]=i},function(n,e,t){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}Object.defineProperty(e,"__esModule",{value:!0});var i=t(32),a=r(i),o=t(34),u=r(o);e["default"]={controller:a["default"],view:u["default"]}},function(n,e,t){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}function i(){return{data:(0,s["default"])(o["default"].route.param("date"),o["default"].route.param("slug"))}}Object.defineProperty(e,"__esModule",{value:!0});var a=t(1),o=r(a),u=t(33),s=r(u);e["default"]=i},function(n,e,t){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}function i(n,e){var t=o["default"].parseYaml(),r=s["default"].compact(t.map(function(t){return t.date.split(" ")[0]===n&&t.slug===e?t:void 0}));return r[0]}Object.defineProperty(e,"__esModule",{value:!0});var a=t(9),o=r(a),u=t(10),s=r(u);e["default"]=i},function(n,e,t){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}function i(n){var e=n.data;return(0,o["default"])("section",[(0,o["default"])("header",[(0,o["default"])("h1",e.title),(0,o["default"])("div#description",e.description),(0,o["default"])("div#article-date",[(0,o["default"])('span.glyphicon.glyphicon-time[aria-hidden="true"]'),e.date]),(0,o["default"])("div#tags",e.tags.map(function(n){return(0,o["default"])("span.tag",(0,o["default"])("a[href='/blog/tag/"+n+"']",{config:o["default"].route},[(0,o["default"])('span.glyphicon.glyphicon-tag[aria-hidden="true"]'),n]))}))]),(0,o["default"])("article",[(0,o["default"])("div#utime='"+e.utime+"'",o["default"].trust((0,s["default"])(e.body)))]),(0,o["default"])("footer",[(0,o["default"])("div#back",[(0,o["default"])('a.btn.btn-default[href="/blog/"]',{config:o["default"].route},"back")])])])}Object.defineProperty(e,"__esModule",{value:!0});var a=t(1),o=r(a),u=t(35),s=r(u);s["default"].setOptions({gfm:!0}),e["default"]=i},function(n,e,t){(function(e){(function(){function e(n){this.tokens=[],this.tokens.links={},this.options=n||c.defaults,this.rules=f.normal,this.options.gfm&&(this.options.tables?this.rules=f.tables:this.rules=f.gfm)}function t(n,e){if(this.options=e||c.defaults,this.links=n,this.rules=d.normal,this.renderer=this.options.renderer||new r,this.renderer.options=this.options,!this.links)throw new Error("Tokens array requires a `links` property.");this.options.gfm?this.options.breaks?this.rules=d.breaks:this.rules=d.gfm:this.options.pedantic&&(this.rules=d.pedantic)}function r(n){this.options=n||{}}function i(n){this.tokens=[],this.token=null,this.options=n||c.defaults,this.options.renderer=this.options.renderer||new r,this.renderer=this.options.renderer,this.renderer.options=this.options}function a(n,e){return n.replace(e?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function o(n){return n.replace(/&([#\w]+);/g,function(n,e){return e=e.toLowerCase(),"colon"===e?":":"#"===e.charAt(0)?"x"===e.charAt(1)?String.fromCharCode(parseInt(e.substring(2),16)):String.fromCharCode(+e.substring(1)):""})}function u(n,e){return n=n.source,e=e||"",function t(r,i){return r?(i=i.source||i,i=i.replace(/(^|[^\[])\^/g,"$1"),n=n.replace(r,i),t):new RegExp(n,e)}}function s(){}function l(n){for(var e,t,r=1;r<arguments.length;r++){e=arguments[r];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t])}return n}function c(n,t,r){if(r||"function"==typeof t){r||(r=t,t=null),t=l({},c.defaults,t||{});var o,u,s=t.highlight,f=0;try{o=e.lex(n,t)}catch(d){return r(d)}u=o.length;var h=function(n){if(n)return t.highlight=s,r(n);var e;try{e=i.parse(o,t)}catch(a){n=a}return t.highlight=s,n?r(n):r(null,e)};if(!s||s.length<3)return h();if(delete t.highlight,!u)return h();for(;f<o.length;f++)!function(n){return"code"!==n.type?--u||h():s(n.text,n.lang,function(e,t){return e?h(e):null==t||t===n.text?--u||h():(n.text=t,n.escaped=!0,void(--u||h()))})}(o[f])}else try{return t&&(t=l({},c.defaults,t)),i.parse(e.lex(n,t),t)}catch(d){if(d.message+="\nPlease report this to https://github.com/chjj/marked.",(t||c.defaults).silent)return"<p>An error occured:</p><pre>"+a(d.message+"",!0)+"</pre>";throw d}}var f={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:s,hr:/^( *[-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,nptable:s,lheading:/^([^\n]+)\n *(=|-){2,} *(?:\n+|$)/,blockquote:/^( *>[^\n]+(\n(?!def)[^\n]+)*\n*)+/,list:/^( *)(bull) [\s\S]+?(?:hr|def|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment *(?:\n|\s*$)|closed *(?:\n{2,}|\s*$)|closing *(?:\n{2,}|\s*$))/,def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,table:s,paragraph:/^((?:[^\n]+\n?(?!hr|heading|lheading|blockquote|tag|def))+)\n*/,text:/^[^\n]+/};f.bullet=/(?:[*+-]|\d+\.)/,f.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/,f.item=u(f.item,"gm")(/bull/g,f.bullet)(),f.list=u(f.list)(/bull/g,f.bullet)("hr","\\n+(?=\\1?(?:[-*_] *){3,}(?:\\n+|$))")("def","\\n+(?="+f.def.source+")")(),f.blockquote=u(f.blockquote)("def",f.def)(),f._tag="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:/|[^\\w\\s@]*@)\\b",f.html=u(f.html)("comment",/<!--[\s\S]*?-->/)("closed",/<(tag)[\s\S]+?<\/\1>/)("closing",/<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,f._tag)(),f.paragraph=u(f.paragraph)("hr",f.hr)("heading",f.heading)("lheading",f.lheading)("blockquote",f.blockquote)("tag","<"+f._tag)("def",f.def)(),f.normal=l({},f),f.gfm=l({},f.normal,{fences:/^ *(`{3,}|~{3,})[ \.]*(\S+)? *\n([\s\S]*?)\s*\1 *(?:\n+|$)/,paragraph:/^/,heading:/^ *(#{1,6}) +([^\n]+?) *#* *(?:\n+|$)/}),f.gfm.paragraph=u(f.paragraph)("(?!","(?!"+f.gfm.fences.source.replace("\\1","\\2")+"|"+f.list.source.replace("\\1","\\3")+"|")(),f.tables=l({},f.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/}),e.rules=f,e.lex=function(n,t){var r=new e(t);return r.lex(n)},e.prototype.lex=function(n){return n=n.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n"),this.token(n,!0)},e.prototype.token=function(n,e,t){for(var r,i,a,o,u,s,l,c,d,n=n.replace(/^ +$/gm,"");n;)if((a=this.rules.newline.exec(n))&&(n=n.substring(a[0].length),a[0].length>1&&this.tokens.push({type:"space"})),a=this.rules.code.exec(n))n=n.substring(a[0].length),a=a[0].replace(/^ {4}/gm,""),this.tokens.push({type:"code",text:this.options.pedantic?a:a.replace(/\n+$/,"")});else if(a=this.rules.fences.exec(n))n=n.substring(a[0].length),this.tokens.push({type:"code",lang:a[2],text:a[3]||""});else if(a=this.rules.heading.exec(n))n=n.substring(a[0].length),this.tokens.push({type:"heading",depth:a[1].length,text:a[2]});else if(e&&(a=this.rules.nptable.exec(n))){for(n=n.substring(a[0].length),s={type:"table",header:a[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:a[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:a[3].replace(/\n$/,"").split("\n")},c=0;c<s.align.length;c++)/^ *-+: *$/.test(s.align[c])?s.align[c]="right":/^ *:-+: *$/.test(s.align[c])?s.align[c]="center":/^ *:-+ *$/.test(s.align[c])?s.align[c]="left":s.align[c]=null;for(c=0;c<s.cells.length;c++)s.cells[c]=s.cells[c].split(/ *\| */);this.tokens.push(s)}else if(a=this.rules.lheading.exec(n))n=n.substring(a[0].length),this.tokens.push({type:"heading",depth:"="===a[2]?1:2,text:a[1]});else if(a=this.rules.hr.exec(n))n=n.substring(a[0].length),this.tokens.push({type:"hr"});else if(a=this.rules.blockquote.exec(n))n=n.substring(a[0].length),this.tokens.push({type:"blockquote_start"}),a=a[0].replace(/^ *> ?/gm,""),this.token(a,e,!0),this.tokens.push({type:"blockquote_end"});else if(a=this.rules.list.exec(n)){for(n=n.substring(a[0].length),o=a[2],this.tokens.push({type:"list_start",ordered:o.length>1}),a=a[0].match(this.rules.item),r=!1,d=a.length,c=0;d>c;c++)s=a[c],l=s.length,s=s.replace(/^ *([*+-]|\d+\.) +/,""),~s.indexOf("\n ")&&(l-=s.length,s=this.options.pedantic?s.replace(/^ {1,4}/gm,""):s.replace(new RegExp("^ {1,"+l+"}","gm"),"")),this.options.smartLists&&c!==d-1&&(u=f.bullet.exec(a[c+1])[0],o===u||o.length>1&&u.length>1||(n=a.slice(c+1).join("\n")+n,c=d-1)),i=r||/\n\n(?!\s*$)/.test(s),c!==d-1&&(r="\n"===s.charAt(s.length-1),i||(i=r)),this.tokens.push({type:i?"loose_item_start":"list_item_start"}),this.token(s,!1,t),this.tokens.push({type:"list_item_end"});this.tokens.push({type:"list_end"})}else if(a=this.rules.html.exec(n))n=n.substring(a[0].length),this.tokens.push({type:this.options.sanitize?"paragraph":"html",pre:!this.options.sanitizer&&("pre"===a[1]||"script"===a[1]||"style"===a[1]),text:a[0]});else if(!t&&e&&(a=this.rules.def.exec(n)))n=n.substring(a[0].length),this.tokens.links[a[1].toLowerCase()]={href:a[2],title:a[3]};else if(e&&(a=this.rules.table.exec(n))){for(n=n.substring(a[0].length),s={type:"table",header:a[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:a[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:a[3].replace(/(?: *\| *)?\n$/,"").split("\n")},c=0;c<s.align.length;c++)/^ *-+: *$/.test(s.align[c])?s.align[c]="right":/^ *:-+: *$/.test(s.align[c])?s.align[c]="center":/^ *:-+ *$/.test(s.align[c])?s.align[c]="left":s.align[c]=null;for(c=0;c<s.cells.length;c++)s.cells[c]=s.cells[c].replace(/^ *\| *| *\| *$/g,"").split(/ *\| */);this.tokens.push(s)}else if(e&&(a=this.rules.paragraph.exec(n)))n=n.substring(a[0].length),this.tokens.push({type:"paragraph",text:"\n"===a[1].charAt(a[1].length-1)?a[1].slice(0,-1):a[1]});else if(a=this.rules.text.exec(n))n=n.substring(a[0].length),this.tokens.push({type:"text",text:a[0]});else if(n)throw new Error("Infinite loop on byte: "+n.charCodeAt(0));return this.tokens};var d={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<([^ >]+(@|:\/)[^ >]+)>/,url:s,tag:/^<!--[\s\S]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^\b_((?:[^_]|__)+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,code:/^(`+)\s*([\s\S]*?[^`])\s*\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:s,text:/^[\s\S]+?(?=[\\<!\[_*`]| {2,}\n|$)/};d._inside=/(?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*/,d._href=/\s*<?([\s\S]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/,d.link=u(d.link)("inside",d._inside)("href",d._href)(),d.reflink=u(d.reflink)("inside",d._inside)(),d.normal=l({},d),d.pedantic=l({},d.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/}),d.gfm=l({},d.normal,{escape:u(d.escape)("])","~|])")(),url:/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:u(d.text)("]|","~]|")("|","|https?://|")()}),d.breaks=l({},d.gfm,{br:u(d.br)("{2,}","*")(),text:u(d.gfm.text)("{2,}","*")()}),t.rules=d,t.output=function(n,e,r){var i=new t(e,r);return i.output(n)},t.prototype.output=function(n){for(var e,t,r,i,o="";n;)if(i=this.rules.escape.exec(n))n=n.substring(i[0].length),o+=i[1];else if(i=this.rules.autolink.exec(n))n=n.substring(i[0].length),"@"===i[2]?(t=":"===i[1].charAt(6)?this.mangle(i[1].substring(7)):this.mangle(i[1]),r=this.mangle("mailto:")+t):(t=a(i[1]),r=t),o+=this.renderer.link(r,null,t);else if(this.inLink||!(i=this.rules.url.exec(n))){if(i=this.rules.tag.exec(n))!this.inLink&&/^<a /i.test(i[0])?this.inLink=!0:this.inLink&&/^<\/a>/i.test(i[0])&&(this.inLink=!1),n=n.substring(i[0].length),o+=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(i[0]):a(i[0]):i[0];else if(i=this.rules.link.exec(n))n=n.substring(i[0].length),this.inLink=!0,o+=this.outputLink(i,{href:i[2],title:i[3]}),this.inLink=!1;else if((i=this.rules.reflink.exec(n))||(i=this.rules.nolink.exec(n))){if(n=n.substring(i[0].length),e=(i[2]||i[1]).replace(/\s+/g," "),e=this.links[e.toLowerCase()],!e||!e.href){o+=i[0].charAt(0),n=i[0].substring(1)+n;continue}this.inLink=!0,o+=this.outputLink(i,e),this.inLink=!1}else if(i=this.rules.strong.exec(n))n=n.substring(i[0].length),o+=this.renderer.strong(this.output(i[2]||i[1]));else if(i=this.rules.em.exec(n))n=n.substring(i[0].length),o+=this.renderer.em(this.output(i[2]||i[1]));else if(i=this.rules.code.exec(n))n=n.substring(i[0].length),o+=this.renderer.codespan(a(i[2],!0));else if(i=this.rules.br.exec(n))n=n.substring(i[0].length),o+=this.renderer.br();else if(i=this.rules.del.exec(n))n=n.substring(i[0].length),o+=this.renderer.del(this.output(i[1]));else if(i=this.rules.text.exec(n))n=n.substring(i[0].length),o+=this.renderer.text(a(this.smartypants(i[0])));else if(n)throw new Error("Infinite loop on byte: "+n.charCodeAt(0))}else n=n.substring(i[0].length),t=a(i[1]),r=t,o+=this.renderer.link(r,null,t);return o},t.prototype.outputLink=function(n,e){var t=a(e.href),r=e.title?a(e.title):null;return"!"!==n[0].charAt(0)?this.renderer.link(t,r,this.output(n[1])):this.renderer.image(t,r,a(n[1]))},t.prototype.smartypants=function(n){return this.options.smartypants?n.replace(/---/g,"—").replace(/--/g,"–").replace(/(^|[-\u2014\/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014\/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…"):n},t.prototype.mangle=function(n){if(!this.options.mangle)return n;for(var e,t="",r=n.length,i=0;r>i;i++)e=n.charCodeAt(i),Math.random()>.5&&(e="x"+e.toString(16)),t+="&#"+e+";";return t},r.prototype.code=function(n,e,t){if(this.options.highlight){var r=this.options.highlight(n,e);null!=r&&r!==n&&(t=!0,n=r)}return e?'<pre><code class="'+this.options.langPrefix+a(e,!0)+'">'+(t?n:a(n,!0))+"\n</code></pre>\n":"<pre><code>"+(t?n:a(n,!0))+"\n</code></pre>"},r.prototype.blockquote=function(n){return"<blockquote>\n"+n+"</blockquote>\n"},r.prototype.html=function(n){return n},r.prototype.heading=function(n,e,t){return"<h"+e+' id="'+this.options.headerPrefix+t.toLowerCase().replace(/[^\w]+/g,"-")+'">'+n+"</h"+e+">\n"},r.prototype.hr=function(){return this.options.xhtml?"<hr/>\n":"<hr>\n"},r.prototype.list=function(n,e){var t=e?"ol":"ul";return"<"+t+">\n"+n+"</"+t+">\n"},r.prototype.listitem=function(n){return"<li>"+n+"</li>\n"},r.prototype.paragraph=function(n){return"<p>"+n+"</p>\n"},r.prototype.table=function(n,e){return"<table>\n<thead>\n"+n+"</thead>\n<tbody>\n"+e+"</tbody>\n</table>\n"},r.prototype.tablerow=function(n){return"<tr>\n"+n+"</tr>\n"},r.prototype.tablecell=function(n,e){var t=e.header?"th":"td",r=e.align?"<"+t+' style="text-align:'+e.align+'">':"<"+t+">";return r+n+"</"+t+">\n"},r.prototype.strong=function(n){return"<strong>"+n+"</strong>"},r.prototype.em=function(n){return"<em>"+n+"</em>"},r.prototype.codespan=function(n){return"<code>"+n+"</code>"},r.prototype.br=function(){return this.options.xhtml?"<br/>":"<br>"},r.prototype.del=function(n){return"<del>"+n+"</del>"},r.prototype.link=function(n,e,t){if(this.options.sanitize){try{var r=decodeURIComponent(o(n)).replace(/[^\w:]/g,"").toLowerCase()}catch(i){return""}if(0===r.indexOf("javascript:")||0===r.indexOf("vbscript:"))return""}var a='<a href="'+n+'"';return e&&(a+=' title="'+e+'"'),a+=">"+t+"</a>"},r.prototype.image=function(n,e,t){var r='<img src="'+n+'" alt="'+t+'"';return e&&(r+=' title="'+e+'"'),r+=this.options.xhtml?"/>":">"},r.prototype.text=function(n){return n},i.parse=function(n,e,t){var r=new i(e,t);return r.parse(n)},i.prototype.parse=function(n){this.inline=new t(n.links,this.options,this.renderer),this.tokens=n.reverse();for(var e="";this.next();)e+=this.tok();return e},i.prototype.next=function(){return this.token=this.tokens.pop()},i.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0},i.prototype.parseText=function(){for(var n=this.token.text;"text"===this.peek().type;)n+="\n"+this.next().text;return this.inline.output(n)},i.prototype.tok=function(){switch(this.token.type){case"space":return"";case"hr":return this.renderer.hr();case"heading":return this.renderer.heading(this.inline.output(this.token.text),this.token.depth,this.token.text);case"code":return this.renderer.code(this.token.text,this.token.lang,this.token.escaped);case"table":var n,e,t,r,i,a="",o="";for(t="",n=0;n<this.token.header.length;n++)r={header:!0,align:this.token.align[n]},t+=this.renderer.tablecell(this.inline.output(this.token.header[n]),{header:!0,align:this.token.align[n]});for(a+=this.renderer.tablerow(t),n=0;n<this.token.cells.length;n++){for(e=this.token.cells[n],t="",i=0;i<e.length;i++)t+=this.renderer.tablecell(this.inline.output(e[i]),{header:!1,align:this.token.align[i]});o+=this.renderer.tablerow(t)}return this.renderer.table(a,o);case"blockquote_start":for(var o="";"blockquote_end"!==this.next().type;)o+=this.tok();return this.renderer.blockquote(o);case"list_start":for(var o="",u=this.token.ordered;"list_end"!==this.next().type;)o+=this.tok();return this.renderer.list(o,u);case"list_item_start":for(var o="";"list_item_end"!==this.next().type;)o+="text"===this.token.type?this.parseText():this.tok();return this.renderer.listitem(o);case"loose_item_start":for(var o="";"list_item_end"!==this.next().type;)o+=this.tok();return this.renderer.listitem(o);case"html":var s=this.token.pre||this.options.pedantic?this.token.text:this.inline.output(this.token.text);return this.renderer.html(s);case"paragraph":return this.renderer.paragraph(this.inline.output(this.token.text));case"text":return this.renderer.paragraph(this.parseText())}},s.exec=s,c.options=c.setOptions=function(n){return l(c.defaults,n),c},c.defaults={gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,sanitizer:null,mangle:!0,smartLists:!1,silent:!1,highlight:null,langPrefix:"lang-",smartypants:!1,headerPrefix:"",renderer:new r,xhtml:!1},c.Parser=i,c.parser=i.parse,c.Renderer=r,c.Lexer=e,c.lexer=e.lex,c.InlineLexer=t,c.inlineLexer=t.output,c.parse=c,n.exports=c}).call(function(){return this||("undefined"!=typeof window?window:e)}())}).call(e,function(){return this}())},function(n,e,t){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}Object.defineProperty(e,"__esModule",{value:!0});var i=t(37),a=r(i),o=t(40),u=r(o);e["default"]={controller:a["default"],view:u["default"]}},function(n,e,t){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}function i(){return{props:(0,s["default"])(o["default"].route.param("name"))}}Object.defineProperty(e,"__esModule",{value:!0});var a=t(1),o=r(a),u=t(38),s=r(u);e["default"]=i},function(n,e,t){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}function i(n){return{tag:n,data:o["default"][n]}}Object.defineProperty(e,"__esModule",{value:!0});var a=t(39),o=r(a);e["default"]=i},function(n,e){n.exports={javascript:[{path:"2016/08/27/reading-mithriljs-4",title:"mithriljsのコードを読む(4)"},{path:"2016/08/25/reading-mithriljs-3",title:"mithriljsのコードを読む(3)"},{path:"2016/08/24/reading-mithriljs-2",title:"mithriljsのコードを読む(2)"},{path:"2016/08/22/reading-mithriljs",title:"mithriljsのコードを読む"},{path:"2016/07/29/js-test-with-karma-webpack-es6",title:"ES6で書いたコードをkarma+webpackでテスト"},{path:"2016/03/19/v8-optimization",title:"V8で最適化されないjavascript"},{path:"2016/02/21/mithrilify",title:"github pagesの構成を変えた"}],misc:[{path:"2016/02/14/moved-to-gh-page",title:"github pagesに引越し"}],mithril:[{path:"2016/10/23/mithril-ospec",title:"mithirl.jsのospec使ってみる"},{path:"2016/08/27/reading-mithriljs-4",title:"mithriljsのコードを読む(4)"},{path:"2016/08/25/reading-mithriljs-3",title:"mithriljsのコードを読む(3)"},{path:"2016/08/24/reading-mithriljs-2",title:"mithriljsのコードを読む(2)"},{path:"2016/08/22/reading-mithriljs",title:"mithriljsのコードを読む"},{path:"2016/02/21/mithrilify",title:"github pagesの構成を変えた"}],python:[{path:"2016/09/21/pycurry",title:"pythonでカリー化"},{path:"2016/05/05/module-global-vs-class-variable",title:"モジュールグローバルよりクラス変数の方がパフォーマンス的に有利"},{path:"2016/04/14/rop",title:"鉄道指向プログラミングをpythonで"},{path:"2016/03/21/pipe",title:"shellのパイプをpythonで実装"},{path:"2016/03/13/pyazo",title:"Gyazo APIのクライアントを雑に作った"},{path:"2016/02/26/expert-python-chapter3",title:"pythonの__new__とかtypeなど"},{path:"2016/02/21/mithrilify",title:"github pagesの構成を変えた"}],rust:[{path:"2017/02/23/try-to-understand-ownership",title:"Rust の所有権を理解する"}],webpack:[{path:"2016/02/21/mithrilify",title:"github pagesの構成を変えた"}]}},function(n,e,t){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}function i(n){var e=n.props;return(0,o["default"])("div",[(0,o["default"])("div#tag-header",(0,o["default"])("h2",[(0,o["default"])('span.glyphicon.glyphicon-tag[aria-hidden="true"]'),e.tag])),(0,o["default"])("div#tag-list",e.data.map(function(n){return(0,o["default"])("div",[(0,o["default"])("a[href='/blog/article/"+n.path+"']",{config:o["default"].route},n.title)])}))])}Object.defineProperty(e,"__esModule",{value:!0});var a=t(1),o=r(a);e["default"]=i},function(n,e){n.exports={title:"Rust の所有権を理解する",slug:"try-to-understand-ownership",utime:1487856435,date:"2017/02/23 22:27:15",tags:["rust"],publish:!0,body:'[Rustの公式ドキュメント](https://rust-lang-ja.github.io/the-rust-programming-language-ja/1.6/book/ownership.html)をじっくり咀嚼して、Rustコードを読み書きするしかないけどまずは概念をある程度理解していないと難しいので、できるだけ仲良くなろう。\n\nそのためにも静的型付けのコンパイル言語という未経験なパラダイムということもあるので語学のためにも一言一句レベルで馬鹿丁寧にドキュメントを読み砕く。\n\n特に、所有権、借用、参照は必ず理解しておきたいのでここでみておく。\n\n# 所有権\n> Rustでは 変数束縛 はある特性を持ちます。それは、束縛されているものの「所有権を持つ」ということです。 これは束縛がスコープから外れるとき、Rustは束縛されているリソースを解放するだろうということを意味します。\n\nとある。これはつまりこういうことだ。\n\n```rust\n{\n  let hoge = "var";  // 束縛\n  println!("{}", hoge);\n}\n// スコープから外れたのでリソースを解放している。\n// そのため、hoge を参照しようとするとエラーが発生。\nprintln!("{}", hoge);\n// error[E0425]: unresolved name `hoge`\n//  --> src/main.rs:6:20\n//    |\n//  6 |     println!("{}", hoge);\n//    |                    ^^^^ unresolved name\n// error: aborting due to previous error\n```\n\n言い換えると、`letを用いた変数束縛は、束縛されたスコープ内でのみ生存可能なリソースの所有権を持つ`という特性を持つと言えそうだ。\n\n# ムーブセマンティクス\n\n> しかし、ここではもっと微妙なことがあります。それは、Rustは与えられたリソースに対する束縛が 1つだけ あるということを保証するということです。\n\nここではリソースに対する束縛、つまり所有権が1つだけであることを保証するRustについて微妙だと言っている。そして以下のような例が挙げられている。\n\n```rust\nlet v = vec![1, 2, 3];\nlet v2 = v;\nprintln!("{}", v[0]);\n// error[E0382]: use of moved value: `v`\n//  --> src/main.rs:4:20\n//    |\n//  3 |     let v2 = v;\n//    |         -- value moved here\n//  4 |     println!("{}", v[0]);\n//    |                    ^ value used here after move\n//    |\n//    = note: move occurs because `v` has type `std::vec::Vec<i32>`, which does not implement the `Copy` trait\n// error: aborting due to previous error\n```\nここで発生したエラーの内容はムーブされた変数`v`を使うなということである。\n\n> 所有権を何か別のものに転送するとき、参照するものを「ムーブした」と言います。\n\nこれは別に微妙でもなんでもなくて、リソースを所有できるのは常に唯一なんらかのオブジェクトであることがわかる。だから`v`が所有していたリソースの`v2`への転送(ムーブ)と表現しているわけだ。\n\nこの動作の詳細についての解説がされている。\n\n> ベクタオブジェクトは スタック に保存され、 ヒープ に保存された内容（ [1, 2, 3] ）へのポインタを含みます。v を v2 にムーブするとき、それは v2 のためにそのポインタのコピーを作ります。 それは、ヒープ上のベクタの内容へのポインタが2つあることを意味します。\n\nとのことで、確かにこれで`v`と`v2`からデータ競合が起きる可能性があるためRustがそれを排除するのは自然だ。それよりも重要なのはムーブにはポインタのコピーを伴うということだ。これは`v`が所有するリソースが保存されているアドレスと異なるアドレスに`v2`のオブジェクトが格納され、それに伴ってポインタのコピーが発生するということだろう。\n\nだとしたらムーブというのは厳密には転送ではなくてコピーということなのではないだろうか。これはコンパイラの実装を見て理解できるのかどうかも怪しいがなんとも言えない。\n\n# Copy型\n`Copy`とは\n> 所有権が他の束縛に転送されるとき、元の束縛を使うことができないということを証明しました。 しかし、この挙動を変更する トレイト があります。\n\nと言っているトレイトである。上のコード例でも`Copy`トレイトが実装されていない`Vec<i32>`型の`v`のムーブだったため`v2`にムーブした後に`v`を使うことができずにエラーが出ていた。つまり`Copy`が実装されている型であれば万事解決というわけだ。\n\n```rust\nlet v = 1;\nlet v2 = v;\nprintln!("{}", v);\n```\n\nこれは実際成功する。なぜなら`i32`は`Copy`を実装しているからだ。でもムーブが発生しているし、データの競合は起きるのでは？という疑問がある。それについては\n\n> これはちょうどムーブと同じように、 v を v2 に割り当てるとき、データのコピーが作られるということを意味します。 しかし、ムーブと違って後でまだ v を使うことができます。 これは i32 がどこか別の場所へのポインタを持たず、コピーが完全コピーだからです。\n\nということらしい。`Copy`の実装がされていればムーブは実質的に完全コピー、見かけは同じでもメモリ上は全く別物のリソースとなるため所有権は完全に独立している。そのためRustのルールから逸脱していないわけだ。\n\n> 全てのプリミティブ型は Copy トレイトを実装しているので、推測どおりそれらの所有権は「所有権ルール」に従ってはムーブしません。\n\nとある。`「所有権ルール」に従っては`という表現は何か行間がありそうだが、単純にコピーをしていると読み替えても問題はなさそうだ。なぜなら上で推察した通り、それは1つのリソースが複数所有されているわけではないからだ。\n\n# 所有権を越えて\n関数への実引数として束縛した変数を渡すとムーブが起きる。そのため、関数の呼び出し元は関数がその所有権を返すようにしてもらわねばならない。\n\n```rust\nfn foo(v1: Vec<i32>, v2: Vec<i32>) -> (Vec<i32>, Vec<i32>, i32) {\n  // `Copy`を実装しない`Vec`であるため`v`についてはムーブが起きる　\n  // そのため、持ち主に対して所有権を返す必要がある\n  (v1, v2, 42)\n}\n\nlet v1 = vec![1, 2, 3];\nlet v2 = vec![1, 2, 3];\n\nlet (v1, v2, n) = foo(v1, v2);\n```\n\nこれはなんとも手間だ。しかしこれはRustがもともと提供する借用という機能を使うことで簡単に解決できる。\n\n# 借用\n借用を用いたコードはこのようになる\n\n```rust\nfn foo(v1: &Vec<i32>, v2: &Vec<i32>) -> Vec<i32> {\n  42\n}\n\nlet v1 = vec![1, 2, 3];\nlet v2 = vec![1, 2, 3];\n\nlet n = foo(&v1, &v2);\n// コンパイルが通る\nprintln!("{}, {}", v1[0], v2[0]);\n```\n\n> 引数として Vec<i32> を使う代わりに、参照、つまり &Vec<i32> を使います。 そして、 v1 と v2 を直接渡す代わりに、 &v1 と &v2 を渡します。\n\n`&Vec<i32`を「参照」であるといい、`&v1`とすることで`v1`を直接渡さなくて済むという。つまり参照を渡すと所有権の転送であるムーブは起きないということだろう。実際にこう解説されている。\n\n> &T 型は「参照」と呼ばれ、それは、リソースを所有するのではなく、所有権を借用します。\n\n参照をムーブが起きうる箇所で渡すことを所有権の借用という。\n\n> 何かを借用した束縛はそれがスコープから外れるときにリソースを割当解除しません。 これは foo() の呼出しの後に元の束縛を再び使うことができることを意味します。\n\n所有権の項で見た通り、束縛は本来「所有権を持つ」ことを言うが、その所有権が借用だった場合はリソースが解放されずに済む。当然のことだがとても大切だ。\n\n> 参照は束縛とちょうど同じようにイミュータブルです。 これは foo() の中ではベクタは全く変更できないことを意味します。\n\nこれは安全にリソースを扱うRustの心意気という感じだが、普通に`&T`はイミュータブルなものとして扱われる。\n\nここまでの事実を整理すると借用とは\n\n- `&T`の形式で表すリソースの参照を使う\n- 所有権のムーブを回避し、束縛のスコープが終わってもリソースの解放をしない\n- 特に指定がない限りはイミュータブル\n\nということが明らかになった。\n\n# &mut参照\nミュータブルな束縛があるように、参照にもミュータブルなものがある。\n> 参照には2つ目の種類、 &mut T があります。 「ミュータブルな参照」によって借用しているリソースを変更することができるようになります。\n\n```rust\nlet mut x = 5;\n{\n  let y = &mut x;\n  *y += 1;\n}\nprintln!("{}", x);\n```\n\n> y を x へのミュータブルな参照にして、それから y の指示先に1を足します。 x も mut とマークしなければならないことに気付くでしょう。 そうしないと、イミュータブルな値へのミュータブルな借用ということになってしまい、使うことができなくなってしまいます。\n\nこれは今まで得た知識で理解できることだ。ミュータブルな参照を借用した束縛は当然値を変更できる。\n\n>   アスタリスク（ * ）を y の前に追加して、それを *y にしたことにも気付くでしょう。これは、 y が &mut 参照だからです。\n\nアスタリスクを追加する理由として`y`が&mut参照であることが述べられている。値を変更するということはその実体にアクセスして書き換えねばならない。参照の内容にアクセするにはアスタリスクを使用する必要があるということだ。\n\n> それ以外は、 &mut 参照は普通の参照と全く同じです。 しかし、2つの間には、そしてそれらがどのように相互作用するかには大きな違いが あります 。前の例で何かが怪しいと思ったかもしれません。なぜなら、 { と } を使って追加のスコープを必要とするからです。 もしそれらを削除すれば、次のようなエラーが出ます。\n\nこの理由として借用についてのルールが挙げられている。\n\n- 借用は全て所有者のスコープより長く存続してはいけない\n- 借用は`リソースに対する1つ以上の参照(&T)`または`ただ1つのミュータブルな参照(&mut T)`のどちらかを持つことがありうるが、両方同時に持つことはない\n\n1つ目の借用がスコープが終わってもなお存在してしまった場合、本来の所有者と借用しているものが同スコープに並存してしまうことになる。これはRust的にはおかしいことだ。\n\n2つ目はこれもリソースに対して所有権が1つしかあり得ないこととほぼ同じ制約だろう。\n\nいずれにせよ、Rustはデータ競合を排除している。\n\n# スコープの考え方\nドキュメントでは借用のルールを踏まえてスコープの考え方に立ち返っている。\n\nこのコードはエラーを出す。\n```rust\nlet mut x = 5;\n// x をミュータブルな借用をしている。\nlet y = &mut x;\n\n// x と同じスコープで借用しているリソースを更新\n*y += 1;\n\n// 2つ目のルールに違反。また、このエラーは所有者のイミュータブルな参照をしようとしているため発生している。\nprintln!("{}", x);\n// error: cannot borrow `x` as immutable because it is also borrowed as mutable\n//     println!("{}", x);\n//                    ^\n```\n\n> 必要なものは、 println! を呼び出し、イミュータブルな借用を作ろうとする 前に 終わるミュータブルな借用です。 Rustでは借用はその有効なスコープと結び付けられます。 そしてスコープはこのように見えます。\n\n```rust\nlet mut x = 5;\n\nlet y = &mut x;    // -+ xの&mut借用がここから始まる\n                   //  |\n*y += 1;           //  |\n                   //  |\nprintln!("{}", x); // -+ - ここでxを借用しようとする\n                   // -+ xの&mut借用がここで終わる\n```\n\n`pintln!`で`x`を渡すのはムーブが起きるのではないのかという疑問は起きつつもこれはどうやら借用であるらしい。それによって起きるルール違反でコンパイルエラーが出るというわけだ。\n\nここからわかることは借用をする場合は所有者とのスコープの衝突を避けることを知っておかなければならない。\n\n# 借用が回避する問題\n> なぜこのような厳格なルールがあるのでしょうか。 そう、前述したように、それらのルールはデータ競合を回避します。\n\n借用の存在意義はデータ競合の回避だと言っている。例えば\n\n## イテレータの無効\n> 一例は「イテレータの無効」です。それは繰返しを行っているコレクションを変更しようとするときに起こります。 Rustの借用チェッカはこれの発生を回避します。\n\n```rust\nlet mut v = vec![1, 2, 3];\n\nfor i in &v {\n    println!("{}", i);\n}\n```\n\n`Vec<i32>`のミュータブルな束縛である`v`をイミュータブルな借用でイテレートしている。この借用は`for`のスコープのみ有効である。\n\n```rust\nlet mut v = vec![1, 2, 3];\n\nfor i in &v {\n    println!("{}", i);\n        v.push(34);\n}\n//  error: cannot borrow `v` as mutable because it is also borrowed as immutable\n//     v.push(34);\n//     ^\n// note: previous borrow of `v` occurs here; the immutable borrow prevents\n// subsequent moves or mutable borrows of `v` until the borrow ends\n// for i in &v {\n//           ^\n// note: previous borrow ends here\n// for i in &v {\n//     println!(“{}”, i);\n//     v.push(34);\n// }\n// ^\n```\n\nミュータブルな束縛であっても借用の仕方によって不意な変更を避けることができることがわかった。　\n\n## 解放後の使用\n> 参照はそれらの指示するリソースよりも長く生存することはできません。 Rustはこれが真であることを保証するために、参照のスコープをチェックするでしょう。\n\nこれも前述のルール通りだ。\n\n```rust\nlet y: &i32;\n{\n    let x = 5;\n    y = &x;\n}\n\nprintln!("{}", y);\n// error: `x` does not live long enough\n//     y = &x;\n//          ^\n// note: reference must be valid for the block suffix following statement 0 at\n// 2:16...\n// let y: &i32;\n// {\n//     let x = 5;\n//     y = &x;\n// }\n//\n// note: ...but borrowed value is only valid for the block suffix following\n// statement 0 at 4:18\n//     let x = 5;\n//     y = &x;\n// }\n```\n\nこれは少し分かりづらい。まず、外側のスコープで`i32`の参照を束縛するために`y`を宣言した。内側のスコープでは`i32`である5を`x`に束縛し、その参照を`y`に束縛しようとした。コンパイラはそこでエラーを出している。\nなぜなら、内側のスコープを抜けた瞬間に`x`のリソースは解放されてメモリ上から存在をなくしているため、存在しない`x`の参照を持つ`y`が外側のスコープで生きているからである。\n\n> 言い換えると、 y は x が存在するスコープの中でだけ有効だということです。 x がなくなるとすぐに、それを指示することは不正になります。 そのように、エラーは借用が「十分長く生存していない」ことを示します。なぜなら、それが正しい期間有効ではないからです。\n\nこれはすごく安全という印象を受ける。\n\nまた\n\n> 参照がそれの参照する変数より 前に 宣言されたとき、同じ問題が起こります。 これは同じスコープにあるリソースはそれらの宣言された順番と逆に解放されるからです。\n\n```rust\nlet y: &i32;\nlet x = 5;\ny = &x;\n\nprintln!("{}", y);\n// error: `x` does not live long enough\n// y = &x;\n//      ^\n// note: reference must be valid for the block suffix following statement 0 at\n// 2:16...\n//     let y: &i32;\n//     let x = 5;\n//     y = &x;\n//\n//     println!("{}", y);\n// }\n//\n// note: ...but borrowed value is only valid for the block suffix following\n// statement 1 at 3:14\n//     let x = 5;\n//     y = &x;\n//\n//     println!("{}", y);\n// }\n```\n\n参照(`&x`)がそれの参照する変数(`y`)と読み替えられる。つまり`x`より先に宣言した`y`は`x`より寿命が長いためにエラーが出ているということだ。\n\n> 前の例では、 y は x より前に宣言されています。それは、 y が x より長く生存することを意味し、それは許されません。\n\nそう、自分より寿命の短い変数の参照はどうあがいても取得できないためである。\n\n\nなんかあとライフタイムが続くぽいが長くなったので分割。'
}}]);